<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta name="keywords" content="eos,eth,tron,区块链">
<meta property="og:type" content="website">
<meta property="og:title" content="hello shaokun">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="hello shaokun">
<meta property="og:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hello shaokun">
<meta name="twitter:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>hello shaokun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hello shaokun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">code is law</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/24/uniswap 源码解读1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/24/uniswap 源码解读1/" itemprop="url">一步一步教你打造自己的defi-xswap(1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-24T18:31:22+08:00">
                2020-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="welcome"><a href="#welcome" class="headerlink" title="welcome"></a>welcome</h4><blockquote>
<p><a href="https://etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f#code" target="_blank" rel="noopener">uniswap合约源码 etherscan</a><br><a href="https://github.com/Uniswap/uniswap-v2-core" target="_blank" rel="noopener">uniswap合约源码 github</a><br>由于在工作中已经基于uniswap实现了更多玩法的defi,在此把其中的流程再梳理一下<br>本系列文章仅作为uniswap的源码理解以及带你如何实现一个自己的xswap,其他玩法请各位同学自己发挥了</p>
</blockquote>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li>编程语言 <ul>
<li><strong>solidity</strong>(写以太坊合约的语言),</li>
<li><strong>nodejs</strong> (开发环境)</li>
<li><strong>react</strong>(写web前端)</li>
</ul>
</li>
<li>工具<ul>
<li>metamask(以太坊钱包)</li>
<li>以太坊账号,由于计划合约部署在rinkeby上,所以得去领一些ether</li>
<li>梯子,这个你懂的</li>
</ul>
</li>
</ol>
<h4 id="搭建以太坊开发环境"><a href="#搭建以太坊开发环境" class="headerlink" title="搭建以太坊开发环境"></a>搭建以太坊开发环境</h4><ol>
<li><a href="http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.5.1+commit.c8a2cb62.js" target="_blank" rel="noopener">remix</a>,</li>
<li><a href="https://www.trufflesuite.com/" target="_blank" rel="noopener">truffle</a>,</li>
<li><a href="https://getwaffle.io/" target="_blank" rel="noopener">waffle</a>,</li>
<li><a href="https://hardhat.org/" target="_blank" rel="noopener">Hardhat</a></li>
<li><a href="https://github.com/shaokun11/solidity-env-hardhat" target="_blank" rel="noopener">演示用的</a>  (主要是将官方demo改为ts版本)  </li>
</ol>
<blockquote>
<p> 至于怎么选择,合适自己的就是最好的</p>
</blockquote>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>此部分代码为demo代码,如果你和我选用的是同一个框架,应该和下面是一样的  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier: Unlicense</span><br><span class="line">pragma solidity ^0.7.0;</span><br><span class="line"></span><br><span class="line">import &quot;hardhat/console.sol&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Greeter &#123;</span><br><span class="line">  string greeting;</span><br><span class="line"></span><br><span class="line">  constructor(string memory _greeting) &#123;</span><br><span class="line">    // 这里可以打印console,所以选择了这个框架进行开发</span><br><span class="line">    console.log(&quot;Deploying a Greeter with greeting:&quot;, _greeting);</span><br><span class="line">    greeting = _greeting;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function greet() public view returns (string memory) &#123;</span><br><span class="line">    return greeting;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setGreeting(string memory _greeting) public &#123;</span><br><span class="line">    console.log(&quot;Changing greeting from &apos;%s&apos; to &apos;%s&apos;&quot;, greeting, _greeting);</span><br><span class="line">    greeting = _greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;expect&#125; = <span class="built_in">require</span>(<span class="string">"chai"</span>);</span><br><span class="line"><span class="comment">//@ts-ignore</span></span><br><span class="line"><span class="keyword">import</span> &#123;ethers&#125; <span class="keyword">from</span> <span class="string">"hardhat"</span>;</span><br><span class="line"><span class="keyword">import</span> chai <span class="keyword">from</span> <span class="string">"chai"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Wallet&#125; <span class="keyword">from</span> <span class="string">"ethers"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;deployContract, solidity&#125; <span class="keyword">from</span> <span class="string">"ethereum-waffle"</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">"Greeter"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	it(<span class="string">"Should return the new greeting once it's changed"</span>, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">const</span> Greeter = <span class="keyword">await</span> ethers.getContractFactory(<span class="string">"Greeter"</span>);</span><br><span class="line">		<span class="keyword">const</span> greeter = <span class="keyword">await</span> Greeter.deploy(<span class="string">"Hello, world!"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">await</span> greeter.deployed();</span><br><span class="line">		expect(<span class="keyword">await</span> greeter.greet()).to.equal(<span class="string">"Hello, world!"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">await</span> greeter.setGreeting(<span class="string">"Hola, mundo!"</span>);</span><br><span class="line">		expect(<span class="keyword">await</span> greeter.greet()).to.equal(<span class="string">"Hola, mundo!"</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="环境搭建结果演示"><a href="#环境搭建结果演示" class="headerlink" title="环境搭建结果演示"></a>环境搭建结果演示</h4><ol>
<li>本地开发启动节点</li>
<li>编写测试脚本<br><img src="/xswap/ether1.gif" alt="demo"><h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4>区块链技术痴迷的程序猿一枚</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/16/koa+graphql定义你的接口/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/08/16/koa+graphql定义你的接口/" itemprop="url">koa + graphql的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-16T13:13:14+08:00">
                2020-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><blockquote>
<p>完成http请求到graphql的请求改造</p>
</blockquote>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><blockquote>
<p>内容大部分来自己graphql与apollo-server官网, 内部加上自己的一些理解,至于改造嘛,就自己动手咯</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">"koa"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ApolloServer, gql &#125; = <span class="built_in">require</span>(<span class="string">"apollo-server-koa"</span>);</span><br><span class="line"><span class="keyword">const</span> GraphQLJSON = <span class="built_in">require</span>(<span class="string">"graphql-type-json"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; GraphQLScalarType &#125; = <span class="built_in">require</span>(<span class="string">"graphql"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; Kind &#125; = <span class="built_in">require</span>(<span class="string">"graphql/language"</span>);</span><br><span class="line"><span class="keyword">const</span> books = [</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">"Harry Potter and the Chamber of Secrets"</span>,</span><br><span class="line">    author: <span class="string">"J.K. Rowling"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">"Jurassic Park"</span>,</span><br><span class="line">    author: <span class="string">"Michael Crichton"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="string">"1"</span>,</span><br><span class="line">    name: <span class="string">"Elizabeth Bennet"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: <span class="string">"2"</span>,</span><br><span class="line">    name: <span class="string">"Fitzwilliam Darcy"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> typeDefs = gql<span class="string">`</span></span><br><span class="line"><span class="string">  type Query &#123;</span></span><br><span class="line"><span class="string">    #   返回字符串</span></span><br><span class="line"><span class="string">    hello: String</span></span><br><span class="line"><span class="string">    # 返回数组</span></span><br><span class="line"><span class="string">    books: [Book]</span></span><br><span class="line"><span class="string">    # 通过参数查询</span></span><br><span class="line"><span class="string">    user(id: ID): User</span></span><br><span class="line"><span class="string">    info(date: Date): String</span></span><br><span class="line"><span class="string">    # 读取数据</span></span><br><span class="line"><span class="string">    foo: Foo</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  #使用第三方定义的标量 json类型</span></span><br><span class="line"><span class="string">  scalar JSON</span></span><br><span class="line"><span class="string">    # 使用自定义的date类型</span></span><br><span class="line"><span class="string">  scalar Date</span></span><br><span class="line"><span class="string">  type Foo &#123;</span></span><br><span class="line"><span class="string">    user: JSON</span></span><br><span class="line"><span class="string">    created: Date</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type Book &#123;</span></span><br><span class="line"><span class="string">    title: String</span></span><br><span class="line"><span class="string">    author: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type User &#123;</span></span><br><span class="line"><span class="string">    id: ID</span></span><br><span class="line"><span class="string">    name: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolvers = &#123;</span><br><span class="line">  <span class="built_in">JSON</span>: GraphQLJSON, <span class="comment">// 使用第三方的json标量</span></span><br><span class="line">  <span class="built_in">Date</span>: <span class="keyword">new</span> GraphQLScalarType(&#123;</span><br><span class="line">    <span class="comment">// 自定义标量</span></span><br><span class="line">    name: <span class="string">"Date"</span>,</span><br><span class="line">    description: <span class="string">"Date custom scalar type"</span>,</span><br><span class="line">    parseValue(value) &#123;</span><br><span class="line">      <span class="comment">// variables 参数解析路径</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(value);</span><br><span class="line">    &#125;,</span><br><span class="line">    serialize(value) &#123;</span><br><span class="line">      <span class="keyword">return</span> value.getTime();</span><br><span class="line">    &#125;,</span><br><span class="line">    parseLiteral(ast) &#123;</span><br><span class="line">      <span class="comment">// 字面量参数路径</span></span><br><span class="line">      <span class="keyword">if</span> (ast.kind === Kind.INT) &#123;</span><br><span class="line">        <span class="comment">// ast.value 永远是 字符串类型 所以需要转换</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(+ast.value);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  Query: &#123;</span><br><span class="line">    hello: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"Hello shaokun!"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    books: <span class="function"><span class="params">()</span> =&gt;</span> books, <span class="comment">// 直接返回数据库中的books</span></span><br><span class="line">    user(parent, args, context) &#123;</span><br><span class="line">      <span class="comment">// parent 连续查询 中 上一次查询的结果</span></span><br><span class="line">      <span class="comment">// args 查询参数 如上面的id</span></span><br><span class="line">      <span class="comment">// context 全局数据的拿取</span></span><br><span class="line">      <span class="built_in">console</span>.log(parent, args, context.name, context.age);</span><br><span class="line">      <span class="keyword">return</span> users.find(<span class="function">(<span class="params">user</span>) =&gt;</span> user.id === args.id);</span><br><span class="line">    &#125;,</span><br><span class="line">    foo: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        user: &#123; <span class="attr">name</span>: <span class="string">"shaokum"</span> &#125;,   <span class="comment">// 如果返回的不是json类型 则为null</span></span><br><span class="line">        created: <span class="keyword">new</span> <span class="built_in">Date</span>(),        <span class="comment">// Date类型 实际返回给前端的是 定义的scalar中的serialize方法</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    info: <span class="function">(<span class="params">_, args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 查询方式 字面常量方式查询</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//     info(data:1597552212000)</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"---info-"</span>, args); <span class="comment">// 通过Date.parseLiteral 方法拿到解析的数据</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"this date is "</span> + args.date.toString();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ApolloServer(&#123;</span><br><span class="line">  typeDefs,</span><br><span class="line">  resolvers,</span><br><span class="line">  context: <span class="keyword">async</span> (request) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 可获取到rquest请求</span></span><br><span class="line">    <span class="comment">// 可以全局挂载,如授权token db实例</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">"shaokun"</span>,</span><br><span class="line">      age: <span class="number">18</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">server.applyMiddleware(&#123; app &#125;);</span><br><span class="line"></span><br><span class="line">app.listen(&#123; <span class="attr">port</span>: <span class="number">4000</span> &#125;, () =&gt;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`🚀 Server ready at http://localhost:4000<span class="subst">$&#123;server.graphqlPath&#125;</span>`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h5 id="结果演示"><a href="#结果演示" class="headerlink" title="结果演示"></a>结果演示</h5><p><img src="/react/graphql.gif" alt="graphql query demo"> </p>
<h5 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h5><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/02/在typescript中使用eosjs-ecc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/02/在typescript中使用eosjs-ecc/" itemprop="url">在typescript中使用eosjs-ecc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-02T16:19:14+08:00">
                2020-02-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>ts开发后端项目,考虑到维护的需要,还是需要ts来支持.其中涉及到的lib都能找到对应的types,但是也有例外比如eosjs-ecc</li>
</ul>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><ol>
<li>简单快速,但是没有任何提示了,IDE基本的提示都没有了,对于直接将.js—&gt;.ts可以使用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json中将此字段设为false</span></span><br><span class="line">  <span class="string">"noImplicitAny"</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>自己写 **d.ts,喜欢的同学可以尝试一下</li>
<li><p>工具自动生成,推荐方式<br> -这里使用微软提供的<a href="https://github.com/microsoft/dts-gen" target="_blank" rel="noopener">dts-gen</a>进行生成,放到项目的任意目录即可,但是还是无法使用,这时需要在最外面包裹一层 declare module ‘eosjs-ecc’{}即可,如果使用ts-node执行项目,需要在导入的时候添加ts-ignore,直接使用tsc编译则可以不用</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="keyword">import</span> ecc <span class="keyword">from</span> <span class="string">'eosjs-ecc'</span></span><br><span class="line">ecc.randomKey(<span class="number">0</span>).then(<span class="function">(<span class="params">privateKey:string</span>) =&gt;</span> &#123;</span><br><span class="line">   	<span class="built_in">console</span>.log(privateKey )</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>优化  </p>
<ul>
<li>细心的同学发现,里面的类型全是any,一点用处都没有啊?<br>但是这样可以有IDE的提示了,ts可以正常写代码了呢  </li>
<li><p>由于一个lib我们不会完全用它的方法,那么我们只需要去修改一下我们需要使用的类型即可.比如randomKey这个方法,我们将它的declare中的按照如下更改即可,再次调用就达到了正常使用lib的目的啦</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// export function randomKey(cpuEntropyBits: number ): Promise&lt;string&gt;;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">randomKey</span>(<span class="params">cpuEntropyBits?: number </span>): <span class="title">Promise</span>&lt;<span class="title">string</span>&gt;;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="优化-2020-02-21-15-14-56"><a href="#优化-2020-02-21-15-14-56" class="headerlink" title="优化(2020-02-21 15:14:56)"></a>优化(2020-02-21 15:14:56)</h4><ul>
<li>上述第二点中,使用ts-node需要加上ts-ignore,而直接使用tsc编译为什么能过呢?</li>
<li>原来在tsconfig.json中,我使用include属性将其声明文件包含到编译中了,故可使用.查看ts-node文档,只需要在执行ts-node 加上–files选项,这样将会加载tcconfig.json的include属性,这样就移除ts-ignore这个选项了</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>  最开始自己写*.d.ts,后续发现了居然还有dts-gen这样的工具.回头想想,利用这些工具,真香 ^0^,</p>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#x73;&#x6b;&#117;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#x33;&#x2e;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#x73;&#x6b;&#117;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#x33;&#x2e;&#x63;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/07/electron开发记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/07/electron开发记录/" itemprop="url">create-react-app + electron开发桌面版应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-07T19:26:50+08:00">
                2019-09-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h5><p>使用create-react-app 来配置electron 并打包,当然不想折腾环境的可以直接使用<br><a href="https://github.com/electron-react-boilerplate/electron-react-boilerplate" target="_blank" rel="noopener">模板</a>来搭建环境呢.我选择了折腾,这里记录其中的关键点</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>使用create-react-app 创建项目</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app react-electron</span><br><span class="line">cd react-electron</span><br><span class="line">npm install electron electron-builder image-size url --save-dev</span><br><span class="line"><span class="comment">// electron基础包</span></span><br><span class="line"><span class="comment">// electron-builder打包工具</span></span><br><span class="line"><span class="comment">// image-size 提供桌面图标的lib</span></span><br><span class="line"><span class="comment">// url electron的文件路径需要的东西</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在public里创建electron.js文件(可以copy官网的,下面是我的最终版本),一定要放在public目录下,因为cra会把这个文件夹的文件复制到build目录下的呢</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</span><br><span class="line"><span class="keyword">const</span> platform = <span class="built_in">require</span>(<span class="string">'os'</span>).platform(); <span class="comment">// 获取平台：https://nodejs.org/api/os.html#os_os_platform</span></span><br><span class="line"><span class="comment">// 控制app生命周期.</span></span><br><span class="line"><span class="keyword">const</span> app = electron.app;</span><br><span class="line"><span class="comment">// 浏览器窗口.</span></span><br><span class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow;</span><br><span class="line"><span class="keyword">const</span> Menu = electron.Menu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">const</span> ipc = electron.ipcMain</span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">ipc.on(<span class="string">'app close window'</span>, (sys, msg) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(sys, msg)</span><br><span class="line">    mainWindow.close()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(platform);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setupMenu = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> menu = <span class="keyword">new</span> Menu();</span><br><span class="line">    mainWindow.setMenu(menu);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> template = [&#123;</span><br><span class="line">        label: <span class="string">"Application"</span>,</span><br><span class="line">        submenu: [&#123;</span><br><span class="line">            label: <span class="string">"About Application"</span>,</span><br><span class="line">            selector: <span class="string">"orderFrontStandardAboutPanel:"</span></span><br><span class="line">        &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">"separator"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Quit"</span>,</span><br><span class="line">                accelerator: <span class="string">"Command+Q"</span>,</span><br><span class="line">                click: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    quit();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        label: <span class="string">"Edit"</span>,</span><br><span class="line">        submenu: [&#123;</span><br><span class="line">            label: <span class="string">"Undo"</span>,</span><br><span class="line">            accelerator: <span class="string">"CmdOrCtrl+Z"</span>,</span><br><span class="line">            selector: <span class="string">"undo:"</span></span><br><span class="line">        &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Redo"</span>,</span><br><span class="line">                accelerator: <span class="string">"Shift+CmdOrCtrl+Z"</span>,</span><br><span class="line">                selector: <span class="string">"redo:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">"separator"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Cut"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+X"</span>,</span><br><span class="line">                selector: <span class="string">"cut:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Copy"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+C"</span>,</span><br><span class="line">                selector: <span class="string">"copy:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Paste"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+V"</span>,</span><br><span class="line">                selector: <span class="string">"paste:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Select All"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+A"</span>,</span><br><span class="line">                selector: <span class="string">"selectAll:"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    Menu.setApplicationMenu(Menu.buildFromTemplate(template));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个浏览器窗口.</span></span><br><span class="line">    mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">        width: <span class="number">800</span>,</span><br><span class="line">        height: <span class="number">600</span>,</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            nodeIntegration: <span class="literal">true</span>,  <span class="comment">//允许使用node的方式引入</span></span><br><span class="line">            webSecurity: <span class="literal">false</span>, <span class="comment">// 允许使用本地资源</span></span><br><span class="line">        &#125;,</span><br><span class="line">        backgroundColor: <span class="string">'#B1FF9D'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里要注意一下，这里是让浏览器窗口加载网页。</span></span><br><span class="line">    <span class="comment">// 如果是开发环境，则url为http://localhost:3000（package.json中配置）</span></span><br><span class="line">    <span class="comment">// 如果是生产环境，则url为build/index.html</span></span><br><span class="line">    <span class="keyword">const</span> startUrl = process.env.ELECTRON_START_URL || url.format(&#123;</span><br><span class="line">        pathname: path.join(__dirname, <span class="string">'/../build/index.html'</span>),</span><br><span class="line">        protocol: <span class="string">'file:'</span>,</span><br><span class="line">        slashes: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    setupMenu()</span><br><span class="line">    <span class="comment">// 加载网页之后，会创建`渲染进程`</span></span><br><span class="line">    mainWindow.loadURL(startUrl);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开chrome浏览器开发者工具.</span></span><br><span class="line">    <span class="keyword">if</span> (startUrl.startsWith(<span class="string">'http'</span>)) &#123;</span><br><span class="line">        mainWindow.webContents.openDevTools();</span><br><span class="line">    &#125;</span><br><span class="line">    mainWindow.webContents.openDevTools();</span><br><span class="line">    mainWindow.on(<span class="string">'closed'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        mainWindow = <span class="literal">null</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'ready'</span>, createWindow);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'window-all-closed'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (process.platform !== <span class="string">'darwin'</span>) &#123;</span><br><span class="line">        app.quit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mainWindow === <span class="literal">null</span>) &#123;</span><br><span class="line">        createWindow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>修改package.json  main字段修改的是程序的入口, build为electron-builder的打包的一些配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"main"</span>: <span class="string">"./public/electron.js"</span>,</span><br><span class="line"><span class="string">"homepage"</span>: <span class="string">"."</span>,</span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"react-scripts start"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"react-scripts build"</span>,</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"react-scripts test"</span>,</span><br><span class="line">  <span class="string">"eject"</span>: <span class="string">"react-scripts eject"</span>,</span><br><span class="line">  <span class="string">"electron"</span>: <span class="string">"electron ."</span>,</span><br><span class="line">  <span class="string">"electron-dev"</span>: <span class="string">"ELECTRON_START_URL=http://localhost:3000/ electron ."</span>,</span><br><span class="line">  <span class="string">"packager"</span>: <span class="string">"npm run build &amp;&amp; rm -rf dist &amp;&amp; electron-builder --mac"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"build"</span>: &#123;</span><br><span class="line">  <span class="string">"productName"</span>: <span class="string">"example"</span>,</span><br><span class="line">  <span class="string">"appId"</span>: <span class="string">"com.example.server"</span>,</span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"build/**/*"</span>,</span><br><span class="line">    <span class="string">"package.json"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"directories"</span>: &#123;</span><br><span class="line">    <span class="string">"buildResources"</span>: <span class="string">"public"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>npm start 启动react项目</li>
<li>npm run electron-dev 启动electron项目  </li>
<li>npm run build 打包react项目</li>
<li>npm run electron 查看react打包的结果</li>
<li>npm run package 打包mac应用(win需要再配置一下)</li>
</ol>
<h5 id="结果演示"><a href="#结果演示" class="headerlink" title="结果演示"></a>结果演示</h5><p><a href="https://github.com/shaokun11/react-electron" target="_blank" rel="noopener">源码</a><br><img src="/react/react-electron.gif" alt="material-ui self host font"> </p>
<h5 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h5><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/13/material-ui之自定义字体/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/13/material-ui之自定义字体/" itemprop="url">material-ui之自定义字体</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-13T21:02:00+08:00">
                2019-08-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="因由"><a href="#因由" class="headerlink" title="因由"></a>因由</h5><blockquote>
<p>因近期使需项目需要构建前端页面,故用reactjs作为前端的技术框架,ui选择material-ui v4.3.1作为一个基础.使用create-react-app初始化项目,其中踩了一些坑,记录在此,以做后续查看…</p>
</blockquote>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>根据项目需求,第一步需使用自定义的字体,根据官方文档<a href="https://material-ui.com/zh/customization/typography/" target="_blank" rel="noopener">typography</a>.按照此方式配置,皆无法使字体问题文件生效.(是本地的字体,不是Google font)在一番搜索后,也许是应为版本原因,或者其他原因,可以在此<a href="https://github.com/google/material-design-icons/issues/205" target="_blank" rel="noopener">github issues</a>看到有很多朋友均遇见了此番问题,参照之后,也没有实际解决</p>
<h5 id="转机出现"><a href="#转机出现" class="headerlink" title="转机出现"></a>转机出现</h5><p>按照官方使用Roboto的字体,需要在index.html引入此文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>使用Chrome浏览器看了一下,其加载了一个css文件,内容如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* cyrillic-ext */</span></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Roboto'</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Roboto'</span>), <span class="built_in">local</span>(<span class="string">'Roboto-Regular'</span>), <span class="built_in">url</span>(https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  <span class="attribute">unicode-range</span>: U+<span class="number">0460</span>-<span class="number">052</span>F, U+<span class="number">1</span>C80-<span class="number">1</span>C88, U+<span class="number">20</span>B4, U+<span class="number">2</span>DE0-<span class="number">2</span>DFF, U+A640-A69F, U+FE2E-FE2F;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* cyrillic */</span></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Roboto'</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Roboto'</span>), <span class="built_in">local</span>(<span class="string">'Roboto-Regular'</span>), <span class="built_in">url</span>(https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  <span class="attribute">unicode-range</span>: U+<span class="number">0400</span>-<span class="number">045</span>F, U+<span class="number">0490</span>-<span class="number">0491</span>, U+<span class="number">04</span>B0-<span class="number">04</span>B1, U+<span class="number">2116</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>那我是不是也可以建立一个文件按照此种方式引入呢?</p>
<p>于是仿照上述,在index.css加入字体的应用,最终实现自定义的字体加入material-ui</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">'Gliber'</span>;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">    <span class="attribute">font-display</span>: swap;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'./theme/Gilbert_Bold-Preview_1004.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>经过摸索,如在index.css中加入了自定义字体,则在theme中无需按照官方的方法再次在theme.js中引入字体了,按照如下格式引入即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> typography = &#123;</span><br><span class="line">  fontFamily: [<span class="string">"Gliber"</span>,<span class="string">"Roboto"</span>].join(<span class="string">","</span>),<span class="comment">//这里引入自定义的字体名字,并放在第一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果需要寻找更多的字体,可在<a href="https://fonts.google.com/" target="_blank" rel="noopener">google fonts(自带梯子)</a>寻找,按照Roboto的字体方式引入即可.经过测试,字体的使用可不用梯子</li>
<li>顺带在stackoverflow开启了第一个解答<a href="https://stackoverflow.com/questions/57108085/self-host-font-added-in-material-ui-not-working/57450653#57450653" target="_blank" rel="noopener">Self-host font added in Material-UI not working?
</a></li>
</ul>
<h5 id="结果演示"><a href="#结果演示" class="headerlink" title="结果演示"></a>结果演示</h5><p><a href="https://github.com/shaokun11/material-ui-learn/tree/v1.0" target="_blank" rel="noopener">源码</a><br><img src="/react/material-ui-font.gif" alt="material-ui self host font"> </p>
<h5 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h5><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/12/我应该怎样学习eos智能合约的开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/我应该怎样学习eos智能合约的开发/" itemprop="url">我应该怎样学习eos智能合约的开发?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-12T21:19:18+08:00">
                2019-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>最近还有许多朋友通过微信加我好友,看来越来越多的人在学习区块链了,希望文章能够帮助到你们</li>
</ul>
<h4 id="初衷"><a href="#初衷" class="headerlink" title="初衷"></a>初衷</h4><ul>
<li>当时eos出来的时候,我才开始学习eos的智能合约开发,那时候我找得到的唯一的学习资料就是官网的hello world了.但是eos的版本(目前1.8了,cdt 1.6的更新得非常快,而官网的文章也没来的及更新,那时候Google也找不到给新手入门的资料,所以我就准备把自己学习的一些经验和资料分享给大家,希望你们能够快速入门,少走弯路</li>
</ul>
<h4 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h4><ul>
<li>至于第一篇eos的文章,是讲述scatter如何使用,刚开始写文章,怕文字描述得不够清楚,就一步一步截图(现在想想真傻).由于mac的原因,截的图片是高清的,最终导致图片上传上去太大了,基本上一张图就一个视窗了,看起来真揪心.</li>
<li>最终想了想,这样还是不行呢,所以又去找了个gif的图片放上去,这样基本上就减少了文章的长度.但是是无声的,虽然还是不够视频来得有感觉,但是我尽量做到详细,大家如果跳过了,可以多看两遍应该比直接看图来得好</li>
<li>工具就这样定了,然后就是eosio的版本,由于之前对版本的认知不够,也怪自己的技术弱鸡,这其中就在纠结怎么装好eos,eosio.cdt,现在总结起来其实就是梯子不够高</li>
<li>…</li>
</ul>
<h4 id="你应该做的"><a href="#你应该做的" class="headerlink" title="你应该做的"></a>你应该做的</h4><ol start="0">
<li><strong>不用再看本系列的文章了,所有的文章都已经过时了</strong></li>
<li>如果你是入门eos的智能合约的开发,官网的教程永远是最好的入门资料—&gt;<a href="https://developers.eos.io/eosio-home/docs" target="_blank" rel="noopener">eosio developter</a> </li>
<li>官网的例子学习完,你可以参考这位大佬–&gt;<a href="https://shimo.im/docs/jt2MhxPYTKI6tWnp/read" target="_blank" rel="noopener">eos智能合约开发教程</a>的系列文章.这位大佬的文章既有源码分析,也有c++知识,Linux的讲解,还有web前端的知识,更有node后端的分析,甚至还有IPFS的分析,filecoin的玩法.所以你是不应该错过这一些的文章的</li>
<li>现在eos的安装也方便了,docker直接搞定,如果不喜欢走docker,可以来这里看看<a href="https://github.com/EOSIO/eos" target="_blank" rel="noopener">eosio github</a></li>
<li>小工具,可以完全代替cleos,主要是安装比较简单,如果不跑本地的网络,完全在测试网络上运行,可以一试<a href="https://eosc.app/" target="_blank" rel="noopener">The most flexible &amp; powerful command line tool for any developer to interact with an EOSIO chain</a></li>
<li>网络选择,测试网国内建议<a href="https://kylin.eosx.io/" target="_blank" rel="noopener">kylin test</a>,国外建议<a href="https://monitor.jungletestnet.io/" target="_blank" rel="noopener">jugle2 testnet </a>,梯子足够高的随意选择,如果安装了eos,直接本地运行吧</li>
<li>开发IDE 第一个–&gt;<a href="https://www.eosstudio.io/" target="_blank" rel="noopener">eos stdudio</a>,这个是本地版本的,各个操作系统都有,  第二个–&gt;<a href="https://beosin.com/BEOSIN-IDE/index.html" target="_blank" rel="noopener">beosin</a> 类似以太上的remix, 我选择的是vscode</li>
<li>小工具,js操作eos <a href="[js4eos](https://github.com/itleaks/js4eos">js4eos</a>)</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>eos网络已经运行一年了,然而我的技术却还是没有进步,纠结ing ^_^<br>如果你也对区块链技术感兴趣,包括但不局限于eos,可以加个微信好友共同探讨学习（加好友时，请备注 区块链，谢谢）  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/02/eosio.token transfer action正确的使用方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/02/eosio.token transfer action正确的使用方式/" itemprop="url">eosio.token transfer正确的使用方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-02T21:30:27+08:00">
                2019-03-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>额,正确使用的方式不就是转账吗?直接调用不就可以了?</li>
<li>是的,就是转账,但是<ol>
<li>我要在账号中的合约中执行转账(这个之前的文章已经实现了,不是本篇文章的重点)</li>
<li>同时执行一个greet(std::string msg) action呢?</li>
<li>当其他任何玩家转账给我,我要知道转账的数据,同时给我捎句话呢</li>
</ol>
</li>
<li>那就使用一个action转账,一个action greet(msg)!!!</li>
<li>目的是到了呢,但是这个是两个action呢?那就是有时间差的,貌似不符合我的需求哦,那该怎么办呢?</li>
<li>好的,如果你看过之前的文章,其实你已经明白怎么做了,自定义dispatcher这个宏</li>
<li>是的,完全正确,那么本篇文章就是接着之前的文章而来,把数据记录起来</li>
</ul>
<h4 id="游戏设计"><a href="#游戏设计" class="headerlink" title="游戏设计"></a>游戏设计</h4><ul>
<li>本次的合约来玩一个游戏叫做:paymsg</li>
<li>游戏规则:<ul>
<li>任何人均可以参加游戏,每次参加至少游戏需花费1eos</li>
<li>花费了这个费用的玩家 合约会自动将他转账的memo储存在区块链中,但是会加上我的签名</li>
<li>当然,当你花费超过5个eos时,将会有一次免费的机会再次更新你储存的信息<h4 id="合约设计"><a href="#合约设计" class="headerlink" title="合约设计"></a>合约设计</h4></li>
</ul>
</li>
<li>合约的具体设计请看源码就可以了<ol>
<li>拦截transfer方法,获取转账信息</li>
<li>记住反序列化的时候,需要建一个struct来承载数据的信息 </li>
<li>设计一个对外的action用于 用户免费更新储存的信息</li>
<li>此合约只是demo,仅供参考</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[[eosio::action]]</span><br><span class="line">void upmsg(name player, std::string msg) &#123;</span><br><span class="line">  require_auth(player);</span><br><span class="line">  // 这个地方可以使用这种方式初始化table 真不知道是哪里醉了</span><br><span class="line">  paymessage_index paymessages(get_self(), _code.value);</span><br><span class="line">  auto iterator = paymessages.find(player.value);</span><br><span class="line">  eosio_assert(iterator != paymessages.end(), &quot;you are not in shaokun paymsg game&quot;);</span><br><span class="line">  eosio_assert(iterator-&gt;uamount &gt;= 50000, &quot;you must send more than 5 eos that can update your msg&quot;);</span><br><span class="line">  paymessages.modify(iterator, player, [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">      row.player = player;</span><br><span class="line">      row.msg = msg;</span><br><span class="line">      row.uamount = 0;  //置为0 ,下次更改必须花5eos以上</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void transfer()&#123;</span><br><span class="line">  // 反序列化得到st_transfer结构体对象</span><br><span class="line">  // 就可以拿到transfer的交易信息了,而且是eosio.token发过的transfer</span><br><span class="line">  auto transfer_data = unpack_action_data&lt;st_transfer&gt;();</span><br><span class="line">  // eos是4位小数,由于不支持实际意义上的小数,所以这里要使用整形10000代替1eos</span><br><span class="line">  eosio_assert(transfer_data.quantity.amount &gt;= 10000, &quot;must more than 1 eos provide&quot;);</span><br><span class="line">  auto tr_from = transfer_data.from;</span><br><span class="line">  if(tr_from == get_self()) &#123;</span><br><span class="line">      //自己转出去就不需要参加游戏了</span><br><span class="line">      return;</span><br><span class="line">  &#125;</span><br><span class="line">  auto tr_amount = transfer_data.quantity.amount;</span><br><span class="line">  // https://github.com/EOSIO/eosio.cdt/blob/master/libraries/eosiolib/symbol.hpp</span><br><span class="line">  if(transfer_data.quantity.symbol != eosio::symbol(&quot;EOS&quot;,4))&#123;</span><br><span class="line">      // 我们只收eos</span><br><span class="line">      return;</span><br><span class="line">  &#125;</span><br><span class="line">  auto tr_memo = transfer_data.memo;</span><br><span class="line">  // 这里一定要按照这样的格式初始化table,不然无法写入数据</span><br><span class="line">  // 理论上这种方式初始化的table权限是一样的呢 paymessage_index paymessages(get_self(), _code.value);</span><br><span class="line">  paymessage_index paymessages(get_self(), get_self().value);</span><br><span class="line">  auto itr = paymessages.find(transfer_data.from.value);</span><br><span class="line">  if (itr == paymessages.end())&#123;</span><br><span class="line">      paymessages.emplace(get_self(), [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">          row.player = tr_from;</span><br><span class="line">          row.uamount = tr_amount;</span><br><span class="line">          row.tamount = tr_amount;</span><br><span class="line">          row.msg = &quot;welcome to shaokun paygame, your pay msg is :&quot; + tr_memo;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">      paymessages.modify(itr, get_self(), [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">          row.tamount += tr_amount;</span><br><span class="line">          row.uamount += tr_amount ;</span><br><span class="line">          row.msg = &quot;welcome come back to shaokun paygame:&quot;+ tr_memo;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编译-部署-验证"><a href="#编译-部署-验证" class="headerlink" title="编译,部署,验证"></a>编译,部署,验证</h4><ul>
<li>编译,买RAM,部署</li>
<li>使用shaokunpay11部署合约</li>
<li>使用eostoday1235进行添加数据</li>
<li><p>使用eostoday1235进行两次的upmsg进行修改数据</p>
<p><img src="/img_eos1/eos_gif_3.gif" alt="shaokun"></p>
</li>
<li><p><a href="https://github.com/shaokun11/eosabout.git" target="_blank" rel="noopener">源码</a></p>
</li>
</ul>
<h4 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h4><ul>
<li>之前有一个困惑的问题是关于scatter和eosjs2无法一起使用,官方也没有例子,而现在找到了<a href="https://github.com/GetScatter/scatter-js" target="_blank" rel="noopener">github</a></li>
<li>以下我只是搬运工 ^.^</li>
<li>scatter + eosjs2  </li>
<li>npm i -S scatterjs-core scatterjs-plugin-eosjs2 <a href="mailto:eosjs@20.0.0-beta3" target="_blank" rel="noopener">eosjs@20.0.0-beta3</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterEOS from &apos;scatterjs-plugin-eosjs2&apos;;</span><br><span class="line">import &#123;JsonRpc, Api&#125; from &apos;eosjs&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterEOS() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eos&apos;,</span><br><span class="line">    chainId:&apos;aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906&apos;,</span><br><span class="line">    host:&apos;nodes.get-scatter.com&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line">const rpc = new JsonRpc(network.fullhost());</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;hello shaokun&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const eos = ScatterJS.eos(network, Api, &#123;rpc, beta3:true&#125;);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;eos&apos;);</span><br><span class="line"></span><br><span class="line">        eos.transact(&#123;</span><br><span class="line">            actions: [&#123;</span><br><span class="line">                account: &apos;eosio.token&apos;,</span><br><span class="line">                name: &apos;transfer&apos;,</span><br><span class="line">                authorization: [&#123;</span><br><span class="line">                    actor: account.name,</span><br><span class="line">                    permission: account.authority,</span><br><span class="line">                &#125;],</span><br><span class="line">                data: &#123;</span><br><span class="line">                    from: account.name,</span><br><span class="line">                    to: &apos;safetransfer&apos;,</span><br><span class="line">                    quantity: &apos;0.0001 EOS&apos;,</span><br><span class="line">                    memo: account.name,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            blocksBehind: 3,</span><br><span class="line">            expireSeconds: 30,</span><br><span class="line">        &#125;).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + eosjs1  </li>
<li>npm i -S scatterjs-core scatterjs-plugin-eosjs <a href="mailto:eosjs@16.0.9" target="_blank" rel="noopener">eosjs@16.0.9</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterEOS from &apos;scatterjs-plugin-eosjs&apos;;</span><br><span class="line">import Eos from &apos;eosjs&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterEOS() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eos&apos;,</span><br><span class="line">    chainId:&apos;aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906&apos;,</span><br><span class="line">    host:&apos;nodes.get-scatter.com&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const eos = ScatterJS.eos(network, Eos);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;eos&apos;);</span><br><span class="line">        const options = &#123;authorization:[`$&#123;account.name&#125;@$&#123;account.authority&#125;`]&#125;;</span><br><span class="line">        eos.transfer(account.name, &apos;safetransfer&apos;, &apos;0.0001 EOS&apos;, account.name, options).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + web3</li>
<li>npm i -S scatterjs-core scatterjs-plugin-web3 web3</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterETH from &apos;scatterjs-plugin-web3&apos;;</span><br><span class="line">import Web3 from &apos;web3&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterETH() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eth&apos;,</span><br><span class="line">    chainId:&apos;1&apos;,</span><br><span class="line">    host:&apos;YOUR ETHEREUM NODE&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const web3 = ScatterJS.web3(network, Web3);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        // https://github.com/GetScatter/scatter-js/blob/master/packages/core/src/models/Blockchains.js</span><br><span class="line">        // 这里官方应该写错了,携程trx了,我们把它改过来</span><br><span class="line">        const account = ScatterJS.account(&apos;eth&apos;);</span><br><span class="line">        web3.eth.sendTransaction(&#123;</span><br><span class="line">            from: account.address,</span><br><span class="line">            to: &apos;0x...&apos;,</span><br><span class="line">            value: &apos;1000000000000000&apos;</span><br><span class="line">        &#125;).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + tronweb</li>
<li>npm i -S scatterjs-core scatterjs-plugin-tron tronweb</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterTron from &apos;scatterjs-plugin-tron&apos;;</span><br><span class="line">import TronWeb from &apos;tronweb&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterTron() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;tron&apos;,</span><br><span class="line">    chainId:&apos;1&apos;,</span><br><span class="line">    host:&apos;api.trongrid.io&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const httpProvider = new TronWeb.providers.HttpProvider(network.fullhost());</span><br><span class="line">let tron = new TronWeb(httpProvider, httpProvider, network.fullhost());</span><br><span class="line">tron.setDefaultBlock(&apos;latest&apos;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    tron = ScatterJS.trx(network, tron);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;trx&apos;);</span><br><span class="line">        tron.trx.sendTransaction(&apos;TX...&apos;, 100).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>这样就实现了以太坊payable关键字的功能了</li>
<li>paymsg这个小game的逻辑,其实也和市面上大多数的菠菜类游戏的实现方式类似,只是其中的规则少了点</li>
<li>至此,基于eos开发dapp的所有流程基本上是讲完了</li>
<li>当然其中有很多点我也没有讲到,主要是我在学习的过程中,其他点没有遇到太大的问题.比如说multi_index的操作</li>
<li>关于感想,就是要有耐心去学习这个,因为目前也没有其他的更好的资料,我比较推荐官方的教程<a href="https://developers.eos.io/eosio-home/docs/introduction" target="_blank" rel="noopener">eos smart contract</a></li>
<li>还有一点,如果你使用eosiocpp编译wasm,abi文件,写合约的时候,有时候需要参考源码<a href="https://sourcegraph.com/github.com/EOSIO/eos" target="_blank" rel="noopener">eosio</a>,如果使用eosio.cdt编译的合约,<a href="https://github.com/EOSIO/eosio.cdt/tree/master/libraries/eosiolib" target="_blank" rel="noopener">eosio.cdt eoslib</a>要去这里找(ps:这个地方受过很多伤…)</li>
<li>最后,祝大家学的开心</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#x73;&#107;&#117;&#110;&#110;&#121;&#x40;&#x31;&#54;&#x33;&#46;&#x63;&#x6f;&#x6d;" target="_blank" rel="noopener">&#x73;&#107;&#117;&#110;&#110;&#121;&#x40;&#x31;&#54;&#x33;&#46;&#x63;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/23/eos测试网发行token/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/23/eos测试网发行token/" itemprop="url">一步一步教你在eos主网上发行自己的tokens</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-23T13:33:56+08:00">
                2019-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>2019年来了,祝大家新年快乐</li>
<li>新的一年我们得继续努力呢,当然我也得继续来填坑</li>
<li>接着上篇文章来,本篇文章会带着你一步一步在测试网(主网要真金白银呢)上发行自己的token</li>
<li>本来官网的教程中已经有教怎么样发行自己的token了 <a href="https://developers.eos.io/eosio-home/docs/token-contract" target="_blank" rel="noopener">eosio token issue</a>,为什么我还要再写一遍呢?</li>
<li>我觉得在我学习的过程中遇到了以下两个问题:<ol>
<li>我没有eosio.token的账号呢,我怎么发行token呢? </li>
<li>那我就用自己的account进行发布,那这样的token可以使用吗?</li>
<li>发布token的合约是怎么样的呢?</li>
</ol>
</li>
<li>请自备有足够ram的kylin的账号呢,不然后面没法走哈</li>
</ul>
<h4 id="获取token源码"><a href="#获取token源码" class="headerlink" title="获取token源码"></a>获取token源码</h4><ul>
<li>相信跟着官网走得同学都是在本地的目录中去看源码的,这个源码版本目前只能使用eosiocpp编译,而我目前需要使用cdt来编译呢.</li>
<li>所以我们得来这里获取支持cdt的源码<a href="https://github.com/EOSIO/eosio.contracts" target="_blank" rel="noopener">eosio.contracts</a>,这里存了系统的的contract源码,我们需要eosio.token的合约源码,我们第一步先把它download下来</li>
<li>建议不用修改,除非增加新的业务逻辑</li>
</ul>
<h4 id="token源码分析"><a href="#token源码分析" class="headerlink" title="token源码分析"></a>token源码分析</h4><ul>
<li>文中有注释就不啰嗦了,各位同学自己看就好</li>
<li>如果有同学看过旧版token的合约,可以发现还有有些变化的.不过我们不用care之前的旧版token合约,使用新版的就好</li>
<li>token中主要有两个table,account 和 currency_stats  <ol>
<li>account主要负责记录用户的余额,这个table储存余额很有趣. 使用owner作为scope(这里可以理解为在这个就是一个单独的小table),然后在里面找有没有对应的symbol(前提这symbol得通过currency_stats table的检查,即已经create的)</li>
<li>currency_stats主要负责记录发行的token的信息,主要包括最大发行量,和已经在市面上流通的token数量</li>
</ol>
</li>
<li>token合约中含有create,issue,retire,transfer,open,close六个action,和get_balance,get_supply两个静态方法.其中创建一个token,只有create, issue, transfer是必须的,其他的可根据需求进行增添<ol>
<li>retire 燃烧自己的自己的token,这里token燃烧后总量不会变,相当于又返回给issuer了,如果需要此功能建议减少totalSupply而不是suppy</li>
<li>open和close这两个方法我猜测是为了当issuer token给新账号的时候,可以设置这笔费用,个人觉得没什么鸟用</li>
<li>get_balance和get_supply可以直接获取账户余额和已经issue的token</li>
</ol>
</li>
</ul>
<h4 id="编译-部署-验证"><a href="#编译-部署-验证" class="headerlink" title="编译,部署,验证"></a>编译,部署,验证</h4><ul>
<li>编译,部署</li>
<li>购买ram</li>
<li>craete SHAOKUN token,总量10000个,比较值钱哈</li>
<li>issue 900个给eostoday1235,然后在retire掉(可以理解为销毁,不要这个action也可以) </li>
<li>后续再转账,都可以在浏览器上查到对应的结果</li>
<li><img src="/img_eos1/eos_gif_2.gif" alt="演示结果"></li>
<li><a href="https://github.com/shaokun11/eosabout/tree/create-token" target="_blank" rel="noopener">源码</a></li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>按照上面的步骤,我们已经发行了一种token,注意是使用我们自己的账号</li>
<li>回想一下dispatcher的文章,我们为什么要去判断 code == eosio.token的原因呢? 其实就是确保我们这个token是市面上流通的eos代币,而不是其他某个个人发布的token</li>
<li>一个账号可以发行很多token的,只要symbol不一致就可以了,当然,这个账号也可以发行以eos为symbol的token</li>
<li>最终再和以太坊的erc20 token对比一下,其实这都是一个官方的标准,我们如果想直接使用完全不用修改的,直接往主网部署就可以了.</li>
<li>有时候有新的业务需求,我们完全可以根据自己的需求来更改token内部的某些业务逻辑,毕竟它只是一份部署在你账号的一个智能合约而已,而且这个合约你完全有权限随时更改呢</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email <a href="mailto:&#115;&#107;&#x75;&#x6e;&#110;&#x79;&#64;&#x31;&#54;&#x33;&#x2e;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#115;&#107;&#x75;&#x6e;&#110;&#x79;&#64;&#x31;&#54;&#x33;&#x2e;&#x63;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/26/eos中inline action的理解6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/26/eos中inline action的理解6/" itemprop="url">eos的dispatcher的使用(3 完结)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-26T15:08:04+08:00">
                2019-01-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>经过前面两篇文章的练习,相信各位同学都已经对自定义dispatcher已经有了自己的看法了,那么今天我们继续跟着官方的教程走,把接下来的知识点完整一下</p>
<h4 id="自定义dispatcher-方式3"><a href="#自定义dispatcher-方式3" class="headerlink" title="自定义dispatcher 方式3"></a>自定义dispatcher 方式3</h4><ul>
<li>这种方式官方说了,不能用于eosio-cpp生成abi,所以我也不详细去探究了,有兴趣的同学可以自己研究一下.官方最后总结这是最为灵活的一种方式呢</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This dispatcher places most of the security logic and control inside the action handler, however, cannot use eosio-cpp&apos;s ABI generator.</span><br><span class="line">此调度程序将大多数安全逻辑和控件放在操作处理程序中，但是，不能使用eosio-cpp的ABI生成器。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot; void apply(uint64_t receiver, uint64_t code, uint64_t action) &#123; </span><br><span class="line">  switch(action) &#123;</span><br><span class="line">      case name(&quot;upsert&quot;).value: return upsert(receiver, code);</span><br><span class="line">      case name(&quot;notify&quot;).value: return notify(receiver, code);</span><br><span class="line">      case name(&quot;erase&quot;).value: return erase(receiver, code);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To handle these requests, we move security logic that was otherwise in the dispatcher, into the action. This can provide more control, but may introduce redundancy, particularly for larger contracts. In the end, it accomplishes all the same points as the above patterns while allowing more information into the scope (namely code). Having access to code inside your action may be useful in some situations. This pattern provides the most flexibility in both the dispatcher and the action, hence &quot;Fully Flexible.&quot;</span><br><span class="line">为了处理这些请求，我们将调度程序中的安全逻辑移动到操作中。这可以提供更多控制，但可能会引入冗余，特别是对于大型合同。最后，它完成了与上述模式相同的所有点，同时允许更多信息进入范围（即代码）。在某些情况下，访问操作中的代码可能很有用。这种模式在调度程序和操作中提供了最大的灵活性，因此“完全灵活”。</span><br></pre></td></tr></table></figure>
<h4 id="自定义dispatcher-方式4"><a href="#自定义dispatcher-方式4" class="headerlink" title="自定义dispatcher 方式4"></a>自定义dispatcher 方式4</h4><ul>
<li>官方说,上面自定义apply函数的时候,如果action少还是可以接受的,如果很多呢?就编程了体力劳动了,而且有可能出现漏洞.这显然和我们程序猿的做法不一致,所以官方最后给我们推荐了新的方法,功能类似,且减少体力劳动,不得不说还是很贴心的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \</span><br><span class="line">extern &quot;C&quot; &#123; \</span><br><span class="line">   void apply( uint64_t receiver, uint64_t code, uint64_t action ) &#123; \</span><br><span class="line">      if( code == receiver ) &#123; \</span><br><span class="line">         switch( action ) &#123; \</span><br><span class="line">            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \</span><br><span class="line">         &#125; \</span><br><span class="line">         /* does not allow destructor of thiscontract to run: eosio_exit(0); */ \</span><br><span class="line">      &#125; \</span><br><span class="line">   &#125; \</span><br><span class="line">&#125; \</span><br></pre></td></tr></table></figure>
<ul>
<li>就是这么简单,虽然简单,但是我们还是得看看有什么魔法(以下内容为官方的介绍)</li>
</ul>
<ol>
<li>一定要使用这个 code == receiver的判断,而这个可以自动允许eosio.token进行transfer的方法呢</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Checks if code==receiverand that the action is not transfer. If this condition is omitted, you may introduce a vulnerability into your contract. It allows the action through if the code is eosio.token and the action is transfer. This check prevents another contract with a transfer function from exploiting your contract.</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">2. 合约的实例化,可以看出和之前的apply方法是一样的,之前是在apply函数中实例化,这里直接传入一个实例</span><br></pre></td></tr></table></figure>
<p>Instantiates the TYPE (this would be your standard C++11 class)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 说内部调用了execute_action方法,和我们之前的设计一样</span><br></pre></td></tr></table></figure></p>
<p>Use the EOSIO_DISPATCH_HELPER macro, which inserts a case for each MEMBER into your switch. Inside this case, it calls execute_action using a pattern very similar to the one demonstrated in the Flexible/Compatible Dispatcher defined above.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 直接替换就可以了.不用做任何改变</span><br></pre></td></tr></table></figure></p>
<p>You can then use this macro the same way you would with the provided EOSIO_DISPATCH macro.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 既然这样,这里多了一个EOSIO_DISPATCH_HELPER的宏,我们还是得去源码看看它究竟做了什么我们才能放心呢</span><br><span class="line">* 这里出现了一个小的惊喜,由于我目前的源码都是在eos去找,我居然没有找到EOSIO_DISPATCH_HELPER这个宏,这就尴尬了,转而我转向cdt的源码,总算找到了这个宏</span><br></pre></td></tr></table></figure></p>
<p>// Helper macro for EOSIO_DISPATCH</p>
<p>#define EOSIO_DISPATCH_HELPER( TYPE,  MEMBERS ) \<br>   BOOST_PP_SEQ_FOR_EACH( EOSIO_DISPATCH_INTERNAL, TYPE, MEMBERS )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>// Helper macro for EOSIO_DISPATCH_INTERNAL</p>
<p>#define EOSIO_DISPATCH_INTERNAL( r, OP, elem ) \<br>   case eosio::name( BOOST_PP_STRINGIZE(elem) ).value: \<br>      eosio::execute_action( eosio::name(receiver), eosio::name(code), &amp;OP::elem ); \<br>      break;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>#define EOSIO_DISPATCH( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver ) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 这里一下子三个宏了,我们关心的EOSIO_DISPATCH其实内部也是调用了EOSIO_DISPATCH_HELPER,所以这第三种方式定义的宏我觉得没有必要了哈,</span><br><span class="line">* 哎,官方的文档貌似又落后了,不过已经习以为常了呢.</span><br><span class="line"></span><br><span class="line">####  Security, Security, Security...</span><br></pre></td></tr></table></figure></p>
<p>Your contract’s first line of security begins at your dispatcher. Understanding how the dispatching of actions to your contracts is handled is imperative to limiting exposure to logic inside your actions. Always take great caution when writing a custom dispatcher, and be aware of the security implications of each individual implementation method.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 安全第一,所以应该小心使用apply函数,所以官方最后建议还是直接使用EOSIO_DISPATCHER就可以了,至于原因则如下</span><br></pre></td></tr></table></figure></p>
<p>For simple contracts that only execute internal public actions, the EOSIO_DISPATCH is more than suitable, eliminates cruft and greatly decrease the chance of introducing logical errors.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 猜想</span><br><span class="line">* 既然使用cdt中的EOSIO_DISPATCH就能够达到需求了,那我们该如何实现前面课程的监听呢?</span><br><span class="line">* 通过查看EOSIO_DISPATCHER的判断,这里是不允许code为eosio.token的的操作的记录的,既然这样那我们改造一下EOSIO_DISPATCHER如下所示</span><br></pre></td></tr></table></figure></p>
<p>#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver || code == “eosio.token”_n.value &amp;&amp; action == “transfer”_n.value) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 那么最终结果和上篇文章的内容是一样的,只是我们也没有自己实现apply函数了,而是借助于helper这个宏帮助我们完成</span><br></pre></td></tr></table></figure></p>
<p>#include &lt;eosiolib/eosio.hpp&gt;</p>
<p>#include &lt;eosiolib/print.hpp&gt;</p>
<p>using namespace eosio;</p>
<p>class [[eosio::contract]] addressbook : public eosio::contract {</p>
<p>public:<br>  using contract::contract;</p>
<p>  addressbook(name receiver, name code,  datastream<const char*> ds): contract(receiver, code, ds) {}</const></p>
<p>  [[eosio::action]]<br>  void upsert(name user, std::string first_name, std::string last_name) {<br>    require_auth(user);<br>    address_index addresses(_code, _code.value);<br>    auto iterator = addresses.find(user.value);<br>    if( iterator == addresses.end() )<br>    {<br>      addresses.emplace(user, <a href="auto&amp; row">&amp;</a> {<br>       row.key = user;<br>       row.first_name = first_name;<br>       row.last_name = last_name;<br>      });<br>      send_summary(user, “ successfully emplaced record to addressbook”);<br>    }<br>    else {<br>      std::string changes;<br>      addresses.modify(iterator, user, <a href="auto&amp; row">&amp;</a> {<br>        row.key = user;<br>        row.first_name = first_name;<br>        row.last_name = last_name;<br>      });<br>      send_summary(user, “ successfully modified record to addressbook”);<br>    }<br>  }</p>
<p>  [[eosio::action]]<br>  void erase(name user) {<br>    require_auth(user);</p>
<pre><code>address_index addresses(_self, _code.value);

auto iterator = addresses.find(user.value);
eosio_assert(iterator != addresses.end(), &quot;Record does not exist&quot;);
addresses.erase(iterator);
send_summary(user, &quot; successfully erased record from addressbook&quot;);
</code></pre><p>  }</p>
<p>  void transfer(uint64_t receiver, uint64_t code){<br>    send_summary(name(code), “eosio.token transfer”);<br>  }</p>
<p>private:<br>  struct [[eosio::table]] person {<br>    name key;<br>    std::string first_name;<br>    std::string last_name;<br>    uint64_t primary_key() const { return key.value; }<br>  };</p>
<p>  void send_summary(name user, std::string message) {<br>    action(<br>      permission_level{get_self(),”active”_n},<br>      get_self(),<br>      “notify”_n,<br>      std::make_tuple(user, name{user}.to_string() + message)<br>    ).send();<br>  };</p>
<p>  typedef eosio::multi_index&lt;”people”_n, person&gt; address_index;<br>};</p>
<p>#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver || code == “eosio.token”_n.value &amp;&amp; action == “transfer”_n.value) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \</p>
<p>EOSIO_DISPATCH_CUSTOM( addressbook, (upsert)(erase)(transfer) )<br><code>`</code></p>
<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><ul>
<li>通过我们自定义的dispatcher,我们已经实现了和上篇文章同样的功能,且不用自己实现apply函数,极大的简化了操作</li>
<li>当然,目前的方式我们允许的是eosio.token执行transfer操作,那么我们也可以仿照实现其他特殊合约的记录,比如说eosio.system(用来操作cpu,ram)的或者其他我们自定义的合约</li>
</ul>
<p><img src="/img_eos1/eos_gif_1.gif" alt="shaokun"></p>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-dispatcher-03" target="_blank" rel="noopener">本课源码</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>上一篇最后一个问题,我们已经记录了当我们账户上eos的交易的数据,但是具体的数据我们还不知道呢?比如说转给谁?谁转的?转了多少?还有memo(这个也很重要的,有时候很多数据的有效性可以通过它来进行验证)</li>
<li>第二个问题,我们怎么在链上发我们的自己的代币呢?而且这个代币要符合eos代币的标准标准(这里为什么要抛出这个问题呢?因为我只在本地的环境按照教程走,发过行过代币,但是在测试网,我没有eosio.token的账号,我居然懵逼了,不知道怎么发了),过程很简单,但是留给各位同学自己也思考一下</li>
<li>三篇文章下来,可以看到跟着官网走,有好处,权威,也有坑,文档总是落后实际情况,那么我们能做点什么吗?我觉得能的,虽然语法变了,但是核心不变,所以我们掌握它的基础性内容,变来变去我们只需要去补一点它变化的内容就好了,如果你之前有基础,这应该就是手到擒来的事情了,只是,看我们还能否学得动哈^_^</li>
</ul>
<h4 id="啰嗦一句"><a href="#啰嗦一句" class="headerlink" title="啰嗦一句"></a>啰嗦一句</h4><ul>
<li>莫名其妙,就叫收拾东西走人了,具体原因都没有,寒冬的果实也落在了我的头上了…(ps:猜测是俺站错了队吧,整个团队一起走人了…)</li>
<li>换个方向想,何尝不是又给了我们人生中多一次选择的机会呢?</li>
<li>这应该是年前的最后一篇文章了,希望年后能够继续给大家分享一些dapp开发的知识,谢谢你的阅读</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#x73;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#x73;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/19/eos中inline action的理解5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/19/eos中inline action的理解5/" itemprop="url">eos的dispatcher的使用(2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-19T20:25:13+08:00">
                2019-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>希望阅读本篇文章的同学去看一下上一篇文章,不然思路断了接不上就有点麻烦了    </p>
</blockquote>
<h4 id="多说两句"><a href="#多说两句" class="headerlink" title="多说两句"></a>多说两句</h4><ul>
<li>话说以太坊的分叉计划又延期了,而此次的升级主要是针对底层的安全机制,所以可见写智能合约的最关键点还是安全第一吧,</li>
<li>eos一直被攻击,从未被停止.最近的eos因为一个derferred action的问题的漏洞又被黑客利用了,哎… 受伤的总是开发者</li>
<li>大家写的合约还有一个点,就是安全.这里一个朋友已经开发了一款应用,也已经上线到主网,各种测试也做了,什么逻辑,压力,数据,前端页面的跳转等等… 然而当项目上线后,他找到我对我说,别人可以绕过前端代码直接调用的它的合约…  我只能说,这就是智能合约,你所写的合约是全世界的人(当然,如果你的项目很成功,那么黑客也是由兴趣来光顾的)都可以调用的,除非你做一些权限的验证.在eos上还好,可以通过升级合约来弥补,而且code还不用开源.但是在eth,code is law,code还要开源,所以各位同学想想这个合约安全的重要性.eos底层虽然还有bug,我们无法避免,但是我们还是应该对我们的应用层的逻辑进行严格的测试,这样开发的智能合约才经得住世界人民的考验,你说是不是呢?</li>
</ul>
<h4 id="自定义dispatcher-方式2"><a href="#自定义dispatcher-方式2" class="headerlink" title="自定义dispatcher 方式2"></a>自定义dispatcher 方式2</h4><blockquote>
<p>按照上篇文章的做法,那么我们实现了自己定义apply函数来取代EOSIO_DISPATCHER,但是实现的功能是一模一样的,那我们这样做的目的是什么呢?</p>
</blockquote>
<ul>
<li>那么接下来我们继续按照官方的教程走,通过另外一种方式来实现.</li>
<li>那么此种方式相对于上一中方式有什么区别呢?</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This pattern provides more control over security at the expense of maintainability. Utilizing if...else if statements as opposed to a switch inherently provides more granularity.</span><br><span class="line">此模式以可维护性为代价提供了对安全性的更多控制。利用if ... else if语句而不是switch提供更精细的控制。</span><br></pre></td></tr></table></figure>
<p>好吧,既然看起来优点这么多,那么我们就看看是怎么样实现的吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">  void apply(uint64_t receiver, uint64_t code, uint64_t action) &#123;</span><br><span class="line">    addressbook _addressbook(receiver);</span><br><span class="line">    if(code==receiver &amp;&amp; action==name(&quot;upsert&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::upsert );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==receiver &amp;&amp; action==name(&quot;notify&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::notify );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==receiver &amp;&amp; action==name(&quot;erase&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::erase );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==name(&quot;eosio.token&quot;).value &amp;&amp; action==name(&quot;transfer&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::transfer );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>初看和上一篇文章简直是一模一样,就是把switch换成了if…else,看来官方真实说的大实话呢</li>
<li>不过,最后一个else多了一个判断,addressbook去调用transfer方法,可是我们没有啊,既然是这样,那我们就依样画葫芦,待会写一个吧</li>
<li>第二点,最后一个else判断变成了code == eosio.token,这就是我们上篇文章说的这个code的意义了.而eosio.token是系统的账号,当发生eos或者其他代币时才会调用这个方法呢,那么我猜测一下这个判断是当发生eosio.token执行transfer的时候,将会执行我们合约transfer方法</li>
</ul>
<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><blockquote>
<p>按照上面说的,我们就按照我们得思路先写一个吧,那么就加一个transfer方法如下.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void transfer(uint64_t receiver, uint64_t code)&#123;</span><br><span class="line">   send_summary(name(code), &quot;eosio.token transfer&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>很简单,当发生transfer时,我们出发一个inline action来记录一下数据</li>
<li>那我们看下结果,结果报错了???? </li>
<li>why? 我们仅仅是转账啊,自己转出去或者别人转进来,现在都失败了</li>
</ul>
<h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><p><em>Authorization failure with inline action sent to self</em></p>
<ul>
<li>权限不允许给自己发送内联action?</li>
<li>这是什么情况?给自己发送内联action还要权限?</li>
<li>想想想… 对了,要让自己的合约调用其他合约需要给eosio.code发送权限,那我们接下来试试看看是不是这个原因呢</li>
</ul>
<p><img src="/img_eos1/eos_react9.gif" alt="shaokun"></p>
<h4 id="再次验证分析结果"><a href="#再次验证分析结果" class="headerlink" title="再次验证分析结果"></a>再次验证分析结果</h4><ul>
<li>使用owner权限,给eosio.code授予active权限</li>
<li>执行相互转账</li>
<li>查看是否能够出发我们自定义的内联action(经过上一步的操作,和我们之前的经验,它应该是调用了我们得inline action,不过还是得看事实说话呢)</li>
<li>去kylin,确实达到了我们的结果,无论转账转出或者转入,那么我们都发送了一个inline action<br><img src="/img_eos1/eos_react10.gif" alt="shaokun"></li>
</ul>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-dispatcher-02" target="_blank" rel="noopener">本课源码</a>  </p>
<ul>
<li>这里说一下这个源码,我已经编译好的abi和wasm文件,各位同学可以直接部署,如果要修改源码,就得自己编译了.不同的编译版本可能会有不同的eos语法,我这里用的是cdt1.3.2</li>
<li>还有,部署的时候,最好文件夹名字和主合约的名字一样,这样可以可以避免一些想不到的奇奇怪怪的错误.</li>
</ul>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><ul>
<li>关于上一篇文章开篇提到的类似以太坊中payable关键字的功能,我想各位同学应该知道怎么实现了吧</li>
<li>通过我们目前自己实现apply的方式,不用eosio.code授予权限,我们是可以拒绝或者转出eos的,当然这样的方式达到了目的,但是不够优雅</li>
<li>通过结果,我们发现了我们也可以在合约中检查监听到eos的转出和转入,那么我们是否可以通过此做出相应的动作呢?答案是可以的,具体怎么使用我们以后的文章再说</li>
<li>那么我们怎么优雅的实现拒绝账户eos的交易呢,我觉得最简单的方法就是调用eosio_assert(1==2);哈哈,^_^</li>
<li>问题又来了?如果我不调用inline action,那么是不是我不用授权给eosio.code就可以实现转账呢?答案是可以的,本篇文章主要是为了看到具体的转账结果,所以用了inline action,相当于也给大家复习一下这个权限吧.至于这个不使用inline action的,这个可以交由各位同学自己去实现了哈</li>
<li>问题又来了?那我要怎么拿取转账的信息呢?</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#x6b;&#117;&#x6e;&#x6e;&#x79;&#x40;&#x31;&#54;&#x33;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#x73;&#x6b;&#117;&#x6e;&#x6e;&#x79;&#x40;&#x31;&#54;&#x33;&#x2e;&#99;&#111;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shaokun</p>
              <p class="site-description motion-element" itemprop="description">记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shaokun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
 <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
