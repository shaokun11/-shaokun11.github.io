<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta name="keywords" content="eos,eth,tron,区块链">
<meta property="og:type" content="website">
<meta property="og:title" content="hello shaokun">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="hello shaokun">
<meta property="og:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hello shaokun">
<meta name="twitter:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>hello shaokun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hello shaokun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">code is law</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/07/electron开发记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/07/electron开发记录/" itemprop="url">create-react-app + electron开发桌面版应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-07T19:26:50+08:00">
                2019-09-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h5><p>使用create-react-app 来配置electron 并打包,当然不想折腾环境的可以直接使用<br><a href="https://github.com/electron-react-boilerplate/electron-react-boilerplate" target="_blank" rel="noopener">模板</a>来搭建环境呢.我选择了折腾,这里记录其中的关键点</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li>使用create-react-app 创建项目</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app react-electron</span><br><span class="line">cd react-electron</span><br><span class="line">npm install electron electron-builder image-size url --save-dev</span><br><span class="line"><span class="comment">// electron基础包</span></span><br><span class="line"><span class="comment">// electron-builder打包工具</span></span><br><span class="line"><span class="comment">// image-size 提供桌面图标的lib</span></span><br><span class="line"><span class="comment">// url electron的文件路径需要的东西</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在public里创建electron.js文件(可以copy官网的,下面是我的最终版本),一定要放在public目录下,因为cra会把这个文件夹的文件复制到build目录下的呢</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</span><br><span class="line"><span class="keyword">const</span> platform = <span class="built_in">require</span>(<span class="string">'os'</span>).platform(); <span class="comment">// 获取平台：https://nodejs.org/api/os.html#os_os_platform</span></span><br><span class="line"><span class="comment">// 控制app生命周期.</span></span><br><span class="line"><span class="keyword">const</span> app = electron.app;</span><br><span class="line"><span class="comment">// 浏览器窗口.</span></span><br><span class="line"><span class="keyword">const</span> BrowserWindow = electron.BrowserWindow;</span><br><span class="line"><span class="keyword">const</span> Menu = electron.Menu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">const</span> ipc = electron.ipcMain</span><br><span class="line"><span class="keyword">let</span> mainWindow;</span><br><span class="line"></span><br><span class="line">ipc.on(<span class="string">'app close window'</span>, (sys, msg) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(sys, msg)</span><br><span class="line">    mainWindow.close()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(platform);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setupMenu = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> menu = <span class="keyword">new</span> Menu();</span><br><span class="line">    mainWindow.setMenu(menu);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> template = [&#123;</span><br><span class="line">        label: <span class="string">"Application"</span>,</span><br><span class="line">        submenu: [&#123;</span><br><span class="line">            label: <span class="string">"About Application"</span>,</span><br><span class="line">            selector: <span class="string">"orderFrontStandardAboutPanel:"</span></span><br><span class="line">        &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">"separator"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Quit"</span>,</span><br><span class="line">                accelerator: <span class="string">"Command+Q"</span>,</span><br><span class="line">                click: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    quit();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        label: <span class="string">"Edit"</span>,</span><br><span class="line">        submenu: [&#123;</span><br><span class="line">            label: <span class="string">"Undo"</span>,</span><br><span class="line">            accelerator: <span class="string">"CmdOrCtrl+Z"</span>,</span><br><span class="line">            selector: <span class="string">"undo:"</span></span><br><span class="line">        &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Redo"</span>,</span><br><span class="line">                accelerator: <span class="string">"Shift+CmdOrCtrl+Z"</span>,</span><br><span class="line">                selector: <span class="string">"redo:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                type: <span class="string">"separator"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Cut"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+X"</span>,</span><br><span class="line">                selector: <span class="string">"cut:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Copy"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+C"</span>,</span><br><span class="line">                selector: <span class="string">"copy:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Paste"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+V"</span>,</span><br><span class="line">                selector: <span class="string">"paste:"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                label: <span class="string">"Select All"</span>,</span><br><span class="line">                accelerator: <span class="string">"CmdOrCtrl+A"</span>,</span><br><span class="line">                selector: <span class="string">"selectAll:"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    Menu.setApplicationMenu(Menu.buildFromTemplate(template));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个浏览器窗口.</span></span><br><span class="line">    mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">        width: <span class="number">800</span>,</span><br><span class="line">        height: <span class="number">600</span>,</span><br><span class="line">        webPreferences: &#123;</span><br><span class="line">            nodeIntegration: <span class="literal">true</span>,  <span class="comment">//允许使用node的方式引入</span></span><br><span class="line">            webSecurity: <span class="literal">false</span>, <span class="comment">// 允许使用本地资源</span></span><br><span class="line">        &#125;,</span><br><span class="line">        backgroundColor: <span class="string">'#B1FF9D'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里要注意一下，这里是让浏览器窗口加载网页。</span></span><br><span class="line">    <span class="comment">// 如果是开发环境，则url为http://localhost:3000（package.json中配置）</span></span><br><span class="line">    <span class="comment">// 如果是生产环境，则url为build/index.html</span></span><br><span class="line">    <span class="keyword">const</span> startUrl = process.env.ELECTRON_START_URL || url.format(&#123;</span><br><span class="line">        pathname: path.join(__dirname, <span class="string">'/../build/index.html'</span>),</span><br><span class="line">        protocol: <span class="string">'file:'</span>,</span><br><span class="line">        slashes: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    setupMenu()</span><br><span class="line">    <span class="comment">// 加载网页之后，会创建`渲染进程`</span></span><br><span class="line">    mainWindow.loadURL(startUrl);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开chrome浏览器开发者工具.</span></span><br><span class="line">    <span class="keyword">if</span> (startUrl.startsWith(<span class="string">'http'</span>)) &#123;</span><br><span class="line">        mainWindow.webContents.openDevTools();</span><br><span class="line">    &#125;</span><br><span class="line">    mainWindow.webContents.openDevTools();</span><br><span class="line">    mainWindow.on(<span class="string">'closed'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        mainWindow = <span class="literal">null</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'ready'</span>, createWindow);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'window-all-closed'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (process.platform !== <span class="string">'darwin'</span>) &#123;</span><br><span class="line">        app.quit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mainWindow === <span class="literal">null</span>) &#123;</span><br><span class="line">        createWindow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>修改package.json  main字段修改的是程序的入口, build为electron-builder的打包的一些配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"main"</span>: <span class="string">"./public/electron.js"</span>,</span><br><span class="line"><span class="string">"homepage"</span>: <span class="string">"."</span>,</span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"react-scripts start"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"react-scripts build"</span>,</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"react-scripts test"</span>,</span><br><span class="line">  <span class="string">"eject"</span>: <span class="string">"react-scripts eject"</span>,</span><br><span class="line">  <span class="string">"electron"</span>: <span class="string">"electron ."</span>,</span><br><span class="line">  <span class="string">"electron-dev"</span>: <span class="string">"ELECTRON_START_URL=http://localhost:3000/ electron ."</span>,</span><br><span class="line">  <span class="string">"packager"</span>: <span class="string">"npm run build &amp;&amp; rm -rf dist &amp;&amp; electron-builder --mac"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"build"</span>: &#123;</span><br><span class="line">  <span class="string">"productName"</span>: <span class="string">"example"</span>,</span><br><span class="line">  <span class="string">"appId"</span>: <span class="string">"com.example.server"</span>,</span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    <span class="string">"build/**/*"</span>,</span><br><span class="line">    <span class="string">"package.json"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"directories"</span>: &#123;</span><br><span class="line">    <span class="string">"buildResources"</span>: <span class="string">"public"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>npm start 启动react项目</li>
<li>npm run electron-dev 启动electron项目  </li>
<li>npm run build 打包react项目</li>
<li>npm run electron 查看react打包的结果</li>
<li>npm run package 打包mac应用(win需要再配置一下)</li>
</ol>
<h5 id="结果演示"><a href="#结果演示" class="headerlink" title="结果演示"></a>结果演示</h5><p><a href="https://github.com/shaokun11/react-electron" target="_blank" rel="noopener">源码</a><br><img src="/react/react-electron.gif" alt="material-ui self host font"> </p>
<h5 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h5><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/13/material-ui之自定义字体/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/13/material-ui之自定义字体/" itemprop="url">material-ui之自定义字体</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-13T21:02:00+08:00">
                2019-08-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="因由"><a href="#因由" class="headerlink" title="因由"></a>因由</h5><blockquote>
<p>因近期使需项目需要构建前端页面,故用reactjs作为前端的技术框架,ui选择material-ui v4.3.1作为一个基础.使用create-react-app初始化项目,其中踩了一些坑,记录在此,以做后续查看…</p>
</blockquote>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>根据项目需求,第一步需使用自定义的字体,根据官方文档<a href="https://material-ui.com/zh/customization/typography/" target="_blank" rel="noopener">typography</a>.按照此方式配置,皆无法使字体问题文件生效.(是本地的字体,不是Google font)在一番搜索后,也许是应为版本原因,或者其他原因,可以在此<a href="https://github.com/google/material-design-icons/issues/205" target="_blank" rel="noopener">github issues</a>看到有很多朋友均遇见了此番问题,参照之后,也没有实际解决</p>
<h5 id="转机出现"><a href="#转机出现" class="headerlink" title="转机出现"></a>转机出现</h5><p>按照官方使用Roboto的字体,需要在index.html引入此文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>使用Chrome浏览器看了一下,其加载了一个css文件,内容如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* cyrillic-ext */</span></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Roboto'</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Roboto'</span>), <span class="built_in">local</span>(<span class="string">'Roboto-Regular'</span>), <span class="built_in">url</span>(https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  <span class="attribute">unicode-range</span>: U+<span class="number">0460</span>-<span class="number">052</span>F, U+<span class="number">1</span>C80-<span class="number">1</span>C88, U+<span class="number">20</span>B4, U+<span class="number">2</span>DE0-<span class="number">2</span>DFF, U+A640-A69F, U+FE2E-FE2F;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* cyrillic */</span></span><br><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Roboto'</span>;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Roboto'</span>), <span class="built_in">local</span>(<span class="string">'Roboto-Regular'</span>), <span class="built_in">url</span>(https://fonts.gstatic.com/s/roboto/v20/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  <span class="attribute">unicode-range</span>: U+<span class="number">0400</span>-<span class="number">045</span>F, U+<span class="number">0490</span>-<span class="number">0491</span>, U+<span class="number">04</span>B0-<span class="number">04</span>B1, U+<span class="number">2116</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>那我是不是也可以建立一个文件按照此种方式引入呢?</p>
<p>于是仿照上述,在index.css加入字体的应用,最终实现自定义的字体加入material-ui</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">'Gliber'</span>;</span><br><span class="line">    <span class="attribute">font-style</span>: normal;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">    <span class="attribute">font-display</span>: swap;</span><br><span class="line">    <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'./theme/Gilbert_Bold-Preview_1004.woff2'</span>) <span class="built_in">format</span>(<span class="string">'woff2'</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>经过摸索,如在index.css中加入了自定义字体,则在theme中无需按照官方的方法再次在theme.js中引入字体了,按照如下格式引入即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> typography = &#123;</span><br><span class="line">  fontFamily: [<span class="string">"Gliber"</span>,<span class="string">"Roboto"</span>].join(<span class="string">","</span>),<span class="comment">//这里引入自定义的字体名字,并放在第一</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果需要寻找更多的字体,可在<a href="https://fonts.google.com/" target="_blank" rel="noopener">google fonts(自带梯子)</a>寻找,按照Roboto的字体方式引入即可.经过测试,字体的使用可不用梯子</li>
<li>顺带在stackoverflow开启了第一个解答<a href="https://stackoverflow.com/questions/57108085/self-host-font-added-in-material-ui-not-working/57450653#57450653" target="_blank" rel="noopener">Self-host font added in Material-UI not working?
</a></li>
</ul>
<h5 id="结果演示"><a href="#结果演示" class="headerlink" title="结果演示"></a>结果演示</h5><p><a href="https://github.com/shaokun11/material-ui-learn/tree/v1.0" target="_blank" rel="noopener">源码</a><br><img src="/react/material-ui-font.gif" alt="material-ui self host font"> </p>
<h5 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h5><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/12/我应该怎样学习eos智能合约的开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/12/我应该怎样学习eos智能合约的开发/" itemprop="url">我应该怎样学习eos智能合约的开发?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-12T21:19:18+08:00">
                2019-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>最近还有许多朋友通过微信加我好友,看来越来越多的人在学习区块链了,希望文章能够帮助到你们</li>
</ul>
<h4 id="初衷"><a href="#初衷" class="headerlink" title="初衷"></a>初衷</h4><ul>
<li>当时eos出来的时候,我才开始学习eos的智能合约开发,那时候我找得到的唯一的学习资料就是官网的hello world了.但是eos的版本(目前1.8了,cdt 1.6的更新得非常快,而官网的文章也没来的及更新,那时候Google也找不到给新手入门的资料,所以我就准备把自己学习的一些经验和资料分享给大家,希望你们能够快速入门,少走弯路</li>
</ul>
<h4 id="踩过的坑"><a href="#踩过的坑" class="headerlink" title="踩过的坑"></a>踩过的坑</h4><ul>
<li>至于第一篇eos的文章,是讲述scatter如何使用,刚开始写文章,怕文字描述得不够清楚,就一步一步截图(现在想想真傻).由于mac的原因,截的图片是高清的,最终导致图片上传上去太大了,基本上一张图就一个视窗了,看起来真揪心.</li>
<li>最终想了想,这样还是不行呢,所以又去找了个gif的图片放上去,这样基本上就减少了文章的长度.但是是无声的,虽然还是不够视频来得有感觉,但是我尽量做到详细,大家如果跳过了,可以多看两遍应该比直接看图来得好</li>
<li>工具就这样定了,然后就是eosio的版本,由于之前对版本的认知不够,也怪自己的技术弱鸡,这其中就在纠结怎么装好eos,eosio.cdt,现在总结起来其实就是梯子不够高</li>
<li>…</li>
</ul>
<h4 id="你应该做的"><a href="#你应该做的" class="headerlink" title="你应该做的"></a>你应该做的</h4><ol start="0">
<li><strong>不用再看本系列的文章了,所有的文章都已经过时了</strong></li>
<li>如果你是入门eos的智能合约的开发,官网的教程永远是最好的入门资料—&gt;<a href="https://developers.eos.io/eosio-home/docs" target="_blank" rel="noopener">eosio developter</a> </li>
<li>官网的例子学习完,你可以参考这位大佬–&gt;<a href="https://shimo.im/docs/jt2MhxPYTKI6tWnp/read" target="_blank" rel="noopener">eos智能合约开发教程</a>的系列文章.这位大佬的文章既有源码分析,也有c++知识,Linux的讲解,还有web前端的知识,更有node后端的分析,甚至还有IPFS的分析,filecoin的玩法.所以你是不应该错过这一些的文章的</li>
<li>现在eos的安装也方便了,docker直接搞定,如果不喜欢走docker,可以来这里看看<a href="https://github.com/EOSIO/eos" target="_blank" rel="noopener">eosio github</a></li>
<li>小工具,可以完全代替cleos,主要是安装比较简单,如果不跑本地的网络,完全在测试网络上运行,可以一试<a href="https://eosc.app/" target="_blank" rel="noopener">The most flexible &amp; powerful command line tool for any developer to interact with an EOSIO chain</a></li>
<li>网络选择,测试网国内建议<a href="https://kylin.eosx.io/" target="_blank" rel="noopener">kylin test</a>,国外建议<a href="https://monitor.jungletestnet.io/" target="_blank" rel="noopener">jugle2 testnet </a>,梯子足够高的随意选择,如果安装了eos,直接本地运行吧</li>
<li>开发IDE 第一个–&gt;<a href="https://www.eosstudio.io/" target="_blank" rel="noopener">eos stdudio</a>,这个是本地版本的,各个操作系统都有,  第二个–&gt;<a href="https://beosin.com/BEOSIN-IDE/index.html" target="_blank" rel="noopener">beosin</a> 类似以太上的remix, 我选择的是vscode</li>
<li>小工具,js操作eos <a href="[js4eos](https://github.com/itleaks/js4eos">js4eos</a>)</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>eos网络已经运行一年了,然而我的技术却还是没有进步,纠结ing ^_^<br>如果你也对区块链技术感兴趣,包括但不局限于eos,可以加个微信好友共同探讨学习（加好友时，请备注 区块链，谢谢）  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/02/eosio.token transfer action正确的使用方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/02/eosio.token transfer action正确的使用方式/" itemprop="url">eosio.token transfer正确的使用方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-02T21:30:27+08:00">
                2019-03-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>额,正确使用的方式不就是转账吗?直接调用不就可以了?</li>
<li>是的,就是转账,但是<ol>
<li>我要在账号中的合约中执行转账(这个之前的文章已经实现了,不是本篇文章的重点)</li>
<li>同时执行一个greet(std::string msg) action呢?</li>
<li>当其他任何玩家转账给我,我要知道转账的数据,同时给我捎句话呢</li>
</ol>
</li>
<li>那就使用一个action转账,一个action greet(msg)!!!</li>
<li>目的是到了呢,但是这个是两个action呢?那就是有时间差的,貌似不符合我的需求哦,那该怎么办呢?</li>
<li>好的,如果你看过之前的文章,其实你已经明白怎么做了,自定义dispatcher这个宏</li>
<li>是的,完全正确,那么本篇文章就是接着之前的文章而来,把数据记录起来</li>
</ul>
<h4 id="游戏设计"><a href="#游戏设计" class="headerlink" title="游戏设计"></a>游戏设计</h4><ul>
<li>本次的合约来玩一个游戏叫做:paymsg</li>
<li>游戏规则:<ul>
<li>任何人均可以参加游戏,每次参加至少游戏需花费1eos</li>
<li>花费了这个费用的玩家 合约会自动将他转账的memo储存在区块链中,但是会加上我的签名</li>
<li>当然,当你花费超过5个eos时,将会有一次免费的机会再次更新你储存的信息<h4 id="合约设计"><a href="#合约设计" class="headerlink" title="合约设计"></a>合约设计</h4></li>
</ul>
</li>
<li>合约的具体设计请看源码就可以了<ol>
<li>拦截transfer方法,获取转账信息</li>
<li>记住反序列化的时候,需要建一个struct来承载数据的信息 </li>
<li>设计一个对外的action用于 用户免费更新储存的信息</li>
<li>此合约只是demo,仅供参考</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[[eosio::action]]</span><br><span class="line">void upmsg(name player, std::string msg) &#123;</span><br><span class="line">  require_auth(player);</span><br><span class="line">  // 这个地方可以使用这种方式初始化table 真不知道是哪里醉了</span><br><span class="line">  paymessage_index paymessages(get_self(), _code.value);</span><br><span class="line">  auto iterator = paymessages.find(player.value);</span><br><span class="line">  eosio_assert(iterator != paymessages.end(), &quot;you are not in shaokun paymsg game&quot;);</span><br><span class="line">  eosio_assert(iterator-&gt;uamount &gt;= 50000, &quot;you must send more than 5 eos that can update your msg&quot;);</span><br><span class="line">  paymessages.modify(iterator, player, [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">      row.player = player;</span><br><span class="line">      row.msg = msg;</span><br><span class="line">      row.uamount = 0;  //置为0 ,下次更改必须花5eos以上</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void transfer()&#123;</span><br><span class="line">  // 反序列化得到st_transfer结构体对象</span><br><span class="line">  // 就可以拿到transfer的交易信息了,而且是eosio.token发过的transfer</span><br><span class="line">  auto transfer_data = unpack_action_data&lt;st_transfer&gt;();</span><br><span class="line">  // eos是4位小数,由于不支持实际意义上的小数,所以这里要使用整形10000代替1eos</span><br><span class="line">  eosio_assert(transfer_data.quantity.amount &gt;= 10000, &quot;must more than 1 eos provide&quot;);</span><br><span class="line">  auto tr_from = transfer_data.from;</span><br><span class="line">  if(tr_from == get_self()) &#123;</span><br><span class="line">      //自己转出去就不需要参加游戏了</span><br><span class="line">      return;</span><br><span class="line">  &#125;</span><br><span class="line">  auto tr_amount = transfer_data.quantity.amount;</span><br><span class="line">  // https://github.com/EOSIO/eosio.cdt/blob/master/libraries/eosiolib/symbol.hpp</span><br><span class="line">  if(transfer_data.quantity.symbol != eosio::symbol(&quot;EOS&quot;,4))&#123;</span><br><span class="line">      // 我们只收eos</span><br><span class="line">      return;</span><br><span class="line">  &#125;</span><br><span class="line">  auto tr_memo = transfer_data.memo;</span><br><span class="line">  // 这里一定要按照这样的格式初始化table,不然无法写入数据</span><br><span class="line">  // 理论上这种方式初始化的table权限是一样的呢 paymessage_index paymessages(get_self(), _code.value);</span><br><span class="line">  paymessage_index paymessages(get_self(), get_self().value);</span><br><span class="line">  auto itr = paymessages.find(transfer_data.from.value);</span><br><span class="line">  if (itr == paymessages.end())&#123;</span><br><span class="line">      paymessages.emplace(get_self(), [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">          row.player = tr_from;</span><br><span class="line">          row.uamount = tr_amount;</span><br><span class="line">          row.tamount = tr_amount;</span><br><span class="line">          row.msg = &quot;welcome to shaokun paygame, your pay msg is :&quot; + tr_memo;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;else &#123;</span><br><span class="line">      paymessages.modify(itr, get_self(), [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">          row.tamount += tr_amount;</span><br><span class="line">          row.uamount += tr_amount ;</span><br><span class="line">          row.msg = &quot;welcome come back to shaokun paygame:&quot;+ tr_memo;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编译-部署-验证"><a href="#编译-部署-验证" class="headerlink" title="编译,部署,验证"></a>编译,部署,验证</h4><ul>
<li>编译,买RAM,部署</li>
<li>使用shaokunpay11部署合约</li>
<li>使用eostoday1235进行添加数据</li>
<li><p>使用eostoday1235进行两次的upmsg进行修改数据</p>
<p><img src="/img_eos1/eos_gif_3.gif" alt="shaokun"></p>
</li>
<li><p><a href="https://github.com/shaokun11/eosabout.git" target="_blank" rel="noopener">源码</a></p>
</li>
</ul>
<h4 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h4><ul>
<li>之前有一个困惑的问题是关于scatter和eosjs2无法一起使用,官方也没有例子,而现在找到了<a href="https://github.com/GetScatter/scatter-js" target="_blank" rel="noopener">github</a></li>
<li>以下我只是搬运工 ^.^</li>
<li>scatter + eosjs2  </li>
<li>npm i -S scatterjs-core scatterjs-plugin-eosjs2 <a href="mailto:eosjs@20.0.0-beta3" target="_blank" rel="noopener">eosjs@20.0.0-beta3</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterEOS from &apos;scatterjs-plugin-eosjs2&apos;;</span><br><span class="line">import &#123;JsonRpc, Api&#125; from &apos;eosjs&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterEOS() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eos&apos;,</span><br><span class="line">    chainId:&apos;aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906&apos;,</span><br><span class="line">    host:&apos;nodes.get-scatter.com&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line">const rpc = new JsonRpc(network.fullhost());</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;hello shaokun&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const eos = ScatterJS.eos(network, Api, &#123;rpc, beta3:true&#125;);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;eos&apos;);</span><br><span class="line"></span><br><span class="line">        eos.transact(&#123;</span><br><span class="line">            actions: [&#123;</span><br><span class="line">                account: &apos;eosio.token&apos;,</span><br><span class="line">                name: &apos;transfer&apos;,</span><br><span class="line">                authorization: [&#123;</span><br><span class="line">                    actor: account.name,</span><br><span class="line">                    permission: account.authority,</span><br><span class="line">                &#125;],</span><br><span class="line">                data: &#123;</span><br><span class="line">                    from: account.name,</span><br><span class="line">                    to: &apos;safetransfer&apos;,</span><br><span class="line">                    quantity: &apos;0.0001 EOS&apos;,</span><br><span class="line">                    memo: account.name,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            blocksBehind: 3,</span><br><span class="line">            expireSeconds: 30,</span><br><span class="line">        &#125;).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + eosjs1  </li>
<li>npm i -S scatterjs-core scatterjs-plugin-eosjs <a href="mailto:eosjs@16.0.9" target="_blank" rel="noopener">eosjs@16.0.9</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterEOS from &apos;scatterjs-plugin-eosjs&apos;;</span><br><span class="line">import Eos from &apos;eosjs&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterEOS() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eos&apos;,</span><br><span class="line">    chainId:&apos;aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906&apos;,</span><br><span class="line">    host:&apos;nodes.get-scatter.com&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const eos = ScatterJS.eos(network, Eos);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;eos&apos;);</span><br><span class="line">        const options = &#123;authorization:[`$&#123;account.name&#125;@$&#123;account.authority&#125;`]&#125;;</span><br><span class="line">        eos.transfer(account.name, &apos;safetransfer&apos;, &apos;0.0001 EOS&apos;, account.name, options).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + web3</li>
<li>npm i -S scatterjs-core scatterjs-plugin-web3 web3</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterETH from &apos;scatterjs-plugin-web3&apos;;</span><br><span class="line">import Web3 from &apos;web3&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterETH() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;eth&apos;,</span><br><span class="line">    chainId:&apos;1&apos;,</span><br><span class="line">    host:&apos;YOUR ETHEREUM NODE&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    const web3 = ScatterJS.web3(network, Web3);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        // https://github.com/GetScatter/scatter-js/blob/master/packages/core/src/models/Blockchains.js</span><br><span class="line">        // 这里官方应该写错了,携程trx了,我们把它改过来</span><br><span class="line">        const account = ScatterJS.account(&apos;eth&apos;);</span><br><span class="line">        web3.eth.sendTransaction(&#123;</span><br><span class="line">            from: account.address,</span><br><span class="line">            to: &apos;0x...&apos;,</span><br><span class="line">            value: &apos;1000000000000000&apos;</span><br><span class="line">        &#125;).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>scatter + tronweb</li>
<li>npm i -S scatterjs-core scatterjs-plugin-tron tronweb</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import ScatterJS from &apos;scatterjs-core&apos;;</span><br><span class="line">import ScatterTron from &apos;scatterjs-plugin-tron&apos;;</span><br><span class="line">import TronWeb from &apos;tronweb&apos;;</span><br><span class="line"></span><br><span class="line">ScatterJS.plugins( new ScatterTron() );</span><br><span class="line"></span><br><span class="line">const network = ScatterJS.Network.fromJson(&#123;</span><br><span class="line">    blockchain:&apos;tron&apos;,</span><br><span class="line">    chainId:&apos;1&apos;,</span><br><span class="line">    host:&apos;api.trongrid.io&apos;,</span><br><span class="line">    port:443,</span><br><span class="line">    protocol:&apos;https&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const httpProvider = new TronWeb.providers.HttpProvider(network.fullhost());</span><br><span class="line">let tron = new TronWeb(httpProvider, httpProvider, network.fullhost());</span><br><span class="line">tron.setDefaultBlock(&apos;latest&apos;);</span><br><span class="line"></span><br><span class="line">ScatterJS.connect(&apos;YourAppName&apos;, &#123;network&#125;).then(connected =&gt; &#123;</span><br><span class="line">    if(!connected) return console.error(&apos;no scatter&apos;);</span><br><span class="line"></span><br><span class="line">    tron = ScatterJS.trx(network, tron);</span><br><span class="line"></span><br><span class="line">    ScatterJS.login().then(id =&gt; &#123;</span><br><span class="line">        if(!id) return console.error(&apos;no identity&apos;);</span><br><span class="line">        const account = ScatterJS.account(&apos;trx&apos;);</span><br><span class="line">        tron.trx.sendTransaction(&apos;TX...&apos;, 100).then(res =&gt; &#123;</span><br><span class="line">            console.log(&apos;sent: &apos;, res);</span><br><span class="line">        &#125;).catch(err =&gt; &#123;</span><br><span class="line">            console.error(&apos;error: &apos;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>这样就实现了以太坊payable关键字的功能了</li>
<li>paymsg这个小game的逻辑,其实也和市面上大多数的菠菜类游戏的实现方式类似,只是其中的规则少了点</li>
<li>至此,基于eos开发dapp的所有流程基本上是讲完了</li>
<li>当然其中有很多点我也没有讲到,主要是我在学习的过程中,其他点没有遇到太大的问题.比如说multi_index的操作</li>
<li>关于感想,就是要有耐心去学习这个,因为目前也没有其他的更好的资料,我比较推荐官方的教程<a href="https://developers.eos.io/eosio-home/docs/introduction" target="_blank" rel="noopener">eos smart contract</a></li>
<li>还有一点,如果你使用eosiocpp编译wasm,abi文件,写合约的时候,有时候需要参考源码<a href="https://sourcegraph.com/github.com/EOSIO/eos" target="_blank" rel="noopener">eosio</a>,如果使用eosio.cdt编译的合约,<a href="https://github.com/EOSIO/eosio.cdt/tree/master/libraries/eosiolib" target="_blank" rel="noopener">eosio.cdt eoslib</a>要去这里找(ps:这个地方受过很多伤…)</li>
<li>最后,祝大家学的开心</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#x73;&#107;&#x75;&#110;&#110;&#x79;&#64;&#x31;&#54;&#51;&#x2e;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#x73;&#107;&#x75;&#110;&#110;&#x79;&#64;&#x31;&#54;&#51;&#x2e;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/23/eos测试网发行token/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/23/eos测试网发行token/" itemprop="url">一步一步教你在eos主网上发行自己的tokens</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-23T13:33:56+08:00">
                2019-02-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>2019年来了,祝大家新年快乐</li>
<li>新的一年我们得继续努力呢,当然我也得继续来填坑</li>
<li>接着上篇文章来,本篇文章会带着你一步一步在测试网(主网要真金白银呢)上发行自己的token</li>
<li>本来官网的教程中已经有教怎么样发行自己的token了 <a href="https://developers.eos.io/eosio-home/docs/token-contract" target="_blank" rel="noopener">eosio token issue</a>,为什么我还要再写一遍呢?</li>
<li>我觉得在我学习的过程中遇到了以下两个问题:<ol>
<li>我没有eosio.token的账号呢,我怎么发行token呢? </li>
<li>那我就用自己的account进行发布,那这样的token可以使用吗?</li>
<li>发布token的合约是怎么样的呢?</li>
</ol>
</li>
<li>请自备有足够ram的kylin的账号呢,不然后面没法走哈</li>
</ul>
<h4 id="获取token源码"><a href="#获取token源码" class="headerlink" title="获取token源码"></a>获取token源码</h4><ul>
<li>相信跟着官网走得同学都是在本地的目录中去看源码的,这个源码版本目前只能使用eosiocpp编译,而我目前需要使用cdt来编译呢.</li>
<li>所以我们得来这里获取支持cdt的源码<a href="https://github.com/EOSIO/eosio.contracts" target="_blank" rel="noopener">eosio.contracts</a>,这里存了系统的的contract源码,我们需要eosio.token的合约源码,我们第一步先把它download下来</li>
<li>建议不用修改,除非增加新的业务逻辑</li>
</ul>
<h4 id="token源码分析"><a href="#token源码分析" class="headerlink" title="token源码分析"></a>token源码分析</h4><ul>
<li>文中有注释就不啰嗦了,各位同学自己看就好</li>
<li>如果有同学看过旧版token的合约,可以发现还有有些变化的.不过我们不用care之前的旧版token合约,使用新版的就好</li>
<li>token中主要有两个table,account 和 currency_stats  <ol>
<li>account主要负责记录用户的余额,这个table储存余额很有趣. 使用owner作为scope(这里可以理解为在这个就是一个单独的小table),然后在里面找有没有对应的symbol(前提这symbol得通过currency_stats table的检查,即已经create的)</li>
<li>currency_stats主要负责记录发行的token的信息,主要包括最大发行量,和已经在市面上流通的token数量</li>
</ol>
</li>
<li>token合约中含有create,issue,retire,transfer,open,close六个action,和get_balance,get_supply两个静态方法.其中创建一个token,只有create, issue, transfer是必须的,其他的可根据需求进行增添<ol>
<li>retire 燃烧自己的自己的token,这里token燃烧后总量不会变,相当于又返回给issuer了,如果需要此功能建议减少totalSupply而不是suppy</li>
<li>open和close这两个方法我猜测是为了当issuer token给新账号的时候,可以设置这笔费用,个人觉得没什么鸟用</li>
<li>get_balance和get_supply可以直接获取账户余额和已经issue的token</li>
</ol>
</li>
</ul>
<h4 id="编译-部署-验证"><a href="#编译-部署-验证" class="headerlink" title="编译,部署,验证"></a>编译,部署,验证</h4><ul>
<li>编译,部署</li>
<li>购买ram</li>
<li>craete SHAOKUN token,总量10000个,比较值钱哈</li>
<li>issue 900个给eostoday1235,然后在retire掉(可以理解为销毁,不要这个action也可以) </li>
<li>后续再转账,都可以在浏览器上查到对应的结果</li>
<li><img src="/img_eos1/eos_gif_2.gif" alt="演示结果"></li>
<li><a href="https://github.com/shaokun11/eosabout/tree/create-token" target="_blank" rel="noopener">源码</a></li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>按照上面的步骤,我们已经发行了一种token,注意是使用我们自己的账号</li>
<li>回想一下dispatcher的文章,我们为什么要去判断 code == eosio.token的原因呢? 其实就是确保我们这个token是市面上流通的eos代币,而不是其他某个个人发布的token</li>
<li>一个账号可以发行很多token的,只要symbol不一致就可以了,当然,这个账号也可以发行以eos为symbol的token</li>
<li>最终再和以太坊的erc20 token对比一下,其实这都是一个官方的标准,我们如果想直接使用完全不用修改的,直接往主网部署就可以了.</li>
<li>有时候有新的业务需求,我们完全可以根据自己的需求来更改token内部的某些业务逻辑,毕竟它只是一份部署在你账号的一个智能合约而已,而且这个合约你完全有权限随时更改呢</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email <a href="mailto:&#115;&#107;&#117;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#115;&#107;&#117;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/26/eos中inline action的理解6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/26/eos中inline action的理解6/" itemprop="url">eos的dispatcher的使用(3 完结)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-26T15:08:04+08:00">
                2019-01-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>经过前面两篇文章的练习,相信各位同学都已经对自定义dispatcher已经有了自己的看法了,那么今天我们继续跟着官方的教程走,把接下来的知识点完整一下</p>
<h4 id="自定义dispatcher-方式3"><a href="#自定义dispatcher-方式3" class="headerlink" title="自定义dispatcher 方式3"></a>自定义dispatcher 方式3</h4><ul>
<li>这种方式官方说了,不能用于eosio-cpp生成abi,所以我也不详细去探究了,有兴趣的同学可以自己研究一下.官方最后总结这是最为灵活的一种方式呢</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This dispatcher places most of the security logic and control inside the action handler, however, cannot use eosio-cpp&apos;s ABI generator.</span><br><span class="line">此调度程序将大多数安全逻辑和控件放在操作处理程序中，但是，不能使用eosio-cpp的ABI生成器。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot; void apply(uint64_t receiver, uint64_t code, uint64_t action) &#123; </span><br><span class="line">  switch(action) &#123;</span><br><span class="line">      case name(&quot;upsert&quot;).value: return upsert(receiver, code);</span><br><span class="line">      case name(&quot;notify&quot;).value: return notify(receiver, code);</span><br><span class="line">      case name(&quot;erase&quot;).value: return erase(receiver, code);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">To handle these requests, we move security logic that was otherwise in the dispatcher, into the action. This can provide more control, but may introduce redundancy, particularly for larger contracts. In the end, it accomplishes all the same points as the above patterns while allowing more information into the scope (namely code). Having access to code inside your action may be useful in some situations. This pattern provides the most flexibility in both the dispatcher and the action, hence &quot;Fully Flexible.&quot;</span><br><span class="line">为了处理这些请求，我们将调度程序中的安全逻辑移动到操作中。这可以提供更多控制，但可能会引入冗余，特别是对于大型合同。最后，它完成了与上述模式相同的所有点，同时允许更多信息进入范围（即代码）。在某些情况下，访问操作中的代码可能很有用。这种模式在调度程序和操作中提供了最大的灵活性，因此“完全灵活”。</span><br></pre></td></tr></table></figure>
<h4 id="自定义dispatcher-方式4"><a href="#自定义dispatcher-方式4" class="headerlink" title="自定义dispatcher 方式4"></a>自定义dispatcher 方式4</h4><ul>
<li>官方说,上面自定义apply函数的时候,如果action少还是可以接受的,如果很多呢?就编程了体力劳动了,而且有可能出现漏洞.这显然和我们程序猿的做法不一致,所以官方最后给我们推荐了新的方法,功能类似,且减少体力劳动,不得不说还是很贴心的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \</span><br><span class="line">extern &quot;C&quot; &#123; \</span><br><span class="line">   void apply( uint64_t receiver, uint64_t code, uint64_t action ) &#123; \</span><br><span class="line">      if( code == receiver ) &#123; \</span><br><span class="line">         switch( action ) &#123; \</span><br><span class="line">            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \</span><br><span class="line">         &#125; \</span><br><span class="line">         /* does not allow destructor of thiscontract to run: eosio_exit(0); */ \</span><br><span class="line">      &#125; \</span><br><span class="line">   &#125; \</span><br><span class="line">&#125; \</span><br></pre></td></tr></table></figure>
<ul>
<li>就是这么简单,虽然简单,但是我们还是得看看有什么魔法(以下内容为官方的介绍)</li>
</ul>
<ol>
<li>一定要使用这个 code == receiver的判断,而这个可以自动允许eosio.token进行transfer的方法呢</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Checks if code==receiverand that the action is not transfer. If this condition is omitted, you may introduce a vulnerability into your contract. It allows the action through if the code is eosio.token and the action is transfer. This check prevents another contract with a transfer function from exploiting your contract.</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">2. 合约的实例化,可以看出和之前的apply方法是一样的,之前是在apply函数中实例化,这里直接传入一个实例</span><br></pre></td></tr></table></figure>
<p>Instantiates the TYPE (this would be your standard C++11 class)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 说内部调用了execute_action方法,和我们之前的设计一样</span><br></pre></td></tr></table></figure></p>
<p>Use the EOSIO_DISPATCH_HELPER macro, which inserts a case for each MEMBER into your switch. Inside this case, it calls execute_action using a pattern very similar to the one demonstrated in the Flexible/Compatible Dispatcher defined above.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 直接替换就可以了.不用做任何改变</span><br></pre></td></tr></table></figure></p>
<p>You can then use this macro the same way you would with the provided EOSIO_DISPATCH macro.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 既然这样,这里多了一个EOSIO_DISPATCH_HELPER的宏,我们还是得去源码看看它究竟做了什么我们才能放心呢</span><br><span class="line">* 这里出现了一个小的惊喜,由于我目前的源码都是在eos去找,我居然没有找到EOSIO_DISPATCH_HELPER这个宏,这就尴尬了,转而我转向cdt的源码,总算找到了这个宏</span><br></pre></td></tr></table></figure></p>
<p>// Helper macro for EOSIO_DISPATCH</p>
<p>#define EOSIO_DISPATCH_HELPER( TYPE,  MEMBERS ) \<br>   BOOST_PP_SEQ_FOR_EACH( EOSIO_DISPATCH_INTERNAL, TYPE, MEMBERS )</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>// Helper macro for EOSIO_DISPATCH_INTERNAL</p>
<p>#define EOSIO_DISPATCH_INTERNAL( r, OP, elem ) \<br>   case eosio::name( BOOST_PP_STRINGIZE(elem) ).value: \<br>      eosio::execute_action( eosio::name(receiver), eosio::name(code), &amp;OP::elem ); \<br>      break;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>#define EOSIO_DISPATCH( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver ) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 这里一下子三个宏了,我们关心的EOSIO_DISPATCH其实内部也是调用了EOSIO_DISPATCH_HELPER,所以这第三种方式定义的宏我觉得没有必要了哈,</span><br><span class="line">* 哎,官方的文档貌似又落后了,不过已经习以为常了呢.</span><br><span class="line"></span><br><span class="line">####  Security, Security, Security...</span><br></pre></td></tr></table></figure></p>
<p>Your contract’s first line of security begins at your dispatcher. Understanding how the dispatching of actions to your contracts is handled is imperative to limiting exposure to logic inside your actions. Always take great caution when writing a custom dispatcher, and be aware of the security implications of each individual implementation method.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 安全第一,所以应该小心使用apply函数,所以官方最后建议还是直接使用EOSIO_DISPATCHER就可以了,至于原因则如下</span><br></pre></td></tr></table></figure></p>
<p>For simple contracts that only execute internal public actions, the EOSIO_DISPATCH is more than suitable, eliminates cruft and greatly decrease the chance of introducing logical errors.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 猜想</span><br><span class="line">* 既然使用cdt中的EOSIO_DISPATCH就能够达到需求了,那我们该如何实现前面课程的监听呢?</span><br><span class="line">* 通过查看EOSIO_DISPATCHER的判断,这里是不允许code为eosio.token的的操作的记录的,既然这样那我们改造一下EOSIO_DISPATCHER如下所示</span><br></pre></td></tr></table></figure></p>
<p>#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver || code == “eosio.token”_n.value &amp;&amp; action == “transfer”_n.value) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 那么最终结果和上篇文章的内容是一样的,只是我们也没有自己实现apply函数了,而是借助于helper这个宏帮助我们完成</span><br></pre></td></tr></table></figure></p>
<p>#include &lt;eosiolib/eosio.hpp&gt;</p>
<p>#include &lt;eosiolib/print.hpp&gt;</p>
<p>using namespace eosio;</p>
<p>class [[eosio::contract]] addressbook : public eosio::contract {</p>
<p>public:<br>  using contract::contract;</p>
<p>  addressbook(name receiver, name code,  datastream<const char*> ds): contract(receiver, code, ds) {}</const></p>
<p>  [[eosio::action]]<br>  void upsert(name user, std::string first_name, std::string last_name) {<br>    require_auth(user);<br>    address_index addresses(_code, _code.value);<br>    auto iterator = addresses.find(user.value);<br>    if( iterator == addresses.end() )<br>    {<br>      addresses.emplace(user, <a href="auto&amp; row">&amp;</a> {<br>       row.key = user;<br>       row.first_name = first_name;<br>       row.last_name = last_name;<br>      });<br>      send_summary(user, “ successfully emplaced record to addressbook”);<br>    }<br>    else {<br>      std::string changes;<br>      addresses.modify(iterator, user, <a href="auto&amp; row">&amp;</a> {<br>        row.key = user;<br>        row.first_name = first_name;<br>        row.last_name = last_name;<br>      });<br>      send_summary(user, “ successfully modified record to addressbook”);<br>    }<br>  }</p>
<p>  [[eosio::action]]<br>  void erase(name user) {<br>    require_auth(user);</p>
<pre><code>address_index addresses(_self, _code.value);

auto iterator = addresses.find(user.value);
eosio_assert(iterator != addresses.end(), &quot;Record does not exist&quot;);
addresses.erase(iterator);
send_summary(user, &quot; successfully erased record from addressbook&quot;);
</code></pre><p>  }</p>
<p>  void transfer(uint64_t receiver, uint64_t code){<br>    send_summary(name(code), “eosio.token transfer”);<br>  }</p>
<p>private:<br>  struct [[eosio::table]] person {<br>    name key;<br>    std::string first_name;<br>    std::string last_name;<br>    uint64_t primary_key() const { return key.value; }<br>  };</p>
<p>  void send_summary(name user, std::string message) {<br>    action(<br>      permission_level{get_self(),”active”_n},<br>      get_self(),<br>      “notify”_n,<br>      std::make_tuple(user, name{user}.to_string() + message)<br>    ).send();<br>  };</p>
<p>  typedef eosio::multi_index&lt;”people”_n, person&gt; address_index;<br>};</p>
<p>#define EOSIO_DISPATCH_CUSTOM( TYPE, MEMBERS ) \<br>extern “C” { \<br>   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \<br>      if( code == receiver || code == “eosio.token”_n.value &amp;&amp; action == “transfer”_n.value) { \<br>         switch( action ) { \<br>            EOSIO_DISPATCH_HELPER( TYPE, MEMBERS ) \<br>         } \<br>         /<em> does not allow destructor of thiscontract to run: eosio_exit(0); </em>/ \<br>      } \<br>   } \<br>} \</p>
<p>EOSIO_DISPATCH_CUSTOM( addressbook, (upsert)(erase)(transfer) )<br><code>`</code></p>
<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><ul>
<li>通过我们自定义的dispatcher,我们已经实现了和上篇文章同样的功能,且不用自己实现apply函数,极大的简化了操作</li>
<li>当然,目前的方式我们允许的是eosio.token执行transfer操作,那么我们也可以仿照实现其他特殊合约的记录,比如说eosio.system(用来操作cpu,ram)的或者其他我们自定义的合约</li>
</ul>
<p><img src="/img_eos1/eos_gif_1.gif" alt="shaokun"></p>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-dispatcher-03" target="_blank" rel="noopener">本课源码</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>上一篇最后一个问题,我们已经记录了当我们账户上eos的交易的数据,但是具体的数据我们还不知道呢?比如说转给谁?谁转的?转了多少?还有memo(这个也很重要的,有时候很多数据的有效性可以通过它来进行验证)</li>
<li>第二个问题,我们怎么在链上发我们的自己的代币呢?而且这个代币要符合eos代币的标准标准(这里为什么要抛出这个问题呢?因为我只在本地的环境按照教程走,发过行过代币,但是在测试网,我没有eosio.token的账号,我居然懵逼了,不知道怎么发了),过程很简单,但是留给各位同学自己也思考一下</li>
<li>三篇文章下来,可以看到跟着官网走,有好处,权威,也有坑,文档总是落后实际情况,那么我们能做点什么吗?我觉得能的,虽然语法变了,但是核心不变,所以我们掌握它的基础性内容,变来变去我们只需要去补一点它变化的内容就好了,如果你之前有基础,这应该就是手到擒来的事情了,只是,看我们还能否学得动哈^_^</li>
</ul>
<h4 id="啰嗦一句"><a href="#啰嗦一句" class="headerlink" title="啰嗦一句"></a>啰嗦一句</h4><ul>
<li>莫名其妙,就叫收拾东西走人了,具体原因都没有,寒冬的果实也落在了我的头上了…(ps:猜测是俺站错了队吧,整个团队一起走人了…)</li>
<li>换个方向想,何尝不是又给了我们人生中多一次选择的机会呢?</li>
<li>这应该是年前的最后一篇文章了,希望年后能够继续给大家分享一些dapp开发的知识,谢谢你的阅读</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#x73;&#107;&#x75;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#51;&#x2e;&#x63;&#111;&#x6d;" target="_blank" rel="noopener">&#x73;&#107;&#x75;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#51;&#x2e;&#x63;&#111;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/19/eos中inline action的理解5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/19/eos中inline action的理解5/" itemprop="url">eos的dispatcher的使用(2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-19T20:25:13+08:00">
                2019-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>希望阅读本篇文章的同学去看一下上一篇文章,不然思路断了接不上就有点麻烦了    </p>
</blockquote>
<h4 id="多说两句"><a href="#多说两句" class="headerlink" title="多说两句"></a>多说两句</h4><ul>
<li>话说以太坊的分叉计划又延期了,而此次的升级主要是针对底层的安全机制,所以可见写智能合约的最关键点还是安全第一吧,</li>
<li>eos一直被攻击,从未被停止.最近的eos因为一个derferred action的问题的漏洞又被黑客利用了,哎… 受伤的总是开发者</li>
<li>大家写的合约还有一个点,就是安全.这里一个朋友已经开发了一款应用,也已经上线到主网,各种测试也做了,什么逻辑,压力,数据,前端页面的跳转等等… 然而当项目上线后,他找到我对我说,别人可以绕过前端代码直接调用的它的合约…  我只能说,这就是智能合约,你所写的合约是全世界的人(当然,如果你的项目很成功,那么黑客也是由兴趣来光顾的)都可以调用的,除非你做一些权限的验证.在eos上还好,可以通过升级合约来弥补,而且code还不用开源.但是在eth,code is law,code还要开源,所以各位同学想想这个合约安全的重要性.eos底层虽然还有bug,我们无法避免,但是我们还是应该对我们的应用层的逻辑进行严格的测试,这样开发的智能合约才经得住世界人民的考验,你说是不是呢?</li>
</ul>
<h4 id="自定义dispatcher-方式2"><a href="#自定义dispatcher-方式2" class="headerlink" title="自定义dispatcher 方式2"></a>自定义dispatcher 方式2</h4><blockquote>
<p>按照上篇文章的做法,那么我们实现了自己定义apply函数来取代EOSIO_DISPATCHER,但是实现的功能是一模一样的,那我们这样做的目的是什么呢?</p>
</blockquote>
<ul>
<li>那么接下来我们继续按照官方的教程走,通过另外一种方式来实现.</li>
<li>那么此种方式相对于上一中方式有什么区别呢?</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This pattern provides more control over security at the expense of maintainability. Utilizing if...else if statements as opposed to a switch inherently provides more granularity.</span><br><span class="line">此模式以可维护性为代价提供了对安全性的更多控制。利用if ... else if语句而不是switch提供更精细的控制。</span><br></pre></td></tr></table></figure>
<p>好吧,既然看起来优点这么多,那么我们就看看是怎么样实现的吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">  void apply(uint64_t receiver, uint64_t code, uint64_t action) &#123;</span><br><span class="line">    addressbook _addressbook(receiver);</span><br><span class="line">    if(code==receiver &amp;&amp; action==name(&quot;upsert&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::upsert );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==receiver &amp;&amp; action==name(&quot;notify&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::notify );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==receiver &amp;&amp; action==name(&quot;erase&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::erase );</span><br><span class="line">    &#125;</span><br><span class="line">    else if(code==name(&quot;eosio.token&quot;).value &amp;&amp; action==name(&quot;transfer&quot;).value) &#123;</span><br><span class="line">      execute_action(name(receiver), name(code), &amp;addressbook::transfer );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>初看和上一篇文章简直是一模一样,就是把switch换成了if…else,看来官方真实说的大实话呢</li>
<li>不过,最后一个else多了一个判断,addressbook去调用transfer方法,可是我们没有啊,既然是这样,那我们就依样画葫芦,待会写一个吧</li>
<li>第二点,最后一个else判断变成了code == eosio.token,这就是我们上篇文章说的这个code的意义了.而eosio.token是系统的账号,当发生eos或者其他代币时才会调用这个方法呢,那么我猜测一下这个判断是当发生eosio.token执行transfer的时候,将会执行我们合约transfer方法</li>
</ul>
<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><blockquote>
<p>按照上面说的,我们就按照我们得思路先写一个吧,那么就加一个transfer方法如下.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void transfer(uint64_t receiver, uint64_t code)&#123;</span><br><span class="line">   send_summary(name(code), &quot;eosio.token transfer&quot;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>很简单,当发生transfer时,我们出发一个inline action来记录一下数据</li>
<li>那我们看下结果,结果报错了???? </li>
<li>why? 我们仅仅是转账啊,自己转出去或者别人转进来,现在都失败了</li>
</ul>
<h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><p><em>Authorization failure with inline action sent to self</em></p>
<ul>
<li>权限不允许给自己发送内联action?</li>
<li>这是什么情况?给自己发送内联action还要权限?</li>
<li>想想想… 对了,要让自己的合约调用其他合约需要给eosio.code发送权限,那我们接下来试试看看是不是这个原因呢</li>
</ul>
<p><img src="/img_eos1/eos_react9.gif" alt="shaokun"></p>
<h4 id="再次验证分析结果"><a href="#再次验证分析结果" class="headerlink" title="再次验证分析结果"></a>再次验证分析结果</h4><ul>
<li>使用owner权限,给eosio.code授予active权限</li>
<li>执行相互转账</li>
<li>查看是否能够出发我们自定义的内联action(经过上一步的操作,和我们之前的经验,它应该是调用了我们得inline action,不过还是得看事实说话呢)</li>
<li>去kylin,确实达到了我们的结果,无论转账转出或者转入,那么我们都发送了一个inline action<br><img src="/img_eos1/eos_react10.gif" alt="shaokun"></li>
</ul>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-dispatcher-02" target="_blank" rel="noopener">本课源码</a>  </p>
<ul>
<li>这里说一下这个源码,我已经编译好的abi和wasm文件,各位同学可以直接部署,如果要修改源码,就得自己编译了.不同的编译版本可能会有不同的eos语法,我这里用的是cdt1.3.2</li>
<li>还有,部署的时候,最好文件夹名字和主合约的名字一样,这样可以可以避免一些想不到的奇奇怪怪的错误.</li>
</ul>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><ul>
<li>关于上一篇文章开篇提到的类似以太坊中payable关键字的功能,我想各位同学应该知道怎么实现了吧</li>
<li>通过我们目前自己实现apply的方式,不用eosio.code授予权限,我们是可以拒绝或者转出eos的,当然这样的方式达到了目的,但是不够优雅</li>
<li>通过结果,我们发现了我们也可以在合约中检查监听到eos的转出和转入,那么我们是否可以通过此做出相应的动作呢?答案是可以的,具体怎么使用我们以后的文章再说</li>
<li>那么我们怎么优雅的实现拒绝账户eos的交易呢,我觉得最简单的方法就是调用eosio_assert(1==2);哈哈,^_^</li>
<li>问题又来了?如果我不调用inline action,那么是不是我不用授权给eosio.code就可以实现转账呢?答案是可以的,本篇文章主要是为了看到具体的转账结果,所以用了inline action,相当于也给大家复习一下这个权限吧.至于这个不使用inline action的,这个可以交由各位同学自己去实现了哈</li>
<li>问题又来了?那我要怎么拿取转账的信息呢?</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#49;&#54;&#51;&#46;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#x73;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#49;&#54;&#51;&#46;&#x63;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/12/eos中inline action的理解4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/12/eos中inline action的理解4/" itemprop="url">eos的dispatcher的使用(1)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-12T09:44:26+08:00">
                2019-01-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h4><blockquote>
<p>上一篇文章我还在埋怨eos中的智能合约怎么没有以太坊类似的关键字payable呢?看来只有时间才会回答我的这个问题哈.也怪我图样图森破了</p>
</blockquote>
<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ol>
<li>想想距离上次写文章已经过去了快2个月了,而且已经翻了一年了,回想一下去年都做了什么呢?忘了…. 那是什么让我停下了呢?<ul>
<li>工作,毕竟要靠这个混口饭吃,心累…</li>
<li>因为个人原因,周末都在往医院跑,</li>
<li>这个eos的知识点是我周末和下班浏览得到的一点知识,主要是现在我在百度也没有找到比较合适的eos智能合约开发教程,所以就把我的这一路走过来的知识点记录下来.我的工作主要也是做智能合约的开发,所以了解一下也是为了未来失业了多一点选择.而目前公司都是基于以太坊和波场的,所以重点我还是会放到公司的项目中来</li>
<li>至于其他的零碎时间都没有打开电脑了,只是补习了一些c++的知识,虽然我有java功底,但是对与没有常写c++的我来说,语法对我来说不是很难,难在如何动笔写,如何组织代码结构和写出c++的风格</li>
</ul>
</li>
<li>在之前的文章中,我们得智能合约能够跑起来,也能够产生各种交互了.这也得益于官方的文档不断的更新,而我也止步于这个地方了,而对于官方智能合约的最后一篇文章,dispatcher的使用我选择了跳过.</li>
<li>近段时间和几个加我微信好友的开发者一起探讨上面的坑的时候,又回去阅读了几遍官方的教程,再结合Google,那暂时把得到的一点知识分享给大家,希望能够对你有帮助.</li>
</ol>
<p><a href="https://developers.eos.io/eosio-home/docs/writing-a-custom-dispatcher" target="_blank" rel="noopener">custom dispatchers</a></p>
<h4 id="什么是EOSIO-DISPATCH"><a href="#什么是EOSIO-DISPATCH" class="headerlink" title="什么是EOSIO_DISPATCH"></a>什么是EOSIO_DISPATCH</h4><blockquote>
<p>本篇文章我们先跟着上面的链接,把dispatcher的基础信息弄明白,然后再谈其他的哈.而我也会根据自己的理解像大家解释一下,如果有不对的地方,希望各位同学帮我指正过来</p>
</blockquote>
<pre><code>EOSIO_DISPATCH( myclass, (upsert)(notify)(erase) )
</code></pre><p>相信这个大家都知道是c++的宏,帮组eos的合约分发action,那么这个宏的具体定义是什么呢?我们来到源码看看</p>
<p><a href="https://sourcegraph.com/github.com/EOSIO/eos/-/blob/contracts/eosiolib/dispatcher.hpp#L13:9-13:17" target="_blank" rel="noopener">dispatcher.cpp </a> (这里的eos源码还是EOSIO_ABI,在cdt1.3后改为了EOS_DISPATCHER,只是宏名字改了,内容不变)</p>
<pre><code>/** 
 * Convenient macro to create contract apply handler
 * To be able to use this macro, the contract needs to be derived from eosio::contract
 * 
 * @brief Convenient macro to create contract apply handler 
 * @param TYPE - The class name of the contract
 * @param MEMBERS - The sequence of available actions supported by this contract
 * 
 * Example:
 * @code
 * EOSIO_ABI( eosio::bios, (setpriv)(setalimits)(setglimits)(setprods)(reqauth) )
 * @endcode
 */
#define EOSIO_ABI( TYPE, MEMBERS ) \
extern &quot;C&quot; { \
   void apply( uint64_t receiver, uint64_t code, uint64_t action ) { \
      auto self = receiver; \
      if( action == N(onerror)) { \
         /* onerror is only valid if it is for the &quot;eosio&quot; code account and authorized by &quot;eosio&quot;&apos;s &quot;active permission */ \
         eosio_assert(code == N(eosio), &quot;onerror action&apos;s are only valid from the \&quot;eosio\&quot; system account&quot;); \
      } \
      if( code == self || action == N(onerror) ) { \
         TYPE thiscontract( self ); \
         switch( action ) { \
            EOSIO_API( TYPE, MEMBERS ) \
         } \
         /* does not allow destructor of thiscontract to run: eosio_exit(0); */ \
      } \
   } \
} \
</code></pre><p>看到了这个宏的具体实现,应该说这个函数在比较古老的版本,需要自己实现的,后面eos为了简化开发者的工作,才定义了这个宏.后面很多的宏比如说ACTION, CONTRACT也都是如此.这个宏的具体用法请看上面的注释,结果就是我们现在写合约的使用方式了.这个dispatcher.cpp建议大家可以深入了解一下,对后面的智能合约开发或者出现的bug都会有更加深一步的看法</p>
<p>这里还有一个关键点就是,我们的智能合约如果要能够使用,必须提供一个apply的函数,而上面的宏就是帮助我们实现的这个apply函数.那么疑问来了,我是不是自己实现一个apply函数,不用上面的宏,也可以完成这个工作呢?<br>答案是可以的</p>
<h4 id="自定义dispatcher-方式1"><a href="#自定义dispatcher-方式1" class="headerlink" title="自定义dispatcher 方式1"></a>自定义dispatcher 方式1</h4><blockquote>
<p>这里同样跟着官方的教程走</p>
</blockquote>
<pre><code>extern &quot;C&quot; {
    void apply(uint64_t receiver, uint64_t code, uint64_t action) {
        auto self = receiver;
        if( code == self ) {
          addressbook _addressbook(name(receiver));
          switch(action) {
            case name(&quot;upsert&quot;).value: 
              execute_action(name(receiver), name(code), &amp;addressbook::upsert); 
              break;
            case name(&quot;notify&quot;).value: 
              execute_action(name(receiver), name(code), &amp;addressbook::notify); 
              break;
            case name(&quot;erase&quot;).value: 
              execute_action(name(receiver), name(code), &amp;addressbook::erase); 
              break;
          }
        }
    }
};
</code></pre><p>1.</p>
<ul>
<li>可以看到apply函数接收三个参数,第一个receiver,合约的拥有者,</li>
<li>第二个参数code,调用合约的发起人(这个参数我理解为通过什么方式调用的,如果直接通过调用本合约的,这个参数就是self,而如果通过其他智能合约比如说eosio.token,这个code就是eosio.token,或者其他合约的拥有者)</li>
<li>第三个,执行合约的action,也就是合约的函数名,这个合约被标识为action</li>
</ul>
<ol start="2">
<li>if中判断如果合约的调用者是直接调用此合约的,即不是通过其他合约调用本合约的</li>
<li>实例化addressbook这个类,(这里有点疑惑的是,这个_addressbook在这里代表的是类,而addressbook才是对象,没有明白这是为什么,在c++ 中实例化一个类不是 T t 这种形式吗?),这个实例化比较古老了,只接受了一个参数,在cdt1.3要接受三个参数,请注意</li>
<li>一个switch结构,根据对应的action的名字分发对应的动作</li>
<li><p>使用eosio::execute_action执行对应的action</p>
<ul>
<li><p>这里大家又看到了一个新的东西了,不要怕,我们看看是什么</p>
<pre><code>   /**
 * @defgroup dispatcher Dispatcher API
 * @brief Defines functions to dispatch action to proper action handler inside a contract
 * @ingroup contractdev
 */

/**
 * @defgroup dispatchercpp Dispatcher C++ API
 * @brief Defines C++ functions to dispatch action to proper action handler inside a contract
 * @ingroup dispatcher
 * @{
 */

/**
 * Unpack the received action and execute the correponding action handler
 * 
 * @brief Unpack the received action and execute the correponding action handler
 * @tparam T - The contract class that has the correponding action handler, this contract should be derived from eosio::contract
 * @tparam Q - The namespace of the action handler function 
 * @tparam Args - The arguments that the action handler accepts, i.e. members of the action
 * @param obj - The contract object that has the correponding action handler
 * @param func - The action handler
 * @return true  
 */
template&lt;typename T, typename Q, typename... Args&gt;
bool execute_action( T* obj, void (Q::*func)(Args...)  ) {
...
}
</code></pre></li>
<li><p>这里我把具体实现删掉了,只留下了注释和方法签名,可以看到是一个模板函数,那我们就看看他的作用是什么了</p>
<pre><code>Unpack the received action and execute the correponding action handler
解压缩收到的操作并执行相应的操作处理程序
</code></pre></li>
<li>再结合上面的具体的参数的用法,就知道了原来又是一个dispatcher的帮助函数,帮我们去分发对应的action,只是传递的方式变了.</li>
<li>很好,现在我们已经抛弃了系统提供的EOSIO_DISPATCH而自己实现了这个apply函数,至于能不能用呢?那我们接下来试试了</li>
</ul>
</li>
</ol>
<h4 id="自定义dispatcher-方式1-结果展示"><a href="#自定义dispatcher-方式1-结果展示" class="headerlink" title="自定义dispatcher 方式1 结果展示"></a>自定义dispatcher 方式1 结果展示</h4><blockquote>
<p>本次我们直接copy的官方的addressbook的源码,然后使用自己实现apply函数<br>精简一些不必要的参数,实现功能为主<br>上面我说过,由于版本的原因,目前的版本我们需要在实例化addressbook的时候传入三个参数</p>
</blockquote>
<pre><code>addressbook _addressbook(name(receiver),name(code),datastream&lt;const char*&gt;(nullptr,0));
</code></pre><blockquote>
<p>最终改造了的代码如下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;eosiolib/eosio.hpp&gt;</span><br><span class="line">#include &lt;eosiolib/print.hpp&gt;</span><br><span class="line"></span><br><span class="line">using namespace eosio;</span><br><span class="line"></span><br><span class="line">class [[eosio::contract]] addressbook : public eosio::contract &#123;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">  using contract::contract;</span><br><span class="line">  </span><br><span class="line">  addressbook(name receiver, name code,  datastream&lt;const char*&gt; ds): contract(receiver, code, ds) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  [[eosio::action]]</span><br><span class="line">  void upsert(name user, std::string first_name, std::string last_name) &#123;</span><br><span class="line">    require_auth(user);</span><br><span class="line">    address_index addresses(_code, _code.value);</span><br><span class="line">    auto iterator = addresses.find(user.value);</span><br><span class="line">    if( iterator == addresses.end() )</span><br><span class="line">    &#123;</span><br><span class="line">      addresses.emplace(user, [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">       row.key = user;</span><br><span class="line">       row.first_name = first_name;</span><br><span class="line">       row.last_name = last_name;</span><br><span class="line">      &#125;);</span><br><span class="line">      send_summary(user, &quot; successfully emplaced record to addressbook&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">      std::string changes;</span><br><span class="line">      addresses.modify(iterator, user, [&amp;]( auto&amp; row ) &#123;</span><br><span class="line">        row.key = user;</span><br><span class="line">        row.first_name = first_name;</span><br><span class="line">        row.last_name = last_name;</span><br><span class="line">      &#125;);</span><br><span class="line">      send_summary(user, &quot; successfully modified record to addressbook&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [[eosio::action]]</span><br><span class="line">  void erase(name user) &#123;</span><br><span class="line">    require_auth(user);</span><br><span class="line"></span><br><span class="line">    address_index addresses(_self, _code.value);</span><br><span class="line"></span><br><span class="line">    auto iterator = addresses.find(user.value);</span><br><span class="line">    eosio_assert(iterator != addresses.end(), &quot;Record does not exist&quot;);</span><br><span class="line">    addresses.erase(iterator);</span><br><span class="line">    send_summary(user, &quot; successfully erased record from addressbook&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  [[eosio::action]]</span><br><span class="line">  void notify(name user, std::string msg) &#123;</span><br><span class="line">    require_auth(get_self());</span><br><span class="line">    require_recipient(user);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">  struct [[eosio::table]] person &#123;</span><br><span class="line">    name key;</span><br><span class="line">    std::string first_name;</span><br><span class="line">    std::string last_name;</span><br><span class="line">    uint64_t primary_key() const &#123; return key.value; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  void send_summary(name user, std::string message) &#123;</span><br><span class="line">    action(</span><br><span class="line">      permission_level&#123;get_self(),&quot;active&quot;_n&#125;,</span><br><span class="line">      get_self(),</span><br><span class="line">      &quot;notify&quot;_n,</span><br><span class="line">      std::make_tuple(user, name&#123;user&#125;.to_string() + message)</span><br><span class="line">    ).send();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  typedef eosio::multi_index&lt;&quot;people&quot;_n, person&gt; address_index;</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">    void apply(uint64_t receiver, uint64_t code, uint64_t action) &#123;</span><br><span class="line">        auto self = receiver;</span><br><span class="line">        if( code == self ) &#123;</span><br><span class="line">          addressbook _addressbook(name(receiver),name(code),datastream&lt;const char*&gt;(nullptr,0));</span><br><span class="line">          switch(action) &#123;</span><br><span class="line">            case name(&quot;upsert&quot;).value: </span><br><span class="line">              execute_action(name(receiver), name(code), &amp;addressbook::upsert); </span><br><span class="line">              break;</span><br><span class="line">            case name(&quot;notify&quot;).value: </span><br><span class="line">              execute_action(name(receiver), name(code), &amp;addressbook::notify); </span><br><span class="line">              break;</span><br><span class="line">            case name(&quot;erase&quot;).value: </span><br><span class="line">              execute_action(name(receiver), name(code), &amp;addressbook::erase); </span><br><span class="line">              break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h4><ol>
<li>此次合约部署在kylin上的shaokun11114账号上可以看到我们也完美实现了数据增加和删除</li>
</ol>
<p><img src="/img_eos1/eos_react8.gif" alt="shaokun"></p>
<ol start="2">
<li>去kylin查看结果,可以看到我们得交易记录,其中的notify也可以看到,说明apply函数正常使用</li>
</ol>
<p><img src="/img_eos1/eos15.png" alt="shaokun"></p>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-dispatcher-01" target="_blank" rel="noopener">源码</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>这就完了?当然没有,这篇文章只是简单的和大家一起走走官网的dispatcher,当然还没有走完,如果只是这样写了能够实现功能那和用eos提供的宏没什么区别了呢</li>
<li>我建议各位同学接触到错误不要慌,也不要急,各位可以先自己看看报错误的信息提示,可以把这个粘贴到Google上找一下答案,这样自己找寻到的答案记忆会深刻许多</li>
<li>接下来将我进一步跟着官网走,把剩下的一点点讲明白,而这才是dispatcher的真正用法呢.可以解决文章开头提到的payable的问题呢</li>
<li>谢谢大家的浏览,希望有发现错误的同学可以加上我微信帮我指出来,再次感谢.</li>
</ol>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#x33;&#46;&#x63;&#111;&#x6d;" target="_blank" rel="noopener">&#115;&#x6b;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#x33;&#46;&#x63;&#111;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/08/eos中inline action的理解3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/08/eos中inline action的理解3/" itemprop="url">eos中inline action的使用方式 (续)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-08T11:47:24+08:00">
                2018-12-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h4><p> 这里填一个一直以来对于我来说的一个坑,也在之前的文章的文章误导了大家关于这个event.   </p>
<ol>
<li>之前我说以太坊区块链会主动通知我们当有数据发生变化,这是经过几天的琢磨发现使用了web3.js库造成的错觉.</li>
<li>也正是由于这样,我没有在eos中找到类似的方法,所以去看看了web3.js的源码,发现它是才用轮询最新区块的内容而进行的事件的匹配然后产生的回调.  </li>
<li><p><a href="https://github.com/ethereum/web3.js/blob/develop/lib/web3/requestmanager.js" target="_blank" rel="noopener">requestmanager.js</a>,如果你感兴趣,可以看看这个文件就大概知道了,更加进一步,你可以发现一些更有趣并且非常熟悉的东西,那就是在<a href="https://github.com/ethereum/web3.js/blob/develop/lib/web3/methods/eth.js" target="_blank" rel="noopener">methods.js</a>这个文件中 </p>
</li>
<li><p>这是web3提供的方法,既然这样,那我们是不是不调用web3的方法也可以得到同样的效果呢?答案肯定是可以的.通过以上的两个文件,那我们用node也来写一个监听最新块的方法</p>
<pre><code>const axios = require(&apos;axios&apos;)
const obj = { &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;eth_getBlockByNumber&quot;, &quot;params&quot;: [&quot;latest&quot;, true], &quot;id&quot;: 1 }

getBlockInfo()

function getBlockInfo() {
    axios.request(&apos;https://mainnet.infura.io/v3/e8947e207ac142519554d382200e663b&apos;, {
        method: &apos;post&apos;,
        header: {
            &apos;Content-type&apos;: &apos;application/json&apos;
        },
        data: JSON.stringify(obj)
    }).then(response =&gt; response.data).then(res =&gt; {
            console.log(res)
        })
}
</code></pre></li>
<li>上面的方式可以监听到最新一个块的所有交易信息,然后根据条件筛选即可达到我们要的目的了.这里注意两点:一是json-rpc的请求格式,二是json-rpc提供的endpoint,我这里使用的是infrua提供的.其实metamask也是使用的这个端点,所以使用web3的时候会让你提供provider,其实就是提供的这个端点</li>
</ol>
<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>填完坑后,给出个结论   </p>
</blockquote>
<blockquote>
<ul>
<li>区块链从来不会主动推送消息给各位同学的</li>
<li>所有的数据都是在区块里面的,只要在区块链发生的所有操作,均可以通过查询区块得到结果.</li>
<li>至于web3或者是其他库提供的监听的功能,实际上是封装了这个轮询的过程</li>
</ul>
</blockquote>
<blockquote>
<p>本篇文章还是属于inline action的范畴.就是如何在合约中进行eos的交易</p>
</blockquote>
<h4 id="在合约中交易eos"><a href="#在合约中交易eos" class="headerlink" title="在合约中交易eos"></a>在合约中交易eos</h4><ol>
<li><p>直接调用eosjs提供的api,这种方式比较简单,也不是我要说的重点(这里使用的是scatter官网提供的这个例子)</p>
<pre><code>const transactionOptions = { authorization:[`${account.name}@${account.authority}`] };

    eos.transfer(account.name, &apos;helloworld&apos;, &apos;1.0000 EOS&apos;, &apos;memo&apos;, transactionOptions).then(trx =&gt; {
        // That&apos;s it!
        console.log(`Transaction ID: ${trx.transaction_id}`);
    }).catch(error =&gt; {
        console.error(error);
    });
</code></pre></li>
<li><p>这里有一种需求,就是在执行某个action的时候,需要预先支付一定费用的eos,当达到某种条件时候,再返回给调用者一定的量的eos.</p>
</li>
<li>根据需求我们写出了如下的代码,(注意asset这个类型,必须这样传入,关于它的更详细的用法得去看看api了哈;二是now()这个函数返回当前的时间戳,真实环境中这都是固定的,不能用来产生随机数).</li>
<li>还记得之前的权限操作吗? 如果要在合约中转账,必须给合约添加eosio.code的权限,我这个合约现在部署在shaokun11113中的,那么就要给shaokun11113添加eosio.code权限.</li>
<li>添加了权限之后,我们使用shaokun11112来调用这个合约,可以看到当shaokun11113向shaokun11112转账可以成功,但是shaokun11112向shaokun11113转账是没有权限的.</li>
<li>那么,我们在shaokun11112中给shaokun11113添加eosio.code的权限</li>
<li>添加权限后,可以看到一切转账成功了</li>
<li>那么就实现了在合约中进行transfer eos的操作</li>
</ol>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;
#include &lt;eosiolib/asset.hpp&gt;    
using namespace eosio;

class [[eosio::contract]] lucky : eosio::contract {

public:
    using contract::contract;
    lucky(name r,name c, datastream&lt;const char*&gt; ds):contract(r,c,ds){}

[[eosio::action]]
void play(name player, const asset&amp; quantity) {
    require_auth(player);
    if(now() % 2 == 1){
        action(
    permission_level{get_self(),&quot;active&quot;_n},  //所需要的权限结构
    &quot;eosio.token&quot;_n,                          // 调用的合约名称
    &quot;transfer&quot;_n,                              // 合约的方法
    std::make_tuple(get_self(),player, quantity, std::string(&quot;shao kun game&quot;)) // 传递的参数
        ).send();
    } else {
        action(
        permission_level{player,&quot;active&quot;_n},
        &quot;eosio.token&quot;_n,
        &quot;transfer&quot;_n,
        std::make_tuple(player,get_self(), quantity, std::string(&quot;shao kun game&quot;))
        ).send();
    }
};
};
EOSIO_DISPATCH(lucky,(play))
</code></pre><p><img src="/eosinline/inline3.gif" alt="shaokun"></p>
<h4 id="以太坊中eth使用合约进行交易"><a href="#以太坊中eth使用合约进行交易" class="headerlink" title="以太坊中eth使用合约进行交易"></a>以太坊中eth使用合约进行交易</h4><ul>
<li>在以太坊中,如果某个方法要接收eth,必须给这个方法加上payable的关键字即可,合约中可以通过msg.value获取到交易的金额.如果此方法不加上payable而调用时传递了金额,那么调用此方法会失败  </li>
<li><p>如果要在初始化的时候传入eth,必须给构造方法加上payable</p>
<pre><code>contract Test4 {

constructor() public payable {

}

function withPayable() public payable {
    if(now % 2 == 0 ){
        msg.sender.transfer(msg.value * 2);
    }
}

 function withoutPayable() public {

 }
}
</code></pre><p><img src="/eosinline/inline4.gif" alt="shaokun"></p>
</li>
</ul>
<h4 id="源码与总结"><a href="#源码与总结" class="headerlink" title="源码与总结"></a>源码与总结</h4><ul>
<li><a href="https://github.com/shaokun11/eosabout/tree/eos-transfer" target="_blank" rel="noopener">合约transfer</a></li>
<li>相对于eth来说,个人觉得eos中在合约中转账过于麻烦,这需要用户手动去给合约设置转账权限</li>
<li>如果哪位同学有更好的关于转账的方法,请告知一下,个人觉得在合约中进行转账还是很常见的需求</li>
<li>官方的eos dice合约现在已经移除了,但是可以在历史中找到<a href="https://github.com/EOSIO/eos/blob/v1.0.0/contracts/dice/dice.cpp" target="_blank" rel="noopener">eos dice</a> 有兴趣的同学可以研究一下</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。<br>email: <a href="mailto:&#115;&#107;&#x75;&#110;&#110;&#121;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#109;" target="_blank" rel="noopener">&#115;&#107;&#x75;&#110;&#110;&#121;&#64;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/01/eos中inline action的理解2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/01/eos中inline action的理解2/" itemprop="url">eos中inline action的使用方式 (下)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-01T09:34:33+08:00">
                2018-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><ul>
<li>关于上一篇的inline action关于作为log的用法,我觉得这是其一,其二是可以action调用action,这样的话应该也算作action的第二种用法了吧  </li>
<li>本篇文章介绍inline action的第三种用户,外部合约的调用  </li>
<li>记住一点,这些调用都是在一个事务中进行的,所以可以放心大胆的使用</li>
<li>由于eos的体系,需要你完全明白eos中 account 和permission level这两个东东的作用,不然理解起来会有点困难</li>
</ul>
<h4 id="据说"><a href="#据说" class="headerlink" title="据说"></a>据说</h4><ul>
<li>听说BM又要离开eos了,我觉得无所谓了,毕竟eos是开源的,很多人维护的</li>
<li>eos1.5发布了,是不是又得跟上步伐呢?感觉学不动了</li>
<li><a href="https://mp.weixin.qq.com/s/IovpLgfvcWhu3L3tGbKiZg" target="_blank" rel="noopener">js4eos介绍</a>这工具可以简化一些工作,喜欢的同学可以试试<a href="https://github.com/itleaks/js4eos" target="_blank" rel="noopener">js4eos github</a> </li>
</ul>
<h4 id="eos中inline-action-结果展示与说明"><a href="#eos中inline-action-结果展示与说明" class="headerlink" title="eos中inline action 结果展示与说明"></a>eos中inline action 结果展示与说明</h4><ul>
<li>这里官方的例子合约(cpp文件)和账户名字是一样的,让我困扰了一会,这里给大家一个结论就好:一个账户就只能部署一个合约,而这个合约的名字就是get_self(),当你部署合约的时候,就是账号的名字了.在写line action的时候不要弄混了</li>
<li>使用shaokun11111部署合约 addressbook</li>
<li>使用shaokun11112部署合约 adcounter</li>
<li>在addressbook中使用inline action调用adcounter中的count方法</li>
<li>这样设置后,多个合约就可以相互调用了</li>
<li>关键点,如果要actor shaokun11111能够拥有调用其他合约的权限,必须给shaokun11111账号授予权限eosio.code,这是个系统的权限.</li>
</ul>
<pre><code>cleos -u https://api-kylin.eosasia.one:443 set account permission shaokun11111 active &apos;{&quot;threshold&quot;:1,&quot;keys&quot;:[{&quot;key&quot;:&quot;EOS5694dNS19CXwNMgQ3nd8eVG4gnqcihdstnmsChM8AdHNaDCC82&quot;,&quot;weight&quot;:1}],&quot;accounts&quot;:[{&quot;permission&quot;:{&quot;actor&quot;:&quot;shaokun11111&quot;,&quot;permission&quot;:&quot;eosio.code&quot;}}]}&apos; -p shaokun11111@owner
</code></pre><ul>
<li>关于permission的格式可以参考我以前的文章,注意这里使用的owner权限</li>
<li><code>EOS5694dNS19CXwNMgQ3nd8eVG4gnqcihdstnmsChM8AdHNaDCC82</code> 这个是原来创建账号的权限的public key,当然按照上面的写法,这样其实可以更改原来账号的active的权限,建议保持原来权限创建的形式就好</li>
<li>授权成功后,账号应该有如图中的显示</li>
<li><img src="/eospermission/per1.png" alt="shaokun"></li>
<li><img src="/eospermission/per3.gif" alt="shaokun"></li>
</ul>
<h4 id="eth中合约相互调用"><a href="#eth中合约相互调用" class="headerlink" title="eth中合约相互调用"></a>eth中合约相互调用</h4><blockquote>
<p>如果你理解了eos合约的相互调用,那么接下来eth中的合约相互调用你应该很好理解了<br>个人看来两者的机制大同小异,因为eth中是以address中作为id的,而eos中是以account做为id的</p>
</blockquote>
<ul>
<li>基于上篇文章的eth合约,我们稍加改造一下</li>
<li>新添加了一个合约 Test3,其中我们将Test2的合约地址用来实例化了Service</li>
<li>这个Service中需要包含Test2合约中你需要调用的方法的签名(这里关于是怎样找到的可以去看看官方文档,其实  <code>function notify(string _notification) external;</code> 就是这个函数的签名,包括方法名字和参数类型,返回值类型hash后 取了四个字节)</li>
<li>部署Test3合约,部署成功后再Test3合约中的callNotify调用Test2合约中的notify方法,可以看到Test合约中的内容生效了</li>
<li>这里有同学可能有疑问了,你这样的合约岂不是没有安全?拿到Test2合约地址,任何人新建一个合约就可以调用其合约的方法?是的,理论上是这样的.但是,凡事都有个但是哈.还记得我在之前的文章中关于eth中的权限如果验证吗?如果你看了那篇文章,那聪明的你一定知道该怎么做了哈  </li>
<li><img src="/eospermission/per4.gif" alt="shaokun"></li>
</ul>
<h4 id="源码献上"><a href="#源码献上" class="headerlink" title="源码献上"></a>源码献上</h4><blockquote>
<p><code>addressbook.cpp</code>,没什么说的,注意写法,变化的部分如果你认真阅读了应该知道变化在哪里</p>
</blockquote>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;
#include &lt;eosiolib/print.hpp&gt;

using namespace eosio;

class [[eosio::contract]] addressbook : public eosio::contract {
public:
    using contract::contract;
    addressbook(name reciever, name code, datastream&lt;const char*&gt; ds) : contract(reciever,code,ds){}

    [[eosio::action]]
    void upsert(name user, std::string first_name, uint64_t age){
        require_auth(user);
        address_index addresses(_code,_code.value);
        auto itr = addresses.find(user.value);
        if(itr == addresses.end()){
            addresses.emplace(user,[&amp;](auto&amp; row){
                row.key = user;
                row.first_name = first_name;
                row.age = age;
            });
            send_summary(user, &quot;emplace data&quot;);
            counter(user,&quot;emplace&quot;);
        } else {
            addresses.modify(itr, user, [&amp;](auto&amp; row){
                        row.first_name = first_name;
                        row.age = age;
            });
            send_summary(user, &quot;modify data&quot;);
            counter(user,&quot;modify&quot;);
        }
    }

    [[eosio::action]]
    void erase(name user){
        require_auth(user);
        address_index addresses(_self, _code.value);
        auto itr = addresses.find(user.value);
        eosio_assert(itr != addresses.end(),&quot;record not exist&quot;);
        addresses.erase(itr);
        // 调用inline action
        send_summary(user, &quot; erase data&quot;);
        counter(user,&quot;erase&quot;);
    }

    [[eosio::action]]
    void notify(name user, std::string){
        // inline action
        require_auth(get_self());
        require_recipient(user);
    }

private:
    struct [[eosio::table]] person {
        name key;
        std::string first_name;
        uint64_t age;

        auto primary_key() const {
            return key.value;
        };
    };
    typedef multi_index&lt;&quot;person&quot;_n, person&gt; address_index;

    // inline action的具体实现
    void send_summary(name user, std::string msg){
        action(
            permission_level{get_self(),&quot;active&quot;_n},
                get_self(),
                &quot;notify&quot;_n,
                std::make_tuple(user, name{user}.to_string() +msg)
            ).send();
    }
    void counter(name user, std::string type){
        action counter = action(
            permission_level{get_self(),&quot;active&quot;_n},// 执行这个inline aciton所需要的权限,即本合约调用
            &quot;shaokun11112&quot;_n,                       // 账号名称
            &quot;count&quot;_n,                              // action 名称
            std::make_tuple(user,type)              // 传递的参数
            );
        counter.send();
    }
};
EOSIO_DISPATCH(addressbook,(upsert)(erase))
</code></pre><blockquote>
<p><code>adcounter.cpp</code> 注意其中的权限验证部分,其他没什么好说的</p>
</blockquote>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;

using namespace eosio;

class [[eosio::contract]] adcounter: public eosio::contract {
public:
    using contract::contract;
    adcounter(name receiver, name code, datastream&lt;const char*&gt; ds):contract(receiver,code,ds),
                                                                    counts(receiver,code.value){}

    void count(name user, std::string type) {
        // 设定这个方法的调用权限
        // 只有 shaokun11111 这个账号部署的合约有这个权限更改这个合约的内容
        require_auth(name(&quot;shaokun11111&quot;));
        auto itr = counts.find(user.value);
        if(itr == counts.end()){
            counts.emplace(&quot;shaokun11111&quot;_n, [&amp;](auto&amp; row){
                row.key = user;
                row.emplaced = type == &quot;emplace&quot; ? 1 : 0;
                row.modified = type == &quot;modify&quot; ? 1 : 0;
                row.erased = type == &quot;erase&quot; ? 1 : 0;
            });
        } else {
            counts.modify(itr,&quot;shaokun11111&quot;_n,[&amp;](auto&amp; row){
                if (type == &quot;emplace&quot;)
                {
                    row.emplaced += 1;
                }
                if (type == &quot;modify&quot;)
                {
                    row.modified += 1;
                }
                if (type == &quot;erase&quot;)
                {
                    row.erased += 1;
                }
            });
        }
    }
private:
    struct [[eosio::table]] counter
    {
        name key;
        uint64_t emplaced;
        uint64_t modified;
        uint64_t erased;

        uint64_t primary_key() const {return key.value;}
    };

    typedef eosio::multi_index&lt;&quot;counter&quot;_n,counter&gt; counter_index;
    counter_index counts;
};
EOSIO_DISPATCH(adcounter,(count));
</code></pre><p>前端代码就不展示了,因为所有的操作都是在addressbook这个合约中进行操作的,adcounter只是展示了合约中的记录<br><a href="https://github.com/shaokun11/eosabout/tree/eos-inline-action2" target="_blank" rel="noopener">本课源码</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>建议各位同学一定要仔细敲一遍,虽然例子简单,但是再复杂的内容也是由这些简单的例子所产生的</li>
<li>eos inline action的作用已经说完了.这样掌握之后,就可以写很多合约,壮大你的dapp了.inline action很重要的一点 是可以回滚交易,好好利用,发挥意想不到的作用</li>
<li>话说还有个deferred action,有时间再和大家分享一下这货是怎使用了</li>
<li>dapp的开发不仅仅是写合约,目前主要应用还是在web上.所以建议各位同学还是得了解一下js,node,webpack,react,css这些基础的概念和用法吧.不要多熟练,大概了解一下怎么用就好了</li>
<li>还有一点,哪位同学知道eos中有类似eth中的event的功能,即合约主动推送信息给我们,我觉得这很重要.我觉得eosjs应该提供类似的功能呢.知道的同学麻烦告知一声</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#107;&#117;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x73;&#107;&#117;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#111;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shaokun</p>
              <p class="site-description motion-element" itemprop="description">记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shaokun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
 <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
