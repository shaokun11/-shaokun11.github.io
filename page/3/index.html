<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta name="keywords" content="eos,eth,tron,区块链">
<meta property="og:type" content="website">
<meta property="og:title" content="hello shaokun">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="hello shaokun">
<meta property="og:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hello shaokun">
<meta name="twitter:description" content="记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>hello shaokun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hello shaokun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">code is law</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/25/eos中inline action的理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/25/eos中inline action的理解/" itemprop="url">eos中inline action的使用方式 (上)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-25T20:03:05+08:00">
                2018-11-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>eos中有两种action,一种是本文要带大家理解使用的inline action,一种deffer action.<br>关于他们的差别我觉得主要一点就是前者一定是打包在同一个块中的,而且是事务操作.</p>
</blockquote>
<h4 id="surprise"><a href="#surprise" class="headerlink" title="surprise"></a>surprise</h4><blockquote>
<ul>
<li>jungle的测试网升级到2.0了,既然升级了,应该有不少的优化吧<a href="https://monitor.jungletestnet.io/" target="_blank" rel="noopener">jugnle2.0地址</a>  </li>
<li>由于在jungle测试网遇到很多坑,所以试了试另外一个测试网<a href="https://tools.cryptokylin.io/#/tools/create" target="_blank" rel="noopener">麒麟</a>,用起来很不错,不用带梯子,建议大家在国内使用这个网络</li>
<li>在kylin创建账号和获取测试币,直接在浏览器地址栏敲进去就可以了</li>
</ul>
</blockquote>
<pre><code>http://faucet.cryptokylin.io/create_account?new_account_name
http://faucet.cryptokylin.io/get_token?your_account_name
</code></pre><h4 id="action的结果展示"><a href="#action的结果展示" class="headerlink" title="action的结果展示"></a>action的结果展示</h4><blockquote>
<ul>
<li>结果和之前的todolist内容差不多,只是多了一些额外的输出内容,而且这也是官方的例子</li>
<li>那为什么还要记录呢?第一是我学习的过程,第二是看看具体的结果,第三是部署到测试网试试</li>
<li>这里我也一些疑问?这样是否会多消耗ram? 如果不消耗,可以作为一些log的使用还是不错的,如果消耗,个人感觉没什么用,毕竟输出的每一个文字都是ram呢</li>
<li>当然,它最主要的作用是可以调用其他的合约的内容,而同时保证在一个事务中,这个下篇文章给大家展示</li>
<li>以太坊中的event有点类似本问所展示的作用,它可以监听,而且这部分log不消耗gas</li>
<li>在交互中,也顺便展示了scatter中如何切换账号的操作</li>
</ul>
</blockquote>
<p><img src="/eosinline/inline1.gif" alt="inline"></p>
<h4 id="cpp源码展示"><a href="#cpp源码展示" class="headerlink" title="cpp源码展示"></a>cpp源码展示</h4><blockquote>
<p>没什么需要多说的,注意inline action的写法</p>
</blockquote>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;    
using namespace eosio;

class [[eosio::contract]] addressbook : public eosio::contract {
public:
    using contract::contract;
    addressbook(name reciever, name code, datastream&lt;const char*&gt; ds) : contract(reciever,code,ds){}

    [[eosio::action]]
    void upsert(name user, std::string first_name, uint64_t age){
        require_auth(user);
        address_index addresses(_code,_code.value);
        auto itr = addresses.find(user.value);
        if(itr == addresses.end()){
            addresses.emplace(user,[&amp;](auto&amp; row){
                row.key = user;
                row.first_name = first_name;
                row.age = age;
            });
            send_summary(user, &quot;emplace data&quot;);
        } else {
            addresses.modify(itr, user, [&amp;](auto&amp; row){
                        row.first_name = first_name;
                        row.age = age;
            });
            send_summary(user, &quot;modify data&quot;);
        }
    }

    [[eosio::action]]
    void erase(name user){
        require_auth(user);
        address_index addresses(_self, _code.value);
        auto itr = addresses.find(user.value);
        eosio_assert(itr != addresses.end(),&quot;record not exist&quot;);
        addresses.erase(itr);
        send_summary(user, &quot;erase data&quot;);
    }

    [[eosio::action]]
    void notify(name user, std::string){
        require_auth(get_self());
        require_recipient(user);
    }

private:
    struct [[eosio::table]] person {
        name key;
        std::string first_name;
        uint64_t age;

        auto primary_key() const {
            return key.value;
        };
    };
    typedef multi_index&lt;&quot;person&quot;_n, person&gt; address_index;

    void send_summary(name user, std::string msg){
        action(
            permission_level{get_self(),&quot;active&quot;_n},
                get_self(),
                &quot;notify&quot;_n,
                std::make_tuple(user, name{user}.to_string() +msg)
            ).send();
    }
};
EOSIO_DISPATCH(addressbook,(upsert)(erase))
</code></pre><h4 id="eth中的event的使用"><a href="#eth中的event的使用" class="headerlink" title="eth中的event的使用"></a>eth中的event的使用</h4><blockquote>
<ul>
<li>eth的event可以当做log使用,而且可以单独监听.这给了极大的方便了给任何一个人或则组织想知道某个合约函数的执行情况,我觉得这是一种非常好的机制.不知道eos中有没有类似的功能.</li>
<li>也就是说合约中的信息可以主动推送给我们</li>
<li>可以看到一个简单的node七八行代码就可以监听任何一个合约的所有事件的功能,前提你得拿到这个合约的地址和abi</li>
<li>这里涉及了较多的以太坊的知识,只是为了向大家展示一下这个功能,不知道eos中目前有不有类似的功能,感觉它这个inline action即本篇文章描述的这个功能有点点类似,但是不知道能不能主动推送给我们呢?   </li>
</ul>
</blockquote>
<p><img src="/eosinline/inline2.gif" alt="inline"></p>
<h4 id="scatter遇到的一个小问题"><a href="#scatter遇到的一个小问题" class="headerlink" title="scatter遇到的一个小问题"></a>scatter遇到的一个小问题</h4><blockquote>
<ul>
<li>这里遇到了一个很纠结的问题,就是scatter无法弹出来.</li>
<li>如果有遇到的同学,请重新安装scatter那两个lib,再次感谢某位朋友帮忙  </li>
</ul>
</blockquote>
<pre><code>yarn remove eosjs scatterjs-core scatterjs-plugin-eosjs
yarn add eosjs scatterjs-core scatterjs-plugin-eosjs
</code></pre><h4 id="源码献上"><a href="#源码献上" class="headerlink" title="源码献上"></a>源码献上</h4><blockquote>
<p>这里的源码包括本篇文章演示所有的合约和js文件,涉及到了eos和eth,各位同学可以选择性使用.</p>
</blockquote>
<p><a href="https://github.com/shaokun11/eosabout/tree/eos-inline-action" target="_blank" rel="noopener">inline action的使用</a></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote>
<ul>
<li>我为什么喜欢用测试网,而且总是要带梯子? 我觉得测试网与主网的环境操作一模一样,只是换了endpoint而已.如果在测试网能够按照设想运行,那么主网只需要改变一下下即可.而梯子对于我们这行的同学来说,应该是必备的.</li>
<li>而现在用麒麟,不用梯子了哈.这点很重要</li>
<li>由于eos的交易速度很快,所以用测试网来测试完全没有任何问题.</li>
<li>这篇文章只讲解的eos的inline action的一个功能,下篇文章将使用它的更加实用的功能,而不仅仅是一个log的功能哈</li>
<li>最近公司的项目很紧,所以能不能快速把新的知识点分享给大家还是未知数了呢,如果你也对dapp开发感兴趣,可以加个微信一起探讨 ^.^</li>
<li>声明一点,我目前只对dapp的开发有点经验,至于源码分析,个人能力达不到呢.</li>
<li>eth和eos虽然实现的机制不一样,但都是区块链啊.所以学习eos的时候,当我有些地方不怎么明白,我会再回去用eth的思想来思考一下这个eos的功能怎么用,目前看来,毕竟eos个人觉得比eth上手难度大很多呢</li>
</ul>
</blockquote>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#117;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#115;&#x6b;&#117;&#110;&#x6e;&#x79;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/17/eos 权限的理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/17/eos 权限的理解/" itemprop="url">简单例子带你彻底的理解eos中的权限在dapp中如何使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-17T21:15:01+08:00">
                2018-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>相信各位同学看eos白皮书的权限看得很是头疼,而我能搜索到的例子基本上是官方的那个权限图再结合eos.token进行转账的权限介绍.如果不细心跟着走一遍,你是绝对不好理解这个权限怎么用的.由于我头脑比较笨,着实按照大佬的文章走了三四遍才大约摸索清楚,这里给自己做一个备忘录吧<br>而我站在大佬的肩膀上,结合实际的操作给大家聊聊这个权限如何使用吧.<br>这里主要参考的  </p>
<ul>
<li><a href="https://eosfans.io/topics/653" target="_blank" rel="noopener">EOS 权限管理之-权限的使用 (你绝对找不到的干货)</a>  <ul>
<li><a href="https://bihu.com/article/293974" target="_blank" rel="noopener">EOS开发系列目录</a> 松果的文章都是根据源码分析的,建议开发dapp的同学都认真读几遍吧,这样更能帮助理解eos到底是怎样运行的</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ul>
<li><p>提前在测试网上申请两个账号,并领取测试币(不知道怎么做的可以翻看我前面的文章),我这里申请了两个.  </p>
</li>
<li><p>这次使用cleos操作,就不使用scatter操作了.原理一样.所以得把申请的这两个账号的私钥导入到cleos创建的钱包里面  </p>
<pre><code>shaokun11121
Private key: 5KFoeWx69fjPj7mTDbcD9JauYd9LLjikYTa9Qg7N5CVZTqZrzNG
Public key: EOS69w5V46oUaBD5PSx3AMRxWXPi6b3St2PwbX9kBPY6tZvSs65o1

shaokun11122
Private key: 5HrJQ9eepF6FuG47eSJprxoFQ6PWRkombbWEwxoSQr6FJ1wQPbg
Public key: EOS8ZZCicammR45b9tQUSU8VHqX4M8oFM89Cs8tFFWYgUGasegnnV
</code></pre></li>
</ul>
<h4 id="以太坊权限的实现"><a href="#以太坊权限的实现" class="headerlink" title="以太坊权限的实现"></a>以太坊权限的实现</h4><blockquote>
<p>这里先给贴一段简单的以太坊的权限的管理吧,这个要自己来写,如果你有以太坊的经验,相信更加容易理解.<br>理一理:</p>
<ol>
<li>部署合约,部署完成后,owner就是部署者的地址</li>
<li>查看count的值,此时count为初始值1</li>
<li>执行add方法</li>
<li>查看count的值,此时count的值为2</li>
<li>切换address</li>
<li>执行add方法,报错,因为不是owner</li>
<li>查看count的值 还是为2</li>
<li>再次执行3,4步骤,此时count的值的值为3</li>
</ol>
</blockquote>
<p> <img src="/eospermission/per1.gif" alt="eos"></p>
<pre><code>pragma solidity ^0.4.24;

contract Ownable {
  address public owner;

  constructor() public {
    owner = msg.sender;
  }

  modifier onlyOwner() {
    require(msg.sender == owner);
    _;
  }
}
contract leranper is Ownable {

    uint256 public count = 1;

    function add() external onlyOwner  {
       count += 1;
    }
}
</code></pre><h4 id="eos的权限的实现"><a href="#eos的权限的实现" class="headerlink" title="eos的权限的实现"></a>eos的权限的实现</h4><blockquote>
<p>eos的权限不需要写到合约中,底层已经帮我们实现了,我们只需要进行相应的设置即可,以下是设置权限的签名.至于设置的各个参数怎么设置,怎么用,可以看看官方文档吧</p>
</blockquote>
<pre><code>Usage: cleos set account permission [OPTIONS] account permission authority [parent]

Positionals:
  account TEXT                The account to set/delete a permission authority for (required)
  permission TEXT             The permission name to set/delete an authority for (required)
  authority TEXT              [delete] NULL, [create/update] public key, JSON string, or filename defining the authority (required)
  parent TEXT                 [create] The permission name of this parents permission (Defaults to: &quot;Active&quot;)
</code></pre><p>方法1:使用account设置  </p>
<pre><code>cleos set account permission shaokun11121 add &apos;{&quot;threshold&quot;:1,&quot;keys&quot;:[],&quot;accounts&quot;:[{&quot;permission&quot;:{&quot;actor&quot;:&quot;shaokun11122&quot;,&quot;permission&quot;:&quot;active&quot;},&quot;weight&quot;:1}]}&apos;
</code></pre><p>方法二:使用public key进行设置</p>
<pre><code>cleos set account permission shaokun11121 add &apos;{&quot;threshold&quot;:1,&quot;keys&quot;:[{&quot;permission&quot;:{&quot;key&quot;:&quot;EOS8ZZCicammR45b9tQUSU8VHqX4M8oFM89Cs8tFFWYgUGasegnnV&quot;,&quot;permission&quot;:&quot;active&quot;},&quot;weight&quot;:1}]}&apos;  
</code></pre><p>当然你可以把两种设置方式都用上,根据个人习惯设定就好,</p>
<blockquote>
<p>这里建议后面的permission这段,先使用ide写上正确的json格式.然后在<a href="http://www.bejson.com/" target="_blank" rel="noopener">json格式压缩</a>进行压缩成一行,这样可以避免不必要的麻烦</p>
</blockquote>
<pre><code>    {
    &quot;threshold&quot;: 1,
    &quot;keys&quot;: [],
    &quot;accounts&quot;: [
        {
            &quot;permission&quot;: {
                &quot;actor&quot;: &quot;kun2&quot;,
                &quot;permission&quot;: &quot;active&quot;
            },
            &quot;weight&quot;: 1
        }
    ]
}
</code></pre><h4 id="eos的权限的解读"><a href="#eos的权限的解读" class="headerlink" title="eos的权限的解读"></a>eos的权限的解读</h4><ul>
<li>当按照上述方式设置好后,可以通过此命令查看设置的权限,注意看这里permissions里多了一个add权限 这个权限的名字是 add,阀值是1 权限值 是1 ,父权限是active. </li>
<li>这样设置后,也就是说 只要是active shaokun11121的active的权限能够执行的操作,使用shaokun11122的密钥生成的账户的active权限均能做</li>
<li>一个私钥与一个公钥是一一对应,而这一对钥匙可以作为一个或者多个account中的权限级别</li>
<li><p>当然你也可以按照上述的方式多设置几个权限看看,它的形式就像Windows的目录展示的形式,很好辨认的</p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888  get account shaokun11121
</code></pre></li>
</ul>
<p>查看的结果  </p>
<pre><code>bogon:libraries shaokun$ cleos -u http://jungle.cryptolions.io:18888  get account shaokun11121
created: 2018-11-17T12:46:30.000
permissions: 
     owner     1:    1 EOS69w5V46oUaBD5PSx3AMRxWXPi6b3St2PwbX9kBPY6tZvSs65o1
        active     1:    1 EOS69w5V46oUaBD5PSx3AMRxWXPi6b3St2PwbX9kBPY6tZvSs65o1
           add     1:    1 shaokun11122@active
memory: 
     quota:     260.1 KiB    used:     95.82 KiB  

net bandwidth: 
     staked:        100.0000 EOS           (total stake delegated from account to self)
     delegated:       0.0000 EOS           (total staked delegated to account from others)
     used:             5.534 KiB  
     available:        18.23 MiB  
     limit:            18.24 MiB  

cpu bandwidth:
     staked:        100.0000 EOS           (total stake delegated from account to self)
     delegated:       0.0000 EOS           (total staked delegated to account from others)
     used:             9.367 ms   
     available:        3.629 sec  
     limit:            3.639 sec  

EOS balances: 
     liquid:           80.1129 EOS
     staked:          200.0000 EOS
     unstaking:         0.0000 EOS
     total:           280.1129 EOS

producers:     &lt;not voted&gt;
</code></pre><h4 id="eos权限的使用"><a href="#eos权限的使用" class="headerlink" title="eos权限的使用"></a>eos权限的使用</h4><blockquote>
<p>上述方法给shaokun11121设置了一个add的权限,得添加到具体的action上才能体现出这个价值.目前能够搜到的文章都是加载 transfer这个操作上面的.为什么呢? 因为有了这个权,就可以不用登陆shaokun11121转账了,直接使用shaokun11122转账了.</p>
</blockquote>
<ul>
<li><p>权限签名 </p>
<pre><code>Positionals:
  account TEXT                The account to set/delete a permission authority for (required)
  code TEXT                   The account that owns the code for the action (required)
  type TEXT                   the type of the action (required)
  requirement TEXT            [delete] NULL, [set/update] The permission name require for executing the given action (required)
</code></pre></li>
<li><p>给shaokun11121 add action和add 权限关联起来,这样只要是shaokun111121的合约中有add action,那么使用shaokun11122的add权限均可以调用.根据我的测试,一个account目前只能部署一个智能合约,所以这个add方法是唯一的</p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888  set action permission shaokun11121 shaokun11121 add add
</code></pre></li>
</ul>
<h4 id="eos权限合约的编写"><a href="#eos权限合约的编写" class="headerlink" title="eos权限合约的编写"></a>eos权限合约的编写</h4><blockquote>
<p>合约编写很简单,就是helloworld,注意其中的权限验证那一行,也就是说,只有自己的account 才能添加或者更新自己的这条信息</p>
</blockquote>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;

using namespace eosio;

class [[eosio::contract]] learnper2 : public contract {
  public:
    using contract::contract;
    learnper2(eosio::name reciever,eosio::name code,eosio::datastream&lt;const char*&gt; ds )
                              :contract(reciever,code,ds),
                              _students(reciever,code.value){};

    [[eosio::action]]
    void add(name user, const std::string msg) {
      require_auth(user); // 权限额验证 
      auto itr = _students.find(user.value);
      if (itr == _students.end()){
        _students.emplace(get_self(),[&amp;](auto&amp; row){
          row.user = user;
          row.msg = msg;
        });
      } else {
        _students.modify(itr, get_self(), [&amp;](auto&amp; row){
          row.msg = msg;
        });
      }
    };


  private:
  struct [[eosio::table]] student 
  {
    name user;
    std::string msg = &quot;hello world&quot;;
    uint64_t primary_key() const {return user.value;};

  };
  typedef eosio::multi_index&lt;&quot;student&quot;_n, student&gt; student_index;
  student_index _students; 
};
EOSIO_DISPATCH( learnper2, (add))
</code></pre><h4 id="eos权限合约的编译-部署"><a href="#eos权限合约的编译-部署" class="headerlink" title="eos权限合约的编译,部署"></a>eos权限合约的编译,部署</h4><ul>
<li><p>编译:这里有个小插曲,放合约cpp文件的文件夹貌似必须命名和主合约的文件名一致,生成的abi里面没有内容,这着实也困扰了我一会</p>
<p>  eosio-cpp -abigen learnper2.cpp learnper2.wasm</p>
</li>
<li><p>这里部署合约一般需要购买ram  </p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888  system buyram shaokun11121 shaokun11121 -k 256
</code></pre></li>
<li><p>部署:  </p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888 set contract shaokun11121 ./learnper2/ -p shaokun11121@active
</code></pre></li>
</ul>
<h4 id="eos权限合约结果展示"><a href="#eos权限合约结果展示" class="headerlink" title="eos权限合约结果展示"></a>eos权限合约结果展示</h4><p><img src="/eospermission/per2.gif" alt="eos"></p>
<blockquote>
<p>这里说一下我的操作流程</p>
</blockquote>
<ul>
<li>调用合约的add action 插入一条信息(我这里之前插入信息,故此步未进行演示)  </li>
<li>首先查看了 shaokun11121的 account信息,可以看到添加了一条add的permission</li>
<li>再次查看了 shaokun11122的account信息,正常状态,只要你新建一个account都是这样的</li>
<li>查看了钱包里面的信息,这里显示的是shaokun11122的公钥(大家可以仔细对比一下)</li>
<li>查看链上table的数据</li>
<li><p>修改数据,我们仔细来分析这条命令  </p>
<blockquote>
<ol>
<li>这里使用的传入的user是shaokun11121</li>
<li>传入的permission是 shaokun111121的add这个permission,各位同学可以回想一下之前的合约,调用都是是用的active</li>
<li>钱包中并没有shaokun11121的私钥</li>
<li>钱包中占有shaokun11122的私钥  </li>
</ol>
</blockquote>
</li>
<li><p>再次展示数据,数据修改成功  </p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888  push action shaokun11121 add &apos;{&quot;user&quot;:&quot;shaokun11121&quot;,&quot;msg&quot;:&quot;i am shaokun&quot;}&apos; -p shaokun11121@add
</code></pre></li>
</ul>
<h4 id="eos权限使用心得"><a href="#eos权限使用心得" class="headerlink" title="eos权限使用心得"></a>eos权限使用心得</h4><blockquote>
<ul>
<li>这里只是展示的单个权限的使用在dapp中怎么使用   </li>
<li>如果只看白皮书还是很难理解的,建议通过实际的操作,加深理解吧  </li>
</ul>
</blockquote>
<h4 id="eos权限的进一步思考"><a href="#eos权限的进一步思考" class="headerlink" title="eos权限的进一步思考"></a>eos权限的进一步思考</h4><blockquote>
<ul>
<li>以太坊和eos的多重权限的签名目前我还没遇到过在dapp中实际使用的例子,官方的例子就是基本上是转账需要多个人同意,那么在dapp中如何使用呢?</li>
<li>本课程只展示了阀值为1,权限值为1的active权限,那么如果按照官方例子,如果阈值为2,同时需要两个权限值都为1的账号的active权限来进行某个action的执行呢? </li>
<li>接上一条,如果需要的不是active权限,比如本课中的add权限呢?</li>
</ul>
</blockquote>
<p><a href="https://github.com/shaokun11/eos-permission" target="_blank" rel="noopener">本课源码</a></p>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#x75;&#x6e;&#110;&#121;&#x40;&#x31;&#54;&#x33;&#x2e;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#115;&#x6b;&#x75;&#x6e;&#110;&#121;&#x40;&#x31;&#54;&#x33;&#x2e;&#99;&#111;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/15/基于eos连接scatter开发dapp(下) 续/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/15/基于eos连接scatter开发dapp(下) 续/" itemprop="url">结合scatter 学习eos dapp开发，看这篇就够了（下）续</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-15T20:38:55+08:00">
                2018-11-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="eos智能合约开发-前言"><a href="#eos智能合约开发-前言" class="headerlink" title="eos智能合约开发 前言"></a>eos智能合约开发 前言</h4><p>[学习eos dapp开发，看这篇就够了（下)]<br>(<a href="https://shaokun11.github.io/2018/10/14/%E5%9F%BA%E4%BA%8Eeos%E8%BF%9E%E6%8E%A5scatter%E5%BC%80%E5%8F%91dapp(%E4%B8%8B)" target="_blank" rel="noopener">https://shaokun11.github.io/2018/10/14/%E5%9F%BA%E4%BA%8Eeos%E8%BF%9E%E6%8E%A5scatter%E5%BC%80%E5%8F%91dapp(%E4%B8%8B)</a>)</p>
<blockquote>
<p>因为有阅读上面这篇文章的同学没看到源码，而我又把之前的源码给删掉了。那我也只好按照我的教程重新写一遍了。本以为copy后就能用，而当时写的时候所使用的旧版的语法，所以改了改，功能不变。<br>本篇文章的代码是使用的cdt1.3.2编译的</p>
</blockquote>
<h4 id="eos智能合约开发-结果展示"><a href="#eos智能合约开发-结果展示" class="headerlink" title="eos智能合约开发 结果展示"></a>eos智能合约开发 结果展示</h4><blockquote>
<p>功能有添加todo,删除todo,和完成todo，具体看图  </p>
</blockquote>
<p><img src="/img_eos1/eos_react7.gif" alt="scatter"></p>
<h4 id="eos智能合约开发-源码展示"><a href="#eos智能合约开发-源码展示" class="headerlink" title="eos智能合约开发 源码展示"></a>eos智能合约开发 源码展示</h4><blockquote>
<p>这就是最简单的页面了，希望你阅读起来不会有任何问题，项目你直接clone下来可以直接运行的  </p>
</blockquote>
<p><a href="https://github.com/shaokun11/eos-todolist" target="_blank" rel="noopener">学习eos dapp开发，看这篇就够了（下）续 源码</a></p>
<p><code>App.js</code></p>
<pre><code>import React, { Component } from &apos;react&apos;;
import &apos;./App.css&apos;;
import ScatterJS from &apos;scatterjs-core&apos;;
import ScatterEOS from &apos;scatterjs-plugin-eosjs&apos;;
import Eos from &apos;eosjs&apos;;

ScatterJS.plugins( new ScatterEOS());


const network = {
    blockchain:&apos;eos&apos;,
    protocol:&apos;http&apos;,
    host:&apos;jungle.cryptolions.io&apos;,
    port:18888,
    chainId:&apos;038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca&apos;
}

class App extends Component {

   state = {
       deleteId:1,
       rows:[],
       competedId:1,
       scatter:null
  }

    componentDidMount() {
        setTimeout(() =&gt; {
            this.init()
        }, 2000)
    }

    takeAction(action,params){
       console.log(action,params)
        const requiredFields = { accounts:[network] };
        this.state.scatter.getIdentity(requiredFields).then(() =&gt; {
            const account = this.state.scatter.identity.accounts.find(x =&gt; x.blockchain === &apos;eos&apos;);
            console.log(account)
            const eosOptions = { expireInSeconds:60 };
            const eos = this.state.scatter.eos(network,Eos,eosOptions);
            const transactionOptions = { authorization:[`${account.name}@${account.authority}`] };
             eos.contract(&quot;shaokun11113&quot;).then(ins =&gt; {
                return ins[action](account.name, ...params, transactionOptions)
            }).then(res =&gt; {
                console.log(res);
            }).catch(error =&gt; {
                console.error(error);
            });

        }).catch(error =&gt; {
            console.error(&quot;tack action&quot;,error);
        });
    }

    init() {
        ScatterJS.scatter.connect(&apos;todolist&apos;).then(connected =&gt; {
            if(!connected) return false;

            const scatter = ScatterJS.scatter;
            this.setState({
                scatter
            });
            alert(&quot;scatter load success&quot;)
        }).then(err=&gt;{
          console.log(err)
        });
    }

    showTodo(){
        this.state.scatter.eos(network,Eos).getTableRows({code: &quot;shaokun11113&quot;, scope: &quot;shaokun11113&quot;,table: &quot;tood&quot;, json: true})
        .then(res=&gt;{
            this.setState({
                rows:res.rows
            })
        })
    }

    render() {
    return (
        &lt;div&gt;

            &lt;div&gt;
                &lt;button onClick={() =&gt; {
                    const num = Math.floor(Math.random() * 100000);
                    this.takeAction(&quot;create&quot;,[num,&quot;this is number &quot;+num])
                }}&gt;create todo&lt;/button&gt;
                &lt;button onClick={() =&gt; this.takeAction(&quot;destroy&quot;,[this.state.deleteId])}&gt;destroy todo&lt;/button&gt;
                &lt;input type=&quot;text&quot; onChange={e =&gt; {
                    this.setState({
                        deleteId: Number.parseInt(e.target.value)
                    })
                }}/&gt;

                &lt;button onClick={() =&gt; this.takeAction(&quot;complete&quot;,[this.state.competedId])}&gt;complete todo&lt;/button&gt;
                &lt;input type=&quot;text&quot; onChange={e =&gt; {
                    this.setState({
                        competedId: Number.parseInt(e.target.value)
                    })
                }}/&gt;
                &lt;button onClick={() =&gt; this.showTodo()}&gt;show todo&lt;/button&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;p&gt;below is data&lt;/p&gt;
                &lt;ul&gt;
                    {
                        this.state.rows.map((todo, index) =&gt; {
                            return &lt;li key={index}&gt;
                                &lt;p&gt;id : {todo.id}&lt;/p&gt;
                                &lt;p&gt;description : {todo.description}&lt;/p&gt;
                                &lt;p&gt;completed : {todo.completed}&lt;/p&gt;
                            &lt;/li&gt;
                        })
                    }
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    );
  }
}

export default App;
</code></pre><p><code>todolist.cpp</code></p>
<pre><code>include &lt;eosiolib/eosio.hpp&gt;  

using namespace std;

class [[eosio::contract]] todolist : public eosio::contract {  
  public:

  todolist(eosio::name reciever, eosio::name code, eosio::datastream&lt;const char*&gt; ds)
                                                        :contract(reciever,code,ds),
                                                         todos(reciever,code.value){};   


  [[eosio::action]]   
  void create(eosio::name author, const uint32_t id, const string&amp; description) {
    todos.emplace(author, [&amp;](auto &amp;new_todo) {
        new_todo.id = id;
        new_todo.description = description;
        new_todo.completed = 0;
    });
   }

  [[eosio::action]]
  void complete(eosio::name author,const uint32_t id)
  {  
      eosio::require_auth(author);

      auto itr = todos.find(id);
      // 是否用find()方法，去查找这条方法对应的实例
      eosio_assert(itr != todos.end(), &quot;todo does not exit&quot;);
    // 这里 如果找不到，todos.end() 会返回 null
      todos.modify(itr,author,[&amp;](auto &amp;t) {
          t.completed = 1;
      });
  }

  [[eosio::action]]
  void destroy(eosio::name author, const uint32_t id){    
     eosio::require_auth(author);
      auto itr = todos.find(id);
      if(itr != todos.end()){
         todos.erase(itr);
      }
  }

  private:
  struct [[eosio::table]] todo {
      uint64_t id;
      string description;
      uint64_t completed;

      uint64_t primary_key() const {
          return id;
      }
  };

  typedef eosio::multi_index&lt;&quot;tood&quot;_n, todo&gt; todo_index;
  todo_index todos;
};

EOSIO_DISPATCH(todolist, (create)(complete)(destroy))
</code></pre><blockquote>
<ul>
<li>这里有一点要说明，貌似一个账号只能部署一个智能合约，希望这个结论是正确的</li>
<li>上面的todo这个table，由于我的笔误，生成表名的时候写成了 tood,哈哈</li>
<li>合约比较简单了，交互也比较简单，细心点，仔细点，相信你也可以步入eos dapp开发的大门了</li>
</ul>
</blockquote>
<h4 id="eos智能合约开发-总结"><a href="#eos智能合约开发-总结" class="headerlink" title="eos智能合约开发 总结"></a>eos智能合约开发 总结</h4><blockquote>
<ul>
<li>请一定耐心的看完文章，中间漏了一点也会造成失败  </li>
<li>最开始的文章截图使用的分辨率较高，图片显示较大，如若对你阅读造成阅读困难，可以适当缩小页面进行阅读</li>
</ul>
</blockquote>
<p><strong>文章允许转载，但请注明出处，谢谢</strong></p>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#107;&#x75;&#x6e;&#x6e;&#121;&#x40;&#49;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#x73;&#107;&#x75;&#x6e;&#x6e;&#121;&#x40;&#49;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/11/eos dapp开发 官方教程学习7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/11/eos dapp开发 官方教程学习7/" itemprop="url">eos dapp开发学习 第五课</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-11T19:30:46+08:00">
                2018-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<ul>
<li>这次将更新完官方所有的教程，但是不会一一讲解了，因为我也没怎么看懂这个算法，因为这个算法不是我要完成这篇文章的重点，所以感兴趣的同学可以自行探索  </li>
<li>上一篇文章虽然完成了数据上链和读取，但是由于我的大意，有些数据得做调整，具体的可以参考本篇的代码    </li>
<li>更改了前端的显示结构，更加清晰</li>
<li>说说我遇到的坑，以免你犯同样的错误 </li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>坑1==&gt; <code>void playcard(account_name username, uint8_t player_card_idx);</code> 这是官方的方式，当我调用方法正确传参的时候，会出现 <em>player_card_idx</em>这个参数错误，我采取的办法是重命名为 index可解决，至于原因我猜测是大于12个字符了，而且 _ 应该不允许使用  </li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>自己挖的坑1 ==&gt; 困扰了我1天，该打。<br>按照上篇文章的代码，当执行开始的游戏，我的手里牌仅会产生一张，结果是我在定义dict_card的时候，使用copy的方式，所有的类型全部是empty造成  </li>
<li>自己挖的坑2 ==&gt; 困扰了我2天，该打。<br>当我写了endgame的方法，怎么执行都不报错，但是数据就是无法更改进able，后面发现没有加入abi_dispatch中。这是个大坑，简直坑死我了  </li>
<li>自己挖的坑3 ==&gt; 这个是eos issues中看到的<br>当更新合约时，出现这种错误，请使用绝对路径即可<br><img src="/img_eos1/eos12.png" alt="eos"></li>
</ul>
</blockquote>
</blockquote>
<h4 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h4><blockquote>
<p>这里仅做简单展示，想具体玩可以使用去官网玩<br>登录-&gt;开始游戏-&gt;选择手里牌和ai进行对比，进行血量的计算-&gt;再进行下一轮选牌对比，直至谁的life先到达0则为输<br>可以使用endgame 结束这场游戏</p>
</blockquote>
<p><img src="/img_eos1/eos_react6.gif" alt="eos"></p>
<h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><p>这里只贴了我很仔细写了代码，剩下的代码 计算ai选牌，分数计算是copy官方的</p>
<pre><code>void cardgame::login(eosio::name user)
{
    eosio::require_auth(user);
    auto itr = _users.find(user.value);
    if(itr == _users.end()){
        _users.emplace(get_self(),[&amp;](auto&amp;  row){
                row.name = user;
            });
    } 
    // 否则登录成功
}

void cardgame::startgame(eosio::name user) {
    eosio::require_auth(user);
    auto&amp; itr = _users.get(user.value,&quot;User not exist&quot;);
    _users.modify(itr, get_self(), [&amp;](auto&amp; row){
        game game_data;
        for(uint8_t i = 0; i &lt; 4; i++){
            draw_card(game_data.deck_player, game_data.hand_player);
            draw_card(game_data.deck_ai, game_data.hand_ai);
        }
        row.game_data = game_data;
    });
}

void cardgame::endgame(eosio::name user) {
    eosio::require_auth(user);
    auto&amp; itr = _users.get(user.value,&quot;User not exist&quot;);
    _users.modify(itr, get_self(), [&amp;](auto&amp; row){
        row.game_data = game();
    });
}
</code></pre><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>根据eos官方的elemental battle的dapp开发教程到这里我就简单的结束了，如果你按照第一篇文章来写，应该能够走得到最后，完成编写。</li>
<li>eosio.cdt又更新到1.4了，估计有新的变化，当你按照别人的教程写合约时，请注意版本</li>
<li>上面演示时，可以看到使用eosjs进行与链上的交互很慢，而且有时还会报错，这是因为我的这边的梯子不是很好的原因，所以请不要担心</li>
<li>对于我个人来说，我觉得写合约这块:<ol>
<li>先了解一下其基本的术语，比如account，action，permission</li>
<li>就是增删改查 multi_index，记住这个数据储存的特殊性</li>
<li>知道系统提供的一些特殊的变量和方法，比如“name”_n 和现在的get_self()</li>
<li>合约中一些地方权限的验证，这非常重要。</li>
<li>养成良好的代码风格。</li>
<li>当能够编写基本的合约后，应该思考一下代码的结构，</li>
<li>编写dapp的思想,不能按照传统的应用的模式来编写。而应该根据区块链的特性来编写应用，就例如现在在区块链上运行，储存数据都是需要有费用的。</li>
<li>目前来说，区块链上的由于其特性，相对公平，不容易作假，因为所有的交易历史均可以查询，但前提是你的<strong>智能合约</strong>足够足够安全，而合约毕竟是用代码写的，难免有bug,所以只有多写，多看，多总结了</li>
</ol>
</li>
<li>目前eos的教程有很多版本，语法上面都有改变，即使是目前官方的demo，也有很多歌版本。所以你认准你编译合约的版本，不然你会越写越烦。我这个系列经历了eoiocpp eosio.cdt1.2 eosio1.3.2等等，写着也非常不顺，不过好歹也写完了。  </li>
</ul>
<p><a href="https://github.com/shaokun11/eoslearning/tree/eos-dve5" target="_blank" rel="noopener">第五课源码</a></p>
<h4 id="接下来的计划"><a href="#接下来的计划" class="headerlink" title="接下来的计划"></a>接下来的计划</h4><blockquote>
<p>目前我的文章基本上都是比较简单的demo或者概念性的文章，这样看多了也没有意思，我写着也觉得没有意思了。所以接下来准备找一些具有代表性的基于以太坊，波场和eos合约与大家分享了。</p>
</blockquote>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#107;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;" target="_blank" rel="noopener">&#115;&#107;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#51;&#x2e;&#x63;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/09/eos dapp开发 官方教程学习6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/09/eos dapp开发 官方教程学习6/" itemprop="url">eos dapp开发学习 第四课 续</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-09T21:48:45+08:00">
                2018-11-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>很幸运，总算把新版本的eos和cdt装上了，踩过了很多坑，说多了都是泪。 </p>
<ul>
<li>首先，目前本地我的环境eos1.4 eosio.cdt1.3.2 所以你按照接下来的教程走，那么请核对你的版本</li>
<li>坑1 ==&gt; 如果在原来的账号上部署过类似的table的合约，再次更新合约如果在table中增加修改了字段，能够部署，但是不能够得到得到table的内容和执行action，建议用新的账号进行部署解决</li>
<li>坑2 ==&gt; <a href="https://developers.eos.io/eosio-home/docs/your-first-contract" target="_blank" rel="noopener">helloworld</a>很流畅，一路走下去完美。<a href="https://developers.eos.io/eosio-home/docs/data-persistence" target="_blank" rel="noopener">table数据储存</a>这里不知道知道是我的操作不对还是怎么回事，跟着官网的教程，abi和wasm都能够正常生成，这里合约能够部署上去。但是来了，无法get table，也无法push action。</li>
<li>坑3 ==&gt; 语法变了哈，这里强调一下，支持vector，enume，map 和任何自定义的类型哈，剩下的这个就大家自行琢磨了</li>
<li>坑4 ==&gt; 目前来看，尽量把合code在一个cpp中，不然有想不到的意外等着的哈</li>
</ul>
</blockquote>
<h4 id="合约代码"><a href="#合约代码" class="headerlink" title="合约代码"></a>合约代码</h4><p><code>cardgame.hpp</code></p>
<pre><code>#pragma once
#include &lt;eosiolib/eosio.hpp&gt;
using namespace std;

class [[eosio::contract]]cardgame : public eosio::contract {
  public:
    cardgame(eosio::name reciever,eosio::name code,eosio::datastream&lt;const char*&gt; ds )
                                :contract(reciever,code,ds),
                                _users(reciever,code.value),
                                _seed(reciever,code.value){};

    [[eosio::action]] void login(eosio::name user);
    [[eosio::action]] void startgame(eosio::name user);
    [[eosio::action]] void playcard(eosio::name user,uint8_t player_card_index);

  private:
    enum game_status:int8_t
    {
      ONGOING = 0,      // 游戏正在进行中
      PLAYER_WON = 1,   // 游戏已经结束，玩家获得胜利
      PLAYER_LOST = -1 // 游戏结束， 完结失败
    };
    enum card_type : uint8_t  // 卡片的类型 总共五种属性类型,总共17张卡牌
    {
      EMPTY = 0,    // 不存在的卡片
      FIRE = 1,     // 火属性， 克木  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      WOOD = 2,     // 木属性， 克水  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      WATER = 3,    // 水属性   克火  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      NEUTRAL = 4,  // 中立属性       攻击力为3 总共1张 
      VOID = 5      // 平局属性       共计力为0 总共1张
    };

    struct card
    {
      uint8_t type;   // 卡片类型
      uint8_t attack_point; // 卡片的攻击力
    };

    const  map&lt;uint8_t,card&gt; card_dict = {
        {0 , {EMPTY , 0}},
        {1 , {EMPTY , 1}},
        {2 , {EMPTY , 1}},
        {3 , {EMPTY , 2}},
        {4 , {EMPTY , 2}},
        {5 , {EMPTY , 3}},
        {6 , {EMPTY , 1}},
        {7 , {EMPTY , 1}},
        {8 , {EMPTY , 2}},
        {9 , {EMPTY , 2}},
        {10 , {EMPTY , 3}},
        {11 , {EMPTY , 1}},
        {12 , {EMPTY , 1}},
        {13 , {EMPTY , 2}},
        {14 , {EMPTY , 2}},
        {15 , {EMPTY , 3}},
        {16 , {EMPTY , 3}},
        {17 , {EMPTY , 0}},
    };
    struct game
    {
     int8_t status = ONGOING;   // 只要登录 默认游戏正在进行
     int8_t life_player = 5;    // 游戏玩家 5条生命
     int8_t ai_player = 5;      // 游戏玩家 5条生命
     vector&lt;uint8_t&gt;  deck_player = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17}; // 玩家待选的卡牌id
     vector&lt;uint8_t&gt; deck_ai = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17};     // ai待选的卡牌id
     vector&lt;uint8_t&gt; hand_player = {0,0,0,0}; // 玩家的手里牌
     vector&lt;uint8_t&gt; hand_ai = {0,0,0,0};     // ai的手里牌
     uint8_t selected_card_player = 0;          // 从待选牌中选中的牌
     uint8_t selected_card_ai = 0;              // 从待选牌中选中的牌
    };


      struct [[eosio::table]] userinfo
      {
          eosio::name  name;            
          uint16_t win_count = 0;        
          uint16_t lost_count = 0;
      game game_data;         

          auto primary_key() const {return name.value;}  
      };

    struct [[eosio::table]] seed 
    {
      uint64_t key = 1;
      uint32_t seed_value = 1;

      auto primary_key() const {return key;};
    };

      typedef eosio::multi_index&lt;&quot;userinfo&quot;_n,userinfo&gt; user_index;
    typedef eosio::multi_index&lt;&quot;seed&quot;_n,seed&gt; seed_index;
    user_index _users; //声明表的实例
    seed_index _seed;

  int random(const int range);
  void draw_card(vector&lt;uint8_t&gt;&amp; deck, vector&lt;uint8_t&gt;&amp; hand);
};
</code></pre><p><code>cardgame.cpp</code></p>
<pre><code>#include &quot;cardgame.hpp&quot;

void cardgame::login(eosio::name user)
{
    _users.emplace(get_self(),[&amp;](auto&amp;  u){
            u.name = user;
    });
}

void cardgame::startgame(eosio::name user) {
    auto&amp; itr = _users.get(user.value,&quot;User not exist&quot;);
    _users.modify(itr,get_self(),[&amp;](auto&amp; _to_modify_user){
        game game_data;
        for(uint8_t i = 0; i &lt; 4; i++){
            draw_card(game_data.deck_player,game_data.hand_player);
            draw_card(game_data.deck_ai,game_data.hand_ai);
        }
        _to_modify_user.game_data = game_data;
    });
}

void cardgame::playcard(eosio::name user, uint8_t player_card_index){
    eosio::require_auth(user);
    eosio_assert(player_card_index &lt; 4,&quot;invalid hand index&quot;);// 手上牌最多四张
    // 通过user找到数据表中数据
    auto&amp; player = _users.get(user.value,&quot;User not exist&quot;);
    eosio_assert(player.game_data.status == ONGOING,&quot;game have ended&quot;);
    eosio_assert(player.game_data.selected_card_player == 0,&quot;the player have selected car in this turn&quot;);
    // 修改数据表
    _users.modify(player,get_self(),[&amp;](auto&amp; _to_modify_user){
        game&amp; game_data = _to_modify_user.game_data;
        // 设定选中的卡片id
        game_data.selected_card_player = game_data.hand_player[player_card_index];
        // 将手中卡片对应位置置位empty
        game_data.hand_player[player_card_index] = 0;
    });
};
int cardgame::random(const int range) {
    auto seed_itr = _seed.begin();
    if (seed_itr  == _seed.end()){    // 如果没有随机数据，就用默认值初始化
        seed_itr = _seed.emplace(get_self(),[&amp;](auto&amp; s){
            s = seed{};
        });
    };
    int prime = 65535;
    int new_seed_value = (seed_itr-&gt;seed_value + now()) % prime;
    _seed.modify(seed_itr,get_self(),[&amp;](auto&amp; s){
            s.seed_value = new_seed_value;
    });
    // 随机范围  0 ~ range
    int random_res = new_seed_value % range;
    return random_res;
};
void cardgame::draw_card(vector&lt;uint8_t&gt;&amp; deck, vector&lt;uint8_t&gt;&amp; hand) {
      int deck_card_idx = random(deck.size());
      int first_empty_slot = -1;
      for (int i = 0; i &lt;= hand.size(); i++) {
          auto id = hand[i];
          if (card_dict.at(id).type == EMPTY) {
              first_empty_slot = i;
              break;
          }
        }
      eosio_assert(first_empty_slot != -1, &quot;No empty slot in the player&apos;s hand&quot;);
      hand[first_empty_slot] = deck[deck_card_idx];
      deck.erase(deck.begin() + deck_card_idx);
 };
EOSIO_DISPATCH(cardgame,(login)(startgame)(playcard))
</code></pre><ul>
<li>由于上面的坑，用shaokun11113是无法正确的，所以我用了shaokun11114进行部署  </li>
<li>终于能够写数据到链上了<img src="/img_eos1/eos11.png" alt="eos">   </li>
<li><a href="https://github.com/shaokun11/eoslearning/tree/eos-dve4-update" target="_blank" rel="noopener">更新的合约源码</a>，这次就没有更新前端的mock数据了，相信聪明的你一定知道怎样调整过来</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#x6b;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x73;&#x6b;&#x75;&#x6e;&#x6e;&#x79;&#x40;&#49;&#x36;&#51;&#x2e;&#99;&#111;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/02/eos dapp开发 官方教程学习5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/02/eos dapp开发 官方教程学习5/" itemprop="url">eos dapp开发学习 第四课</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-02T21:02:05+08:00">
                2018-11-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>官方又发布新版本了，目前写的合约也部署不上了，新版本的语法变了确实蛮多的，目前仅按照官网的教程把流程过一遍了<br>很幸运，目前的官方的游戏第一次和第二次已经被我玩了，这里也把第二次的游戏流程分享给大家，对于接下来编写代码心里有点底，因为本课主要是智能合约的编写。<br>Elemental Battles是一款单人纸牌游戏，其中包括元素之间的战斗。对手将通过在EOSIO上运行的智能合约来代表。<br><img src="/img_eos1/eos_react5.gif" alt="eos"></p>
</blockquote>
<h4 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h4><blockquote>
<p>在本课中，我们将准备我们的游戏。我们还将在智能合约中构建startgame和playcard动作，并从前端触发。在本课程结束时，您将能够开始玩元素战斗并迈出第一步！  </p>
</blockquote>
<h4 id="合约编写"><a href="#合约编写" class="headerlink" title="合约编写"></a>合约编写</h4><blockquote>
<p>这里我暂时无法部署上去，只能先把代码放在这里了。看了上面的游戏玩法，各位同学结合注释应该看得明白了。<br>玩家和ai进行卡片游戏对战，都从各自的待选17张牌中选出四张，每张牌有不同的攻击力。根据攻击力进行判断一次对决的胜负，各有5条命，输一次减少一条命，谁先到达0谁就输了。游戏简单，主要是了解一下智能合约的开发流程<br>这里并没有成功布置到链上，以后补上了<br><a href="https://github.com/shaokun11/eoslearning/tree/eos-dev4" target="_blank" rel="noopener">第四课源码</a></p>
</blockquote>
<p><code>cardgame.hpp</code></p>
<pre><code>#include &lt;eosiolib/eosio.hpp&gt;
using namespace std;
class cardgame : public eosio::contract {
// 继承contract
  public:
    //构造方法,并实例化了multi_index表users
    cardgame( account_name self):contract(self),
                                _users(self,self),
                                _seed(self,self){};

    // table和action 必须加上@abi 的注解，这样才能生存对应的abi，
    // 在eosio.cdt中，使用 [[eosio::action]] 更加简洁 
    [[eosio::action]]
    void login(account_name user);

    // 开始游戏，分发手里牌
    [[eosio::action]]
    void startgame(account_name user);

    //从手上牌选择卡片进行对战
    [[eosio::action]]
    void playcard(account_name user,uint8_t player_card_index);

  private:
    enum game_status:int8_t
    {
      ONGOING = 0,      // 游戏正在进行中
      PLAYER_WON = 1,   // 游戏已经结束，玩家获得胜利
      PLAYER_LOST = -1 // 游戏结束， 完结失败
    };
    enum card_type : uint8_t  // 卡片的类型 总共五种属性类型,总共17张卡牌
    {
      EMPTY = 0,    // 不存在的卡片
      FIRE = 1,     // 火属性， 克木  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      WOOD = 2,     // 木属性， 克水  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      WATER = 3,    // 水属性   克火  攻击力为 1 和 2 的各两张  攻击力为3的一张    总共5张
      NEUTRAL = 4,  // 中立属性       攻击力为3 总共1张 
      VOID = 5      // 平局属性       共计力为0 总共1张
    };
    struct card
    {
      uint8_t type;   // 卡片类型
      uint8_t attack_point; // 卡片的攻击力
    };
    typedef uint8_t card_id;
    const map&lt;card_id,card&gt; card_dict = {
        {0 , {EMPTY , 0}},
        {1 , {EMPTY , 1}},
        {2 , {EMPTY , 1}},
        {3 , {EMPTY , 2}},
        {4 , {EMPTY , 2}},
        {5 , {EMPTY , 3}},
        {6 , {EMPTY , 1}},
        {7 , {EMPTY , 1}},
        {8 , {EMPTY , 2}},
        {9 , {EMPTY , 2}},
        {10 , {EMPTY , 3}},
        {11 , {EMPTY , 1}},
        {12 , {EMPTY , 1}},
        {13 , {EMPTY , 2}},
        {14 , {EMPTY , 2}},
        {15 , {EMPTY , 3}},
        {16 , {EMPTY , 3}},
        {17 , {EMPTY , 0}},
    };
    struct game
    {
     int8_t status = ONGOING;   // 只要登录 默认游戏正在进行
     int8_t life_player = 5;    // 游戏玩家 5条生命
     int8_t ai_player = 5;      // 游戏玩家 5条生命
     vector&lt;card_id&gt;  deck_player = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17}; // 玩家待选的卡牌id
     vector&lt;card_id&gt; deck_ai = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17};     // ai待选的卡牌id
     vector&lt;card_id&gt; hand_player = {0,0,0,0}; // 玩家的手里牌
     vector&lt;card_id&gt; hand_ai = {0,0,0,0};     // ai的手里牌
     card_id selected_card_player = 0;          // 从待选牌中选中的牌
     card_id selected_card_ai = 0;              // 从待选牌中选中的牌
    };

      [[eosio::table]]
      struct userinfo
      {
          account_name name;            //玩家的名字    account_name 是uint64_t的一个别名
          uint16_t win_count = 0;        
          uint16_t lost_count = 0;
      game game_data;         // game 

          auto primary_key() const {return name;}  
          //多索引表查找名为primary_key（）的getter函数。这必须使用结构中的第一个字段，编译器将使用它来添加主键。让我们定义这个功能。
      };
    [[eosio::table]]
    struct seed // 这个是用来生成随机数的，全局储存，只要有人玩就会改变，没办法，eos里只能用table来持久化数据在链上
    {
      uint64_t key = 1;
      uint32_t value = 1;

      auto primary_key(){return key;};
    }

      typedef eosio::multi_index&lt;N(userinfo),userinfo&gt; user_index;
      //多索引表定义，它有两个参数： 表名 
      //                         结构定义了我们打算在多索引表中存储的数据。 
      // 新类型名称作为我们的多索引表定义的别名
      // 
      // 多索引表中的数据由四条信息标识： code（account_name） 
      //                              scop 
      //                              table name
      //                              primary key 
    typedef multi_index&lt;N(seed),seed&gt; seed_index;
    user_index _users; //声明表的实例
    seed_index _seed;

    int random(const int range);
    void draw_one_card(vector&lt;uint8_t&gt;&amp; deck,vector&lt;uint8_t&gt;&amp; hand);
};    
</code></pre><p><code>cardgame.cpp</code> </p>
<pre><code>#include &quot;cardgame.hpp&quot;
void cardgame::login(account_name user)
{
    require_auth(user); 
    //确保这个用户已经被授权
    // 这里我理解了很久，把我的想法记录在这里
    // 这里是调用此合约的account name，即提供私钥的account，这里传入的这个account必须拥有它的active权限，
    // 当然，这里还可以要求有其他的权限，这样就可以给特殊的账号特殊的权限
    auto user_iterator = _users.find(user);  // 查找
    if (user_iterator == _users.end()) {
        user_iterator = _users.emplace(user, [&amp;](auto&amp; new_user){
            new_user.name = user;
        });
    }
    // 这里使用multi_index的find 和 emplace(插入)两种方法，
    // 这些方法的形式都是一样的，记住就好，可以去官网查看详细的方法说明
}

void cardgame::startgame(account_name name) {
    require_auth(name);
    auto&amp; info = _users.get(name, &quot;user not exist&quot;);
    _users.modify(info,name,[&amp;](auto&amp; _to_modify_user){
        game game_data;
        for(uint8_t i = 0; i &lt; 4; i++){
            draw_one_card(game_data.deck_player,game_data.hand_player);
            draw_one_card(game_data.deck_ai,game_data.hand_ai);
        }
        _to_modify_user.game_data = game_data;
    });
}

void cardgame::playcard(account_name user,uint8_t player_card_index){
    require_auth(user);
    eosio.assert(player_card_index &lt; 4,&quot;invalid hand index&quot;); // 手上牌最多四张
    // 通过user找到数据表中数据
    auto&amp; player = _users.get(user,&quot;User not exist&quot;);
    eosio_assert(player.game_data.status == ONGONING,&quot;game have ended&quot;); // 确保本轮游戏没有结束
    eosio_assert(player.game_data.selected_card_player == 0,&quot;the player have selected car in this turn&quot;); // 确保手上没有选牌
    // 修改数据表
    _users.modify(player,user,[&amp;](auto&amp; _to_modify_user){
        game&amp; game_data = _to_modify_user.game_data;
        // 设定选中的卡片id
        game_data.selected_card_player = game_data.hand_player[player_card_index];
        // 将手中卡片对应位置置位empty
        game_data.hand_player[player_card_index] = 0;
    });
}
EOSIO_ABI(cardgame,(login)(playcard))
</code></pre><p><code>gameplay.cpp</code></p>
<pre><code>#include &quot;cardgame.hpp&quot;
int cardgame::random(const int range) {
    auto seed_itr = _seed.begin();
    if (seed_itr  == _seed.end())
    {    // 如果没有随机数据，就用默认值初始化
        seed_itr = _seed.emplace(_self,[&amp;](auto&amp; seed){})
    };
    int prime = 65535;
    // 新值得范围 0 ~ 65535
    auto new_seed_value = (seed_itr.value + now()) % prime;
    _seed.modify(seed_itr,_self,[&amp;](auto&amp; s){
            s.value = new_seed_value;
    });
    // 随机范围  0 ~ range
    int random_res = new_seed_value % range;
    return random_res;
}
// 根据待选卡片和手上已有的卡片，随机进行选择新的卡片
void cardgame::draw_one_card(vector&lt;uint8_t&gt; &amp;deck,vector&lt;uint8_t&gt; &amp;hand){
    // 0 ~ 16
     int deck_card_index = random(deck.size());
     int first_emprty_slot = -1;
     for (int i = 0; i &lt; hand.size; ++i)
     {    
         auto id = hand[i];
         if (card_dict.at(id).type == EMPTY){
             first_emprty_slot = i;
             break;
         }
     }
     eosio_assert(first_emprty_slot !=- 1, &quot;No empty slot in the players hand&quot;);
     // 如果手上的牌 有空位，进行随机赋值
     hand[first_emprty_slot] = deck[deck_card_index];
     // 待选牌中移除掉已经被赋值给手上的牌
     deck.erase(deck.began() + deck_card_index);
 }
</code></pre><h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#115;&#x6b;&#117;&#x6e;&#110;&#x79;&#64;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/27/eos dapp开发 官方教程学习4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/27/eos dapp开发 官方教程学习4/" itemprop="url">eos dapp开发学习 第三课</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-27T13:12:11+08:00">
                2018-10-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>上一篇文章登录的时候，你如果做了，虽然也未报错，按照结论貌似登录上了，但是，其实是没有登录上的，这里给大家说一声对不起，因为其中的某些参数未完全按照官方的例子敲，所以造成了参数不对。<br>既然上篇文章登录错了，那么这篇文章还是得纠正过来，并且找到错在哪里</p>
</blockquote>
<h4 id="教程内容"><a href="#教程内容" class="headerlink" title="教程内容"></a>教程内容</h4><blockquote>
<p>在本课中，我们将学习如何从区块链中获取数据。数据通过来自前端的交易进入区块链，我们在第2.2课和第2.3课中查看了这一点。调用操作可以更改状态，该状态存储在多索引表中。此外，此操作记录在区块链中。</p>
</blockquote>
<h4 id="教程结果"><a href="#教程结果" class="headerlink" title="教程结果"></a>教程结果</h4><blockquote>
<p>首先声明，所有的结果均未完全百分之百按照官方教程走，省略了其中的ui，而只涉及了其中正常开发所必须掌握的内容，如果觉得页面不够美丽，建议你可以按照官方的例子去学，这是地址<a href="https://battles.eos.io/" target="_blank" rel="noopener">elemental battles</a><br>本次调整了部分逻辑，方便我操作，如果你觉得不合适，可以修改<br>再来强调一下你需要哪些知识才能看懂：</p>
<blockquote>
<ul>
<li>区块链共识算法，这是区块链的核心</li>
<li>eos 账户,权限，cpu,net,ram等相关知识</li>
<li>eos 本地环境，得安装在电脑上，安装方式自行查找（也就是部署合约用，如果你没有而又想走捷径，这里有个好东西，拿去不谢，<a href="https://github.com/itleaks/js4eos" target="_blank" rel="noopener">eos4js</a>，这个库开源出来才2天，也许后面还有更多类似的优秀的库，你都可以使用）</li>
<li>eoscdt 得安装，去下载，然后下一步就好。（这个东西是用来编译成wasm和abi的，单独抽出来的，建议使用，当前时间我使用的eoscdt1.2，语法是旧的，如果你后续用了高版本，按照这篇文章敲语法会有问题的，但是思想是不变的）</li>
<li>react 这是一个前端的库，为什么要用这个？因为第一，我会，第二，官方也是用的他，第三，用起来很爽，你如果用的别的如vue活着原生来写，只要你把流程搞懂了，也是一样的</li>
<li>react-redux 这东西有点难懂，可能会看得你一脸蒙蔽，和上面一点是配套使用的，数据流的管理方式。简单理解就是数据的传递方式，写起来很复杂，理解起来还是很烧脑。我一时半会也说不完，来这里去看看吧<a href="https://cn.redux.js.org/docs/react-redux/" target="_blank" rel="noopener">react-redux</a>。（我也考虑过不用这个写，这样简单很多，对大家的理解也会有帮助，但是考虑到官方用了，我也就顺便用了） </li>
<li>c++ 这个东西我也是为了写eos智能合约才开始学的，还好我之前有java的基础，学点基础够我们用了，难点的在它的指针上面，（话说，写合约貌似不怎么用指针了，eos已经帮我们封装的够多了，用得多的是引用），这个就看自己了  </li>
<li>node 基础 够用就好  </li>
<li>当然 js基础  同样够用就好</li>
<li>梯子</li>
<li>系统，反正不能是Windows系统</li>
</ul>
</blockquote>
</blockquote>
<p>为了避免上一篇文章犯错，这次先把结果展示了<br><a href="https://github.com/shaokun11/eoslearning/tree/eos-dev03" target="_blank" rel="noopener">eos第三课源码</a></p>
<blockquote>
<p>这里尽量放git图片了，先看图后看文字解释。  </p>
</blockquote>
<p><img src="/img_eos1/eos_react4.gif" alt="eos"> </p>
<h4 id="布局更新"><a href="#布局更新" class="headerlink" title="布局更新"></a>布局更新</h4><ul>
<li>更改了采取内置账号和秘钥的方式，直接点击不用输入了</li>
<li>当登录成功，去区块链上拿到用户的信息，刷新ui</li>
<li><p>下面的代码已经有注释了</p>
<pre><code>import {Api, JsonRpc, JsSignatureProvider} from &apos;eosjs&apos;;

async function takeAction(action, account, pk, dataValue) {
    console.log(&quot;takeAction&quot;, action, dataValue)
    const rpc = new JsonRpc(process.env.REACT_APP_EOS_HTTP_ENDPOINT);
    const signatureProvider = new JsSignatureProvider([pk]);
    const api = new Api({rpc, signatureProvider, textDecoder: new TextDecoder(), textEncoder: new TextEncoder()});
    try {
        return await api.transact({
            actions: [{
                account: &quot;shaokun11113&quot;,  // 合约的拥有者
                name: action,             // 执行的合约方法
                authorization: [{
                    actor: account,       // 执行合约的账户
                    permission: &apos;active&apos;, // 执行合约的账户所需要的权限
                }],
                data: dataValue,          // 所需要的参数,以json字符串进行传递，注意key为合约中定义的参数的名字，也可以通过abi进行查看

        }]
    }, {
        blocksBehind: 3,              // 多少个块后确认
        expireSeconds: 30,            // 超时时间
    });
} catch (err) {
    throw(err)
}
}

class ApiService {

static async getUserByName(username) {
    const rpc = new JsonRpc(process.env.REACT_APP_EOS_HTTP_ENDPOINT);
    const res = await rpc.get_table_rows({
        code: process.env.REACT_APP_EOS_CONTRACT_NAME,             //由于在合约中写死了，这里也可以写死
        scope: process.env.REACT_APP_EOS_CONTRACT_NAME,             //由于在合约中写死了，这里也可以写死
        table: &quot;userinfo&quot;,                                           //由于在合约中写死了，这里也可以写死
        json: true,                                                // 默认值 ，可以不填
        lower_bound: username,                                      // 匹配规则，不填默认返回全部
    })
    return res.rows[0];
}

static login({name, key}) {
    return new Promise((resolve, reject) =&gt; {
        takeAction(&quot;login&quot;, name, key, {user: name}).then(res =&gt; {
            // 执行成功会返回默认的交易hash
            console.log(&quot;login success&quot;, res);
            resolve();
        }).catch(err =&gt; {
            console.log(err)
            reject(err);
        })
    });
}
}

export default ApiService;
</code></pre></li>
<li><p>当登录成功显示的组件,这是当跳转后立即获取最新数据。结合上面的代码，就知道了。</p>
<p>  <img src="/img_eos1/eos10.png" alt="eos"> </p>
</li>
<li><p>上面最后，我使用postman拿取了合约中所有的数据，可以看到，目前的数据储存是两条，当然，你在代码中也可以实现，至于怎么实现，我想你应该知道的。至于上一篇文章错在哪里，你仔细看了上面的代码就知道了。</p>
</li>
</ul>
<p><strong>文章允许转载，但请注明出处，谢谢</strong></p>
<h4 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h4><blockquote>
<p>对个人的总结：<br>目前分享的经验不是很足，严格算起来，就一个多月而已,还是经过一个外国老哥的建议才开始写的，目前文章也比较粗糙。<br>但我还是会尽力来记录这些。一来这样记录下来可以让自己对知识把握得更牢靠，二来也可以帮助到他人。<br>从零开始搭博客，学习markdown语法，搜集图片，上传图片，传动图或者视频，都是一步一步摸索出来，中间坑很多，但是乐趣也在此.</p>
</blockquote>
<p>至于后续的文章，尽量跟着官方的教程走，所以到这里，第三课结束了。<br>小小的总结一下前三课的内容    </p>
<ul>
<li>第一课  搭环境  </li>
<li>第二课  搭ui与合约的编写</li>
<li>第二课续 部署，测试合约（合约部署成功，连接合约是失败的）</li>
<li>第三课  更改上课的错误，连接合约，增加新的展示界面</li>
</ul>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#107;&#x75;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#51;&#46;&#x63;&#x6f;&#109;" target="_blank" rel="noopener">&#x73;&#107;&#x75;&#110;&#x6e;&#121;&#x40;&#x31;&#x36;&#51;&#46;&#x63;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/21/eos dapp开发 官方教程学习3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/21/eos dapp开发 官方教程学习3/" itemprop="url">eos dapp开发学习 第二课 续</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-21T13:16:25+08:00">
                2018-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><blockquote>
<p>到此我这里发现了多个问题，这里列出来，希望帮到遇到同样问题的同学</p>
<ol>
<li>目前eoscdt git已经更新到1.4版本了，其中的结构，语法更改了很多，我这边mac系统是10.12.6，弄了一周还是没办法升级到13，而新的cdt最低需求已经要13了，忧伤。。。<br>而我从源码编译，总是clone不下来，试过各种方法均失败了。这里提醒一下，最好按照他的系统要求去安装，已经有打包好的二进制文件了 </li>
<li>目前的官网的版本使用的eoscdt1.2，而经过上面的方式失败了，我再次尝试了这个，成功了</li>
<li>这里如果按照昨天的cpp文件使用eosio-cpp进行编译，是没有问题的。但是无法部署合约，这里需要将table name 由user_info 改为 userinfo   注意 不能改成userInfo,UserInfo等等，即所有的需要写入abi的action和table name必须 仅能包含<br><code>.12345abcdefghijklmnopqrstuvwxyz</code><br>这些字符</li>
<li>莫名的感觉忧伤而兴奋，忧伤是跟不上新版本的步伐，兴奋的是开发越来越规范，现在可以接着上一篇文章继续写作了</li>
<li>带着梯子办事，总会减少很多很多没有必要的问题</li>
</ol>
</blockquote>
<h4 id="编译、部署合约"><a href="#编译、部署合约" class="headerlink" title="编译、部署合约"></a>编译、部署合约</h4><blockquote>
<p>不同的版本有着不同的变化，这里仅以eoscdt1.2进行操作，如果后续使用eoscdt1.3或者使用之前的eosiocpp来编译出来的abi和wasm文件肯定是用不了的</p>
</blockquote>
<ul>
<li><p>更改cardgame.hpp<br><img src="/img_eos1/eos8.png" alt="contract">  </p>
<pre><code>///@abi action  =&gt; [[eosio::action]]
///@abi table =&gt; [[eosio::table]]
user_info =&gt; userinfo
</code></pre></li>
<li><p>再次生成abi和wasm文件，这里要切换到c++文件所在的目录</p>
<pre><code>eosio-cpp -o cardgame.wasm cardgame.cpp --abigen
</code></pre></li>
<li><p>部署合约，这里在任何目录执行都可以，合约的目录输入绝对路径</p>
<pre><code>cleos -u http://jungle.cryptolions.io:18888 set contract shaokun11113 /Users/shaokun/Desktop/eoslearning/cardgame -p shaokun11113@active
</code></pre></li>
<li><p>当部署遇到图中红色的提示时，请注意table,action,class，struct的名字所含字符<br><img src="/img_eos1/eos9.png" alt="contract"><br>由之前的结论可以看到，我们合约成功部署了</p>
</li>
</ul>
<h4 id="与前端共同交互合约"><a href="#与前端共同交互合约" class="headerlink" title="与前端共同交互合约"></a>与前端共同交互合约</h4><ul>
<li><p>这里使用了最新的eosjs,请更新 <a href="https://github.com/EOSIO/eosjs" target="_blank" rel="noopener">eosjs</a></p>
<pre><code>npm install eosjs@beta    
</code></pre></li>
<li><p>更新后package.json ,请注意eosjs的版本</p>
<pre><code>{
  &quot;dependencies&quot;: {
    &quot;eosjs&quot;: &quot;^20.0.0-beta2&quot;,
    &quot;react&quot;: &quot;^16.5.2&quot;,
    &quot;react-dom&quot;: &quot;^16.5.2&quot;,
    &quot;react-redux&quot;: &quot;^5.0.7&quot;,
    &quot;react-scripts&quot;: &quot;2.0.5&quot;,
    &quot;redux&quot;: &quot;^4.0.1&quot;,
    &quot;redux-logger&quot;: &quot;^3.0.6&quot;
  },
}
</code></pre></li>
<li><p>新版的eosjs的引入有更改，请仔细对比</p>
</li>
<li>由于此处的合约只要是合法的注册到jungle上的account 都可以登录，所以前端框的private key的输入框可以随意输入，这里请注意风险 </li>
<li>登录成功后，跳转界面！！！本篇文章的代码<a href="https://github.com/shaokun11/eoslearning/tree/eos-dev02-update" target="_blank" rel="noopener">lesson2 code</a><br><img src="/img_eos1/eos_react3.gif" alt="contract">  </li>
</ul>
<p><strong>文章允许转载，但请注明出处，谢谢</strong></p>
<h4 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h4><blockquote>
<p>总算完成了之前的坑。^o^<br>中间有很多前端的知识，这不是这个课程讲解的重点，只能靠各位同学自己去补习了。这个系列使用react，redux也是一个很庞大的工程，所以可以简单一点，展示一下交互就好。<br>应该说到此，区块链与前端的交互已经完成，接下来就是充实智能合约的功能了。如果你做到了这一步，建议去<a href="https://developers.eos.io/eosio-cpp/reference" target="_blank" rel="noopener">eos c++ api</a>这里了解一下api，这样对于后面的合约编写会有一个更深层次的掌握</p>
</blockquote>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#117;&#110;&#110;&#x79;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#115;&#x6b;&#117;&#110;&#110;&#x79;&#64;&#x31;&#54;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/20/eos dapp开发 官方教程学习2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/20/eos dapp开发 官方教程学习2/" itemprop="url">eos dapp开发学习 第二课</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-20T22:11:25+08:00">
                2018-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h5><blockquote>
<p>我们将学习如何在智能合约中存储玩家信息;使用登录操作。然后我们将开始构建Web前端，添加Login页面。 要使登录页面与智能合约交互，我们将使用eosjs连接到EOSIO区块链。我们使用eosjs库来调用智能合约中的登录操作。接下来，我们将React连接到Redux以存储应用程序状态。最后，我们将所有这些结合起来并添加一个游戏页面，以便我们有一个工作登录屏幕。 在本课程结束时，玩家应该能够登录游戏并进入游戏中的第一个屏幕。</p>
</blockquote>
<h4 id="step-1-定义表结构"><a href="#step-1-定义表结构" class="headerlink" title="step 1 定义表结构"></a>step 1 定义表结构</h4><p>对于元素战斗，我们需要存储每个玩家的游戏进度的详细信息或状态。为此，我们将使用多索引表，这是EOSIO的一个功能。您可以将多索引表视为内存数据库。要使用多索引表，我们需要告诉EOSIO我们要在其中存储哪些数据。 对于游戏，我们需要存储玩家信息，所以让我们在之前创建的cardgame.hpp中创建一个名为user_info的结构。我们要存储：</p>
<ul>
<li>the player’s name</li>
<li>win count (default to 0)</li>
<li><p>lost count (default to 0)</p>
</li>
<li><p>cardgame.hpp（这里传图片得了，看得仔细一点）<br><img src="/img_eos1/eos5.png" alt="lessons"></p>
</li>
</ul>
<h4 id="step-2-写入数据到多索引表-user中"><a href="#step-2-写入数据到多索引表-user中" class="headerlink" title="step 2 写入数据到多索引表_user中"></a>step 2 写入数据到多索引表_user中</h4><blockquote>
<p>现在我们可以使用我们的多索引表了。所以让我们存储我们的合同状态。为此，我们将创建第一个操作，即登录操作。</p>
</blockquote>
<p><img src="/img_eos1/eos6.png" alt="lessons"></p>
<h4 id="step-3-前端页面组件布局"><a href="#step-3-前端页面组件布局" class="headerlink" title="step 3 前端页面组件布局"></a>step 3 前端页面组件布局</h4><blockquote>
<p>这里还是使用Jungle test net来做，account shaokun11113。<br>我这里出现了一个问题，就是之前我把eos升级了，但是我的电脑没有升级升级到eoscdt。导致现在能够生成abi和wasm文件，但是部署不到链上去，出现的是如下错误，哪位同学知道可以告诉我，感谢。<br><img src="/img_eos1/eos7.png" alt="lessons"></p>
</blockquote>
<p>这里卡住我太久了，那部署合约这一步就先跳过，这一篇文章我们先根据官方的步骤先把前端页面展示出来吧！<br><img src="/img_eos1/eos_react.gif" alt="lessons"><br>主要是精简了官方的图片和ui，这一部分先把功能实现，有心思的同学如果觉得我的这个丑就按照官方的来吧，这里用到了几个react的库，建议你们先了解一下</p>
<pre><code> &quot;eosjs&quot;: &quot;^16.0.9&quot;,   
&quot;react&quot;: &quot;^16.5.2&quot;,
&quot;react-dom&quot;: &quot;^16.5.2&quot;,
&quot;react-redux&quot;: &quot;^5.0.7&quot;,
&quot;react-scripts&quot;: &quot;2.0.5&quot;,
&quot;redux&quot;: &quot;^4.0.1&quot;,
&quot;redux-logger&quot;: &quot;^3.0.6&quot;
</code></pre><h4 id="step-4-页面交互"><a href="#step-4-页面交互" class="headerlink" title="step 4 页面交互"></a>step 4 页面交互</h4><p>由于合约没有部署上，所以没有办法上链进行演示，故此处仅仅是将整个前端的ui交互成功，如果你看过我之前的两篇文章，那么到这里你应该可以理解的。<br><img src="/img_eos1/eos_react2.gif" alt="lessons"></p>
<h4 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h4><p>这篇文章写的很不顺，没有完成最关键的上链一步给大家演示，真是抱歉了。那么只能够走思路了。附上本篇文章所用到的源码 <a href="https://github.com/shaokun11/eoslearning/tree/eos-dev02" target="_blank" rel="noopener">elementel battels dev2</a></p>
<p><strong>文章允许转载，但请注明出处，谢谢</strong></p>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#115;&#x6b;&#x75;&#x6e;&#x6e;&#121;&#64;&#x31;&#x36;&#51;&#x2e;&#99;&#x6f;&#109;" target="_blank" rel="noopener">&#115;&#x6b;&#x75;&#x6e;&#x6e;&#121;&#64;&#x31;&#x36;&#51;&#x2e;&#99;&#x6f;&#109;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/20/eos dapp开发 官方教程学习1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shaokun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hello shaokun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/20/eos dapp开发 官方教程学习1/" itemprop="url">eos dapp开发学习 第一课</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-20T08:47:47+08:00">
                2018-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h5><blockquote>
<p>没想到block one就在10/19放出了一个官方的教程，教程内容很详细，比我上周的详细很多呢，包括语法，逻辑，代码的封装。那么接下来当然也要跟着一步一步的来学一下。<br><a href="https://battles.eos.io" target="_blank" rel="noopener">elemental battles</a> 我这边貌似不用梯子也能进入的哈。</p>
<blockquote>
<p>这里请注意一点，之前的两篇文章使用的是是使用的当前官网的步骤，使用的eosio.cdt1.2进行wasm和abi的，而现在github是最新的1.3版本，语法变化很多，更加规范。<br>而目前的这个教程使用的最开始的方法，所以为了一致，也会使用最古老的方式进行学习，保持统一。综合来看，整体开发dapp的流程和思想是一致的，新版本的只是语法有变化。<br>即整篇采用eos1.2的这个文档 <a href="https://developers.eos.io/eosio-cpp/v1.2.0/docs" target="_blank" rel="noopener">eosio1.2</a><br><img src="/img_eos1/eos1.png" alt="elemental battles cover"><br><img src="/img_eos1/eos0.png" alt="elemental battles cover"><br>为了我自己不糊涂，再啰嗦一遍。建议生产中使用新版本  </p>
</blockquote>
</blockquote>
<ul>
<li>eosio1.2包含了生成.wasm和abi的工具eosiocpp  </li>
<li>eoscdt1.2是单独的一个插件，更加专业，专门用于生成上述两个文件，使用eosio-cpp</li>
<li>eoscdt1.3是1.2的升级版，规范了语法优化了很多</li>
</ul>
<h5 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a>准备阶段</h5><p><img src="/img_eos1/eos2.png" alt="目录"></p>
<blockquote>
<p>需要自己注册一个账号哈</p>
</blockquote>
<p>可以看到，总共九个大的章节，第0章节介绍了eosio，然后指导安装eosio。这个安装和之前的步骤一样，在此就不啰嗦了。</p>
<h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h4><ol>
<li><p>新建三个c++文件,注意命名规则</p>
<pre><code>cardgame.hpp  // 定义智能合约的C ++头文件
cardgame.cpp  // 用于实现智能合约的操作的C++源文件。
gameplay.cpp  // 包含智能合约中使用的内部帮助函数的C++源文件。
</code></pre></li>
</ol>
<p><img src="/img_eos1/eos3.png" alt="文件结构1"></p>
<blockquote>
</blockquote>
<ul>
<li>账户名只能包含字符.abcdefghijklmnopqrstuvwxyz12345。 a-z（小写），1-5和. （英文句点)，必须以字母开头必须为12个字符</li>
<li>表名，结构，函数，类最多只能包含12个字母字符</li>
<li>符号必须是A和Z之间的大写字母字符必须是7个字符或更少</li>
</ul>
<h4 id="step-2"><a href="#step-2" class="headerlink" title="step 2"></a>step 2</h4><p>使用create-react-app 创建web项目，并移除其中不需要的文件<br><img src="/img_eos1/eos4.png" alt="文件结构2"></p>
<h4 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h4><p>额，第0课和第一课就到这里结束了，可以看到和我们之前的流程是类似的。同样需要你掌握web和c++的知识，这些知识点都可以通过网络找到，需要自己积累。<br>第0课主要讲解了eosio开发环境的搭建，自备梯子很重要<br>第1课主要讲解的整个项目的结构</p>
<p><strong>文章允许转载，但请注明出处，谢谢</strong></p>
<h4 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h4><p>区块链技术痴迷的程序猿一枚，如果你喜欢我的文章，可以加上微信共同学习，共同进步。  </p>
<p>email: <a href="mailto:&#x73;&#x6b;&#117;&#x6e;&#x6e;&#x79;&#x40;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;" target="_blank" rel="noopener">&#x73;&#x6b;&#117;&#x6e;&#x6e;&#x79;&#x40;&#49;&#54;&#51;&#46;&#99;&#x6f;&#x6d;</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shaokun</p>
              <p class="site-description motion-element" itemprop="description">记录自己对相关技术的点点滴滴和一些思考，希望能够帮助来到这里的你，如果你喜欢我的文章，可以加个微信共同探讨</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shaokun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
 <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
